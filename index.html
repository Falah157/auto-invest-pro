<!DOCTYPE html>
<html>
<head>
    <title>Crypto Bubble Auto-Invest</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { 
            font-family: Arial; 
            background: #0a0a0a; 
            color: white; 
            padding: 10px; 
            margin: 0; 
        }
        .bubble-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .coin-bubble {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 20px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #2d2d44;
        }
        .coin-bubble:hover {
            transform: scale(1.05);
            border-color: #00ff88;
        }
        .coin-symbol {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .coin-price {
            font-size: 12px;
            color: #00ff88;
        }
        .coin-change {
            font-size: 10px;
        }
        .change-up { color: #00ff88; }
        .change-down { color: #ff4444; }
        
        /* Trading Panel */
        .trading-panel {
            background: #1a1a2e;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        .param-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        .param-btn {
            background: #2d2d44;
            border: none;
            color: white;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
        }
        .param-btn.selected {
            background: #00ff88;
            color: black;
            font-weight: bold;
        }
        .action-btn {
            background: #00ff88;
            color: black;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            width: 100%;
            margin: 10px 0;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header" style="text-align: center; margin-bottom: 20px;">
            <h1>ü™ô Crypto Auto-Invest</h1>
            <p>Tap any coin to setup auto-trading</p>
        </div>

        <!-- Crypto Bubbles Grid -->
        <div class="bubble-grid" id="bubblesGrid">
            <!-- Bubbles will be loaded here -->
        </div>

        <!-- Trading Configuration Panel -->
        <div class="trading-panel" id="tradingPanel">
            <h3 id="selectedCoin">BTC/USDT</h3>
            
            <!-- Frequency Selection -->
            <div class="param-section">
                <h4>üïê Frequency</h4>
                <div class="param-grid">
                    <div class="param-btn" data-param="frequency" data-value="1h">Every 1 Hour</div>
                    <div class="param-btn" data-param="frequency" data-value="4h">Every 4 Hours</div>
                    <div class="param-btn" data-param="frequency" data-value="1d">Every Day</div>
                    <div class="param-btn" data-param="frequency" data-value="1w">Every Week</div>
                </div>
            </div>

            <!-- Amount Selection -->
            <div class="param-section">
                <h4>üí∞ Amount</h4>
                <div class="param-grid">
                    <div class="param-btn" data-param="amount" data-value="0.1">0.1 USDT</div>
                    <div class="param-btn" data-param="amount" data-value="1">1 USDT</div>
                    <div class="param-btn" data-param="amount" data-value="5">5 USDT</div>
                    <div class="param-btn" data-param="amount" data-value="10">10 USDT</div>
                    <div class="param-btn" data-param="amount" data-value="25">25 USDT</div>
                    <div class="param-btn" data-param="amount" data-value="50">50 USDT</div>
                </div>
            </div>

            <!-- Strategy Type -->
            <div class="param-section">
                <h4>üéØ Strategy</h4>
                <div class="param-grid">
                    <div class="param-btn" data-param="strategy" data-value="dca">DCA Only</div>
                    <div class="param-btn" data-param="strategy" data-value="tp">Take Profit</div>
                    <div class="param-btn" data-param="strategy" data-value="grid">Grid Trade</div>
                </div>
            </div>

            <!-- Take Profit Settings (Conditional) -->
            <div class="param-section" id="tpSettings" style="display: none;">
                <h4>üìà Take Profit</h4>
                <div class="param-grid">
                    <div class="param-btn" data-param="tp" data-value="2">2%</div>
                    <div class="param-btn" data-param="tp" data-value="5">5%</div>
                    <div class="param-btn" data-param="tp" data-value="10">10%</div>
                    <div class="param-btn" data-param="tp" data-value="15">15%</div>
                </div>
            </div>

            <!-- Action Buttons -->
            <button class="action-btn" onclick="startAutoInvest()">üöÄ Start Auto-Invest</button>
            <button class="action-btn" style="background: #ff4444;" onclick="closePanel()">‚úñÔ∏è Cancel</button>
        </div>

        <!-- Active Bots Panel -->
        <div class="trading-panel" style="display: block; margin-top: 20px;">
            <h3>ü§ñ Active Auto-Invests</h3>
            <div id="activeBots">
                <p style="text-align: center; color: #888;">No active bots yet</p>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // Current selection state
        let currentSelection = {
            coin: null,
            frequency: null,
            amount: null,
            strategy: 'dca',
            takeProfit: null
        };

        // Crypto data with real symbols
        const cryptocurrencies = [
            { symbol: 'BTC', name: 'Bitcoin', price: 43450.25, change: 2.34 },
            { symbol: 'ETH', name: 'Ethereum', price: 2380.67, change: 1.56 },
            { symbol: 'BNB', name: 'Binance Coin', price: 312.89, change: -0.23 },
            { symbol: 'SOL', name: 'Solana', price: 102.45, change: 5.67 },
            { symbol: 'XRP', name: 'Ripple', price: 0.6234, change: 0.89 },
            { symbol: 'ADA', name: 'Cardano', price: 0.5123, change: -1.23 },
            { symbol: 'DOT', name: 'Polkadot', price: 7.89, change: 3.45 },
            { symbol: 'DOGE', name: 'Dogecoin', price: 0.0987, change: 2.11 },
            { symbol: 'AVAX', name: 'Avalanche', price: 34.56, change: 4.32 }
        ];

        // Initialize the bubble grid
        function initializeBubbles() {
            const grid = document.getElementById('bubblesGrid');
            grid.innerHTML = '';

            cryptocurrencies.forEach(coin => {
                const bubble = document.createElement('div');
                bubble.className = 'coin-bubble';
                bubble.innerHTML = `
                    <div class="coin-symbol">${coin.symbol}</div>
                    <div class="coin-price">$${coin.price.toLocaleString()}</div>
                    <div class="coin-change ${coin.change >= 0 ? 'change-up' : 'change-down'}">
                        ${coin.change >= 0 ? '‚Üó' : '‚Üò'} ${Math.abs(coin.change)}%
                    </div>
                `;
                
                bubble.addEventListener('click', () => openTradingPanel(coin));
                grid.appendChild(bubble);
            });
        }

        // Open trading panel when coin is clicked
        function openTradingPanel(coin) {
            currentSelection.coin = coin;
            
            document.getElementById('selectedCoin').textContent = `${coin.symbol}/USDT`;
            document.getElementById('tradingPanel').style.display = 'block';
            
            // Scroll to panel
            document.getElementById('tradingPanel').scrollIntoView({ behavior: 'smooth' });
            
            // Reset selections
            resetSelections();
        }

        // Close trading panel
        function closePanel() {
            document.getElementById('tradingPanel').style.display = 'none';
            resetSelections();
        }

        // Reset all selections
        function resetSelections() {
            currentSelection.frequency = null;
            currentSelection.amount = null;
            currentSelection.strategy = 'dca';
            currentSelection.takeProfit = null;
            
            // Clear selected buttons
            document.querySelectorAll('.param-btn.selected').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Hide TP settings
            document.getElementById('tpSettings').style.display = 'none';
        }

        // Parameter button click handler
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('param-btn')) {
                const param = e.target.dataset.param;
                const value = e.target.dataset.value;
                
                // Remove selected class from siblings
                const siblings = e.target.parentElement.querySelectorAll('.param-btn');
                siblings.forEach(sib => sib.classList.remove('selected'));
                
                // Add selected class to clicked button
                e.target.classList.add('selected');
                
                // Update current selection
                currentSelection[param] = value;
                
                // Show/hide TP settings based on strategy
                if (param === 'strategy') {
                    if (value === 'tp') {
                        document.getElementById('tpSettings').style.display = 'block';
                    } else {
                        document.getElementById('tpSettings').style.display = 'none';
                        currentSelection.takeProfit = null;
                    }
                }
            }
        });

        // Start auto-invest bot
        function startAutoInvest() {
            // Validate selection
            if (!currentSelection.coin) {
                tg.showAlert('Please select a coin');
                return;
            }
            if (!currentSelection.frequency) {
                tg.showAlert('Please select frequency');
                return;
            }
            if (!currentSelection.amount) {
                tg.showAlert('Please select amount');
                return;
            }
            if (currentSelection.strategy === 'tp' && !currentSelection.takeProfit) {
                tg.showAlert('Please select take profit percentage');
                return;
            }

            // Create bot configuration
            const botConfig = {
                id: Date.now(),
                coin: currentSelection.coin.symbol,
                frequency: currentSelection.frequency,
                amount: parseFloat(currentSelection.amount),
                strategy: currentSelection.strategy,
                takeProfit: currentSelection.takeProfit ? parseInt(currentSelection.takeProfit) : null,
                status: 'running',
                createdAt: new Date().toLocaleString()
            };

            // Save to localStorage (or send to backend)
            saveBot(botConfig);
            
            // Show success message
            let message = `‚úÖ ${botConfig.coin} Auto-Invest Started!\n`;
            message += `Amount: ${botConfig.amount} USDT\n`;
            message += `Frequency: Every ${getFrequencyText(botConfig.frequency)}\n`;
            if (botConfig.takeProfit) {
                message += `Take Profit: ${botConfig.takeProfit}%`;
            }
            
            tg.showAlert(message);
            closePanel();
            updateActiveBots();
        }

        // Helper function to get frequency text
        function getFrequencyText(freq) {
            const freqMap = {
                '1h': '1 Hour',
                '4h': '4 Hours', 
                '1d': 'Day',
                '1w': 'Week'
            };
            return freqMap[freq] || freq;
        }

        // Save bot to localStorage
        function saveBot(botConfig) {
            let bots = JSON.parse(localStorage.getItem('autoInvestBots') || '[]');
            bots.push(botConfig);
            localStorage.setItem('autoInvestBots', JSON.stringify(bots));
        }

        // Update active bots display
        function updateActiveBots() {
            const bots = JSON.parse(localStorage.getItem('autoInvestBots') || '[]');
            const container = document.getElementById('activeBots');
            
            if (bots.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #888;">No active bots yet</p>';
                return;
            }
            
            container.innerHTML = bots.map(bot => `
                <div style="background: #2d2d44; padding: 15px; border-radius: 10px; margin: 10px 0;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${bot.coin}</strong> - ${bot.amount} USDT
                        </div>
                        <span style="color: #00ff88;">${bot.status}</span>
                    </div>
                    <div style="font-size: 12px; color: #888; margin-top: 5px;">
                        Every ${getFrequencyText(bot.frequency)} ‚Ä¢ ${bot.strategy.toUpperCase()}
                        ${bot.takeProfit ? `‚Ä¢ TP: ${bot.takeProfit}%` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeBubbles();
            updateActiveBots();
            
            // Simulate live price updates
            setInterval(() => {
                // In real app, this would fetch from Binance API
                initializeBubbles();
            }, 30000);
        });
    </script>
</body>
</html>
