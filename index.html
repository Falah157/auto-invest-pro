<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAMILY LINK | AUTO LOGIN</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }
        
        :root {
            --matrix-green: #00ff00;
            --matrix-dark: #0a0a0a;
            --matrix-darker: #001100;
            --matrix-border: #004400;
            --matrix-red: #ff3333;
            --matrix-yellow: #ffff00;
            --matrix-blue: #0099ff;
        }
        
        body {
            background-color: var(--matrix-dark);
            color: var(--matrix-green);
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }
        
        /* Login Screens */
        .login-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
            text-align: center;
        }
        
        .main-screen {
            display: none;
        }
        
        /* Header */
        .header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--matrix-green);
            margin-bottom: 30px;
        }
        
        .glitch {
            font-size: 2rem;
            font-weight: bold;
            text-transform: uppercase;
            position: relative;
            text-shadow: 0.05em 0 0 var(--matrix-red), -0.05em -0.025em 0 var(--matrix-blue);
            animation: glitch 500ms infinite;
        }
        
        @keyframes glitch {
            0% { text-shadow: 0.05em 0 0 var(--matrix-red), -0.05em -0.025em 0 var(--matrix-blue); }
            14% { text-shadow: 0.05em 0 0 var(--matrix-red), -0.05em -0.025em 0 var(--matrix-blue); }
            15% { text-shadow: -0.05em -0.025em 0 var(--matrix-red), 0.025em 0.025em 0 var(--matrix-blue); }
            49% { text-shadow: -0.05em -0.025em 0 var(--matrix-red), 0.025em 0.025em 0 var(--matrix-blue); }
            50% { text-shadow: 0.025em 0.05em 0 var(--matrix-red), 0.05em 0 0 var(--matrix-blue); }
            99% { text-shadow: 0.025em 0.05em 0 var(--matrix-red), 0.05em 0 0 var(--matrix-blue); }
            100% { text-shadow: -0.025em 0 0 var(--matrix-red), -0.025em -0.025em 0 var(--matrix-blue); }
        }
        
        /* Login Cards */
        .login-card {
            background: rgba(0, 20, 0, 0.3);
            border: 1px solid var(--matrix-border);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            max-width: 400px;
            width: 100%;
            backdrop-filter: blur(10px);
        }
        
        .login-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--matrix-green);
        }
        
        .login-subtitle {
            color: #008800;
            margin-bottom: 25px;
            font-size: 0.9rem;
        }
        
        /* Google Sign In Button */
        .gsi-btn {
            background: white;
            border: 1px solid #dadce0;
            border-radius: 4px;
            color: #3c4043;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            height: 40px;
            padding: 0 24px;
            text-align: center;
            width: 100%;
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s ease;
        }
        
        .gsi-btn:hover {
            background: #f8f9fa;
            box-shadow: 0 1px 3px 1px rgba(66, 64, 67, 0.15);
        }
        
        .auto-login-btn {
            background: transparent;
            border: 1px solid var(--matrix-green);
            color: var(--matrix-green);
            border-radius: 8px;
            padding: 15px;
            width: 100%;
            margin: 10px 0;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .auto-login-btn:hover {
            background: var(--matrix-green);
            color: #000;
        }
        
        /* User Profile */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 30, 0, 0.2);
            border-radius: 10px;
            border: 1px solid var(--matrix-border);
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--matrix-green);
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .user-email {
            color: #008800;
            font-size: 0.9rem;
        }
        
        /* Status */
        .status-bar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .status-item {
            background: rgba(0, 30, 0, 0.3);
            border: 1px solid var(--matrix-border);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .status-value {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .status-label {
            font-size: 0.8rem;
            color: #008800;
        }
        
        /* Controls */
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .control-btn {
            background: transparent;
            border: 1px solid var(--matrix-green);
            color: var(--matrix-green);
            padding: 12px 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .control-btn:hover {
            background: var(--matrix-green);
            color: #000;
        }
        
        /* Console */
        .console {
            background: #000;
            border: 1px solid var(--matrix-border);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            height: 120px;
            overflow-y: auto;
            font-size: 0.8rem;
        }
        
        .console-line {
            margin-bottom: 5px;
        }
        
        .console-line::before {
            content: "> ";
            color: var(--matrix-green);
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #008800;
            border-radius: 50%;
            border-top-color: var(--matrix-green);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Footer */
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            border-top: 1px solid var(--matrix-border);
            color: #008800;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="container">
        <div class="login-screen" id="loginScreen">
            <div class="header">
                <div class="glitch">FAMILY LINK CONTROL</div>
                <div class="subtitle">GOOGLE ACCOUNT INTEGRATION</div>
            </div>
            
            <div class="login-card">
                <div class="login-title">üîê AUTHENTICATION REQUIRED</div>
                <div class="login-subtitle">Connect your Google Account to access Family Link controls</div>
                
                <!-- Google Sign In Button -->
                <div id="gsiBtn" class="gsi-btn">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=" alt="Google">
                    Sign in with Google
                </div>
                
                <!-- Auto Login Button -->
                <button class="auto-login-btn" onclick="attemptAutoLogin()">
                    <span style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span class="loading" id="autoLoginLoading"></span>
                        AUTO LOGIN
                    </span>
                </button>
                
                <div style="font-size: 0.8rem; color: #008800; margin-top: 15px;">
                    üîí Secure OAuth 2.0 authentication
                </div>
            </div>
            
            <div class="login-card">
                <div class="login-title">‚ÑπÔ∏è HOW IT WORKS</div>
                <div style="text-align: left; font-size: 0.9rem; line-height: 1.4;">
                    <div style="margin-bottom: 10px;">‚úÖ <strong>One-time setup</strong> - Login once</div>
                    <div style="margin-bottom: 10px;">‚úÖ <strong>Auto-login</strong> - Automatic future access</div>
                    <div style="margin-bottom: 10px;">‚úÖ <strong>Secure</strong> - Encrypted token storage</div>
                    <div>‚úÖ <strong>Family Link Access</strong> - Full parental controls</div>
                </div>
            </div>
        </div>
        
        <!-- Main App Screen -->
        <div class="main-screen" id="mainScreen">
            <div class="header">
                <div class="glitch">FAMILY LINK CONTROL</div>
                <div class="subtitle">ACTIVE - GOOGLE ACCOUNT CONNECTED</div>
            </div>
            
            <!-- User Profile -->
            <div class="user-profile">
                <img id="userAvatar" class="user-avatar" src="" alt="User Avatar">
                <div class="user-info">
                    <div class="user-name" id="userName">Loading...</div>
                    <div class="user-email" id="userEmail">Loading...</div>
                </div>
                <button class="control-btn" onclick="logout()" style="padding: 8px 12px;">
                    üîì Logout
                </button>
            </div>
            
            <!-- Status Bar -->
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-value" id="connectedKids">2</div>
                    <div class="status-label">CONNECTED KIDS</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="apiStatus">ONLINE</div>
                    <div class="status-label">FAMILY LINK API</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="loginStatus">AUTO</div>
                    <div class="status-label">LOGIN TYPE</div>
                </div>
            </div>
            
            <!-- Quick Controls -->
            <div class="controls-grid">
                <button class="control-btn" onclick="viewKids()">
                    <span style="font-size: 1.3rem;">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                    VIEW KIDS
                </button>
                <button class="control-btn" onclick="setLimits()">
                    <span style="font-size: 1.3rem;">‚è∞</span>
                    TIME LIMITS
                </button>
                <button class="control-btn" onclick="checkLocations()">
                    <span style="font-size: 1.3rem;">üìç</span>
                    LOCATIONS
                </button>
                <button class="control-btn" onclick="manageApps()">
                    <span style="font-size: 1.3rem;">üì±</span>
                    APP CONTROLS
                </button>
                <button class="control-btn" onclick="viewReports()">
                    <span style="font-size: 1.3rem;">üìä</span>
                    REPORTS
                </button>
                <button class="control-btn" onclick="settings()">
                    <span style="font-size: 1.3rem;">‚öôÔ∏è</span>
                    SETTINGS
                </button>
            </div>
            
            <!-- System Console -->
            <div class="console" id="console">
                <div class="console-line">System initialized</div>
                <div class="console-line">Google OAuth 2.0: Authenticated</div>
                <div class="console-line">Family Link API: Connected</div>
                <div class="console-line" id="lastCommand">Ready for commands...</div>
            </div>
        </div>
        
        <div class="footer">
            GOOGLE FAMILY LINK API | SECURE OAUTH 2.0 | AUTO-LOGIN ENABLED
        </div>
    </div>

    <script>
        // Google OAuth Configuration
        const GOOGLE_CLIENT_ID = 'YOUR_GOOGLE_CLIENT_ID'; // You need to get this from Google Cloud Console
        const GOOGLE_SCOPES = [
            'https://www.googleapis.com/auth/userinfo.profile',
            'https://www.googleapis.com/auth/userinfo.email',
            'https://www.googleapis.com/auth/kid.family.readonly',
            'https://www.googleapis.com/auth/kid.family'
        ].join(' ');
        
        // Token storage keys
        const STORAGE_KEYS = {
            ACCESS_TOKEN: 'google_access_token',
            REFRESH_TOKEN: 'google_refresh_token',
            USER_INFO: 'google_user_info',
            EXPIRY_TIME: 'token_expiry_time'
        };
        
        let currentUser = null;
        
        // Initialize Google OAuth
        function initializeGoogleAuth() {
            // Google Sign-In button event
            document.getElementById('gsiBtn').addEventListener('click', handleGoogleSignIn);
            
            // Check for existing authentication
            checkExistingAuth();
        }
        
        // Handle Google Sign-In
        function handleGoogleSignIn() {
            addToConsole('Initiating Google OAuth 2.0 flow...');
            
            // Simulate Google OAuth flow (in real app, this would use Google Identity Services)
            simulateGoogleOAuth();
        }
        
        // Simulated Google OAuth (Replace with real implementation)
        function simulateGoogleOAuth() {
            addToConsole('Redirecting to Google authentication...');
            
            // Show loading state
            document.getElementById('gsiBtn').innerHTML = '<div class="loading"></div> Authenticating...';
            document.getElementById('gsiBtn').style.opacity = '0.7';
            
            // Simulate OAuth process
            setTimeout(() => {
                // Mock successful authentication
                const mockUser = {
                    name: 'John Parent',
                    email: 'john.parent@example.com',
                    picture: 'https://via.placeholder.com/50/00ff00/000000?text=JP',
                    accessToken: 'mock_access_token_' + Date.now(),
                    refreshToken: 'mock_refresh_token_' + Date.now(),
                    expiryTime: Date.now() + (60 * 60 * 1000) // 1 hour
                };
                
                // Store tokens and user info
                storeAuthData(mockUser);
                handleAuthSuccess(mockUser);
                
            }, 2000);
        }
        
        // Check for existing authentication
        function checkExistingAuth() {
            addToConsole('Checking for existing authentication...');
            
            const accessToken = localStorage.getItem(STORAGE_KEYS.ACCESS_TOKEN);
            const userInfo = localStorage.getItem(STORAGE_KEYS.USER_INFO);
            const expiryTime = localStorage.getItem(STORAGE_KEYS.EXPIRY_TIME);
            
            if (accessToken && userInfo && expiryTime) {
                const now = Date.now();
                if (now < parseInt(expiryTime)) {
                    // Token is still valid
                    const user = JSON.parse(userInfo);
                    addToConsole('‚úÖ Valid session found - auto-login initiated');
                    handleAuthSuccess(user);
                } else {
                    // Token expired, try to refresh
                    addToConsole('üîÑ Session expired - attempting refresh...');
                    attemptTokenRefresh();
                }
            } else {
                addToConsole('No existing session found');
            }
        }
        
        // Attempt automatic login
        function attemptAutoLogin() {
            addToConsole('Attempting automatic login...');
            
            const loadingElement = document.getElementById('autoLoginLoading');
            loadingElement.style.display = 'inline-block';
            
            // Check for existing valid session
            setTimeout(() => {
                const accessToken = localStorage.getItem(STORAGE_KEYS.ACCESS_TOKEN);
                const userInfo = localStorage.getItem(STORAGE_KEYS.USER_INFO);
                
                if (accessToken && userInfo) {
                    const user = JSON.parse(userInfo);
                    addToConsole('‚úÖ Auto-login successful!');
                    handleAuthSuccess(user);
                } else {
                    addToConsole('‚ùå No saved credentials - please sign in manually');
                    alert('No saved login found. Please sign in with Google first.');
                }
                
                loadingElement.style.display = 'none';
            }, 1500);
        }
        
        // Store authentication data
        function storeAuthData(user) {
            localStorage.setItem(STORAGE_KEYS.ACCESS_TOKEN, user.accessToken);
            localStorage.setItem(STORAGE_KEYS.REFRESH_TOKEN, user.refreshToken);
            localStorage.setItem(STORAGE_KEYS.USER_INFO, JSON.stringify(user));
            localStorage.setItem(STORAGE_KEYS.EXPIRY_TIME, user.expiryTime.toString());
            
            addToConsole('üîê Authentication data stored securely');
        }
        
        // Handle successful authentication
        function handleAuthSuccess(user) {
            currentUser = user;
            
            // Update UI
            document.getElementById('userName').textContent = user.name;
            document.getElementById('userEmail').textContent = user.email;
            document.getElementById('userAvatar').src = user.picture;
            
            // Switch to main screen
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainScreen').style.display = 'block';
            
            addToConsole(`‚úÖ Authenticated as: ${user.name}`);
            addToConsole(`üìß Email: ${user.email}`);
            addToConsole('üîó Connecting to Family Link API...');
            
            // Initialize Family Link integration
            initializeFamilyLink();
        }
        
        // Attempt token refresh
        function attemptTokenRefresh() {
            const refreshToken = localStorage.getItem(STORAGE_KEYS.REFRESH_TOKEN);
            
            if (refreshToken) {
                addToConsole('üîÑ Refreshing access token...');
                
                // Simulate token refresh
                setTimeout(() => {
                    const mockUser = {
                        name: 'John Parent',
                        email: 'john.parent@example.com',
                        picture: 'https://via.placeholder.com/50/00ff00/000000?text=JP',
                        accessToken: 'refreshed_access_token_' + Date.now(),
                        refreshToken: refreshToken,
                        expiryTime: Date.now() + (60 * 60 * 1000) // 1 hour
                    };
                    
                    storeAuthData(mockUser);
                    handleAuthSuccess(mockUser);
                    addToConsole('‚úÖ Token refreshed successfully');
                    
                }, 1000);
            } else {
                addToConsole('‚ùå No refresh token available');
            }
        }
        
        // Logout function
        function logout() {
            addToConsole('üö™ Logging out...');
            
            // Clear stored data
            localStorage.removeItem(STORAGE_KEYS.ACCESS_TOKEN);
            localStorage.removeItem(STORAGE_KEYS.REFRESH_TOKEN);
            localStorage.removeItem(STORAGE_KEYS.USER_INFO);
            localStorage.removeItem(STORAGE_KEYS.EXPIRY_TIME);
            
            // Reset UI
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainScreen').style.display = 'none';
            document.getElementById('gsiBtn').innerHTML = `
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=" alt="Google">
                Sign in with Google
            `;
            document.getElementById('gsiBtn').style.opacity = '1';
            
            currentUser = null;
            addToConsole('‚úÖ Logout completed');
        }
        
        // Initialize Family Link integration
        function initializeFamilyLink() {
            addToConsole('üîó Initializing Family Link API connection...');
            
            setTimeout(() => {
                addToConsole('‚úÖ Family Link API connected successfully');
                document.getElementById('apiStatus').textContent = 'ONLINE';
                document.getElementById('connectedKids').textContent = '2';
                document.getElementById('loginStatus').textContent = 'AUTO';
            }, 2000);
        }
        
        // Control functions
        function viewKids() {
            addToConsole('Loading child profiles...');
            alert('Child profiles loaded');
        }
        
        function setLimits() {
            addToConsole('Opening time limits configuration...');
            alert('Time limits interface opened');
        }
        
        function checkLocations() {
            addToConsole('Fetching child device locations...');
            alert('Location data retrieved');
        }
        
        function manageApps() {
            addToConsole('Opening app management panel...');
            alert('App controls interface loaded');
        }
        
        function viewReports() {
            addToConsole('Generating usage reports...');
            alert('Reports generated');
        }
        
        function settings() {
            addToConsole('Opening settings panel...');
            alert('Settings interface loaded');
        }
        
        // Console logging
        function addToConsole(message) {
            const console = document.getElementById('console');
            const lastLine = document.getElementById('lastCommand');
            
            const newLine = document.createElement('div');
            newLine.className = 'console-line';
            newLine.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            
            console.insertBefore(newLine, lastLine);
            console.scrollTop = console.scrollHeight;
        }
        
        // Initialize app
        window.onload = function() {
            initializeGoogleAuth();
            addToConsole('Authentication system initialized');
            
            // Telegram WebApp integration
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
                addToConsole('Telegram WebApp integration active');
            }
        };
        
    </script>
</body>
</html>

