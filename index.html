<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            color: #1a1a1a;
            height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
        }

        @media (prefers-color-scheme: dark) {
            body {
                background: #1a1a1a;
                color: #ffffff;
            }
        }

        /* App Container */
        .app {
            height: 100vh;
            display: flex;
            flex-direction: column;
            max-width: 100%;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: #10a37f;
            color: white;
            padding: 12px 16px;
            text-align: center;
            position: relative;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .header h1 {
            font-size: 18px;
            font-weight: 600;
        }

        .menu-btn {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            padding-bottom: 80px;
            -webkit-overflow-scrolling: touch;
        }

        /* Messages */
        .message {
            margin-bottom: 20px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            text-align: right;
        }

        .ai-message {
            text-align: left;
        }

        .message-bubble {
            display: inline-block;
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .user-message .message-bubble {
            background: #10a37f;
            color: white;
            border-bottom-right-radius: 6px;
        }

        .ai-message .message-bubble {
            background: #f0f0f0;
            color: #1a1a1a;
            border-bottom-left-radius: 6px;
        }

        @media (prefers-color-scheme: dark) {
            .ai-message .message-bubble {
                background: #2d2d2d;
                color: #ffffff;
            }
        }

        .message-sender {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
            padding: 0 8px;
        }

        .message-time {
            font-size: 11px;
            color: #999;
            margin-top: 4px;
            padding: 0 8px;
        }

        /* Input Area */
        .input-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid #e0e0e0;
            padding: 12px 16px;
            padding-bottom: calc(12px + env(safe-area-inset-bottom));
        }

        @media (prefers-color-scheme: dark) {
            .input-container {
                background: rgba(26, 26, 26, 0.95);
                border-top: 1px solid #333;
            }
        }

        .input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            max-width: 100%;
        }

        .text-input {
            flex: 1;
            min-height: 44px;
            max-height: 120px;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 22px;
            background: #f8f8f8;
            font-size: 16px;
            line-height: 1.4;
            resize: none;
            outline: none;
            -webkit-appearance: none;
        }

        @media (prefers-color-scheme: dark) {
            .text-input {
                background: #2d2d2d;
                border-color: #444;
                color: white;
            }
        }

        .text-input:focus {
            border-color: #10a37f;
        }

        .send-button {
            width: 44px;
            height: 44px;
            background: #10a37f;
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .send-button:active {
            transform: scale(0.95);
            background: #0d8c6c;
        }

        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Welcome Screen */
        .welcome-screen {
            padding: 40px 20px;
            text-align: center;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .welcome-icon {
            font-size: 48px;
            color: #10a37f;
            margin-bottom: 20px;
        }

        .welcome-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .welcome-subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 40px;
        }

        @media (prefers-color-scheme: dark) {
            .welcome-subtitle {
                color: #999;
            }
        }

        .quick-actions {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            max-width: 400px;
            margin: 0 auto;
        }

        .quick-action {
            padding: 16px;
            background: #f8f8f8;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
        }

        @media (prefers-color-scheme: dark) {
            .quick-action {
                background: #2d2d2d;
                border-color: #444;
            }
        }

        .quick-action:active {
            transform: scale(0.98);
            background: #e8e8e8;
        }

        @media (prefers-color-scheme: dark) {
            .quick-action:active {
                background: #3d3d3d;
            }
        }

        .action-title {
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-desc {
            font-size: 14px;
            color: #666;
        }

        @media (prefers-color-scheme: dark) {
            .action-desc {
                color: #999;
            }
        }

        /* Typing Indicator */
        .typing-indicator {
            display: inline-flex;
            gap: 4px;
            padding: 12px 16px;
            background: #f0f0f0;
            border-radius: 18px;
            border-bottom-left-radius: 6px;
        }

        @media (prefers-color-scheme: dark) {
            .typing-indicator {
                background: #2d2d2d;
            }
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-5px);
                opacity: 1;
            }
        }

        /* Sidebar Menu */
        .sidebar {
            position: fixed;
            top: 0;
            left: -280px;
            width: 280px;
            height: 100%;
            background: #ffffff;
            border-right: 1px solid #e0e0e0;
            transition: transform 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
            padding-bottom: env(safe-area-inset-bottom);
        }

        @media (prefers-color-scheme: dark) {
            .sidebar {
                background: #1a1a1a;
                border-right: 1px solid #333;
            }
        }

        .sidebar.active {
            transform: translateX(280px);
        }

        .sidebar-header {
            padding: 60px 20px 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        @media (prefers-color-scheme: dark) {
            .sidebar-header {
                border-bottom: 1px solid #333;
            }
        }

        .sidebar-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .new-chat-btn {
            width: 100%;
            padding: 12px;
            background: #10a37f;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .new-chat-btn:active {
            background: #0d8c6c;
        }

        .chat-history {
            padding: 20px;
        }

        .chat-item {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            border: 1px solid #e0e0e0;
        }

        @media (prefers-color-scheme: dark) {
            .chat-item {
                border-color: #333;
            }
        }

        .chat-item:active {
            background: #f0f0f0;
        }

        @media (prefers-color-scheme: dark) {
            .chat-item:active {
                background: #2d2d2d;
            }
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .overlay.active {
            display: block;
        }

        /* Code blocks */
        .message-bubble pre {
            background: rgba(0,0,0,0.1);
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 8px 0;
            font-size: 14px;
        }

        @media (prefers-color-scheme: dark) {
            .message-bubble pre {
                background: rgba(255,255,255,0.1);
            }
        }

        /* Safe area support */
        @supports (padding: max(0px)) {
            .input-container {
                padding-bottom: max(12px, env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <div class="header">
            <button class="menu-btn" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <h1>AI Assistant</h1>
        </div>

        <!-- Chat Container -->
        <div class="chat-container" id="chatContainer">
            <!-- Welcome Screen -->
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-icon">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="welcome-title">How can I help you?</div>
                <div class="welcome-subtitle">Ask me anything about Quran, Science, Coding, or Languages</div>
                
                <div class="quick-actions">
                    <div class="quick-action" onclick="askQuestion('Explain Python programming for beginners')">
                        <div class="action-title">
                            <i class="fab fa-python"></i>
                            Learn Python
                        </div>
                        <div class="action-desc">Start coding with simple examples</div>
                    </div>
                    <div class="quick-action" onclick="askQuestion('Teach me about Quran and Islam')">
                        <div class="action-title">
                            <i class="fas fa-book-quran"></i>
                            Quran Studies
                        </div>
                        <div class="action-desc">Islamic knowledge and teachings</div>
                    </div>
                    <div class="quick-action" onclick="askQuestion('Explain physics and biology basics')">
                        <div class="action-title">
                            <i class="fas fa-atom"></i>
                            Science Help
                        </div>
                        <div class="action-desc">Physics, Biology, Mathematics</div>
                    </div>
                    <div class="quick-action" onclick="askQuestion('Teach me Arabic and Dhivehi languages')">
                        <div class="action-title">
                            <i class="fas fa-language"></i>
                            Learn Languages
                        </div>
                        <div class="action-desc">Arabic, English, Dhivehi</div>
                    </div>
                </div>
            </div>

            <!-- Chat messages will be added here dynamically -->
        </div>

        <!-- Input Area -->
        <div class="input-container">
            <div class="input-wrapper">
                <textarea 
                    class="text-input" 
                    id="messageInput"
                    placeholder="Type your message..."
                    rows="1"
                    onkeydown="handleKeyDown(event)"
                    oninput="autoResize(this)"
                ></textarea>
                <button class="send-button" onclick="sendMessage()" id="sendButton">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <!-- Sidebar Menu -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">AI Assistant</div>
                <button class="new-chat-btn" onclick="startNewChat()">
                    <i class="fas fa-plus"></i>
                    New Chat
                </button>
            </div>
            <div class="chat-history" id="chatHistory">
                <!-- Chat history will be populated here -->
            </div>
        </div>

        <!-- Overlay -->
        <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
    </div>

    <script>
        // Mobile-optimized knowledge database
        const knowledgeBase = {
            // Quran & Islam
            'quran': `The Quran is Islam's holy book, revealed to Prophet Muhammad (PBUH). It has 114 chapters with guidance for life.

ðŸ“– **Key Points:**
â€¢ Revealed over 23 years
â€¢ Perfectly preserved in Arabic
â€¢ Covers faith, morality, law
â€¢ Emphasizes compassion and justice

I can explain specific verses or Islamic concepts.`,

            'islam': `Islam is based on five pillars:

1. **Shahada** - Faith declaration
2. **Salah** - 5 daily prayers
3. **Zakat** - Charity (2.5%)
4. **Sawm** - Ramadan fasting
5. **Hajj** - Mecca pilgrimage

Islam promotes peace, equality, and knowledge.`,

            // Programming
            'python': `Python is perfect for beginners! ðŸ

ðŸ’» **Why Python:**
â€¢ Simple, readable code
â€¢ Great for web, data, AI
â€¢ Huge community support
â€¢ Lots of free resources

**Try this code:**
\`\`\`python
name = input("What's your name? ")
print(f"Hello {name}!")
\`\`\``,

            'java': `Java for mobile and big apps:

ðŸ“± **Java Features:**
â€¢ "Write once, run anywhere"
â€¢ Used for Android apps
â€¢ Strong typing system
â€¢ Great for large projects

**Example:**
\`\`\`java
public class Hello {
    public static void main(String[] args) {
        System.out.println("Hello World!");
    }
}
\`\`\``,

            // Science
            'physics': `Physics studies matter and energy:

âš›ï¸ **Main Areas:**
â€¢ Motion and forces
â€¢ Energy and heat
â€¢ Electricity and magnets
â€¢ Atoms and quantum physics

**Fun Fact:** Everything in universe follows physics laws!`,

            'biology': `Biology = Science of Life ðŸŒ±

ðŸ”¬ **What it studies:**
â€¢ Cells and DNA
â€¢ Plants and animals
â€¢ Evolution and genetics
â€¢ Ecosystems and environment

**Key Idea:** All living things are connected.`,

            // Languages
            'arabic': `Arabic - Language of Quran ðŸ“–

ðŸ•Œ **Basics:**
â€¢ Written right to left
â€¢ 28 letters
â€¢ Root word system
â€¢ Classical & modern forms

**Useful phrases:**
â€¢ Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… - Hello
â€¢ Ø´ÙƒØ±Ø§Ù‹ - Thank you
â€¢ ÙƒÙŠÙ Ø­Ø§Ù„ÙƒØŸ - How are you?`,

            'dhivehi': `Dhivehi - Language of Maldives ðŸï¸

ðŸŒ´ **Features:**
â€¢ Thaana script
â€¢ Right to left writing
â€¢ Arabic influences
â€¢ Unique sound system

**Basic phrases:**
â€¢ Þ‡Þ¦Þ‡Þ°ÞÞ¦ÞÞ§Þ‰Þª Þ¢Þ¦ÞÞ¦Þ‡Þ¨Þ†ÞªÞ‰Þ° - Hello
â€¢ ÞÞªÞ†ÞªÞƒÞ¨Þ‡Þ°Þ”Þ§ - Thank you
â€¢ Þ€Þ§ÞÞª Þ†Þ¨Þ€Þ¨Þ‚Þ¬ÞŒÞ°ØŸ - How are you?`
        };

        // Chat management
        let currentChat = [];
        let chatHistory = JSON.parse(localStorage.getItem('mobile_chats')) || {};
        let activeChatId = null;

        function initApp() {
            loadChatHistory();
            updateSendButton();
            // Focus input on startup
            setTimeout(() => {
                document.getElementById('messageInput').focus();
            }, 500);
        }

        function startNewChat() {
            activeChatId = 'chat_' + Date.now();
            currentChat = [];
            chatHistory[activeChatId] = {
                title: 'New Chat',
                messages: [],
                createdAt: new Date().toISOString()
            };
            
            showChatInterface();
            saveChats();
            updateChatHistorySidebar();
            toggleSidebar(); // Close sidebar on mobile
        }

        function showChatInterface() {
            document.getElementById('welcomeScreen').style.display = 'none';
            renderChatMessages();
            // Scroll to bottom
            setTimeout(() => {
                document.getElementById('chatContainer').scrollTop = document.getElementById('chatContainer').scrollHeight;
            }, 100);
        }

        function showWelcomeScreen() {
            document.getElementById('welcomeScreen').style.display = 'flex';
            currentChat = [];
            activeChatId = null;
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            if (!activeChatId) {
                startNewChat();
            }
            
            // Add user message
            addMessage('user', message);
            input.value = '';
            autoResize(input);
            updateSendButton();
            
            // Hide keyboard on mobile after sending
            input.blur();
            
            // Show typing indicator
            showTypingIndicator();
            
            // Generate AI response
            setTimeout(() => {
                removeTypingIndicator();
                const response = generateAIResponse(message);
                addMessage('ai', response);
                
                // Auto-scroll to bottom
                setTimeout(() => {
                    document.getElementById('chatContainer').scrollTop = document.getElementById('chatContainer').scrollHeight;
                }, 100);
            }, 1000 + Math.random() * 1000);
        }

        function askQuestion(question) {
            document.getElementById('messageInput').value = question;
            sendMessage();
        }

        function addMessage(role, content) {
            const message = { 
                role, 
                content, 
                timestamp: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            };
            currentChat.push(message);
            
            if (activeChatId) {
                chatHistory[activeChatId].messages.push(message);
                
                // Update chat title with first message
                if (chatHistory[activeChatId].messages.length === 1) {
                    const title = content.length > 25 ? content.substring(0, 25) + '...' : content;
                    chatHistory[activeChatId].title = title;
                }
            }
            
            renderChatMessages();
            saveChats();
            updateChatHistorySidebar();
        }

        function renderChatMessages() {
            const container = document.getElementById('chatContainer');
            
            // Don't render welcome screen if we have messages
            if (currentChat.length > 0) {
                document.getElementById('welcomeScreen').style.display = 'none';
                
                let messagesHTML = '';
                currentChat.forEach(message => {
                    messagesHTML += `
                        <div class="message ${message.role}-message">
                            <div class="message-sender">${message.role === 'user' ? 'You' : 'AI Assistant'}</div>
                            <div class="message-bubble">${formatMessageContent(message.content)}</div>
                            <div class="message-time">${message.timestamp}</div>
                        </div>
                    `;
                });
                
                container.innerHTML = messagesHTML;
            } else {
                showWelcomeScreen();
            }
        }

        function formatMessageContent(content) {
            // Convert markdown-like formatting to HTML
            return content
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/```([^`]+)```/g, '<pre>$1</pre>')
                .replace(/\n/g, '<br>');
        }

        function showTypingIndicator() {
            const container = document.getElementById('chatContainer');
            const indicator = document.createElement('div');
            indicator.className = 'message ai-message';
            indicator.id = 'typingIndicator';
            
            indicator.innerHTML = `
                <div class="message-sender">AI Assistant</div>
                <div class="message-bubble">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            
            container.appendChild(indicator);
            container.scrollTop = container.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function generateAIResponse(question) {
            const lowerQuestion = question.toLowerCase();
            
            // Check for specific topics
            for (const [topic, response] of Object.entries(knowledgeBase)) {
                if (lowerQuestion.includes(topic)) {
                    return response;
                }
            }
            
            // Contextual responses
            if (lowerQuestion.includes('python') || lowerQuestion.includes('programming') || lowerQuestion.includes('code')) {
                return knowledgeBase.python + "\n\nWant to learn more about programming?";
            }
            
            if (lowerQuestion.includes('quran') || lowerQuestion.includes('islam') || lowerQuestion.includes('muslim')) {
                return knowledgeBase.quran + "\n\nI can explain Islamic concepts or Quran verses. What would you like to know?";
            }
            
            if (lowerQuestion.includes('physics') || lowerQuestion.includes('biology') || lowerQuestion.includes('science')) {
                return knowledgeBase.physics + "\n\n" + knowledgeBase.biology + "\n\nWhich science topic interests you most?";
            }
            
            if (lowerQuestion.includes('arabic') || lowerQuestion.includes('dhivehi') || lowerQuestion.includes('language')) {
                return knowledgeBase.arabic + "\n\n" + knowledgeBase.dhivehi + "\n\nReady to learn some phrases?";
            }
            
            // Default response
            return `I can help you learn about:

ðŸ“– **Quran & Islam** - Islamic teachings and principles
ðŸ’» **Programming** - Python, Java, coding basics  
ðŸ”¬ **Science** - Physics, Biology, Mathematics
ðŸŒ **Languages** - Arabic, English, Dhivehi

What would you like to explore? Ask me anything!`;
        }

        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
            updateSendButton();
        }

        function updateSendButton() {
            const input = document.getElementById('messageInput');
            const button = document.getElementById('sendButton');
            button.disabled = !input.value.trim();
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        function loadChatHistory() {
            updateChatHistorySidebar();
        }

        function updateChatHistorySidebar() {
            const container = document.getElementById('chatHistory');
            container.innerHTML = '';
            
            const chats = Object.entries(chatHistory)
                .sort(([,a], [,b]) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 10); // Only show last 10 chats on mobile
            
            if (chats.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No chat history</div>';
                return;
            }
            
            chats.forEach(([id, chat]) => {
                const item = document.createElement('div');
                item.className = 'chat-item';
                item.innerHTML = `
                    <div style="font-weight: 500; margin-bottom: 4px;">${chat.title}</div>
                    <div style="font-size: 12px; color: #666;">${new Date(chat.createdAt).toLocaleDateString()}</div>
                `;
                
                item.onclick = () => {
                    loadChat(id);
                    toggleSidebar();
                };
                container.appendChild(item);
            });
        }

        function loadChat(chatId) {
            activeChatId = chatId;
            currentChat = [...chatHistory[chatId].messages];
            showChatInterface();
        }

        function saveChats() {
            localStorage.setItem('mobile_chats', JSON.stringify(chatHistory));
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', initApp);

        // Prevent zoom on double-tap
        document.addEventListener('touchend', function(e) {
            if (e.touches && e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>
