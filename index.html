<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FaithTask - Islamic Task Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2E7D32;
            --primary-dark: #1B5E20;
            --primary-light: #4CAF50;
            --secondary: #8E24AA;
            --accent: #FF9800;
            --light: #F5F5F5;
            --dark: #333;
            --gray: #757575;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --radius: 12px;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--dark);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--primary);
        }

        .logo h1 {
            font-family: 'Amiri', serif;
            color: var(--primary-dark);
            font-size: 2.2rem;
        }

        .tagline {
            color: var(--gray);
            font-size: 1rem;
        }

        .date-display {
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--primary);
            background: #E8F5E9;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .streak {
            color: var(--accent) !important;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section-title {
            font-family: 'Amiri', serif;
            font-size: 1.5rem;
            color: var(--primary-dark);
            margin: 25px 0 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #E0E0E0;
        }

        .task-category {
            margin-bottom: 30px;
        }

        .task-list {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .task-item {
            padding: 18px 20px;
            border-bottom: 1px solid #EEEEEE;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s;
        }

        .task-item:hover {
            background: #F9F9F9;
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-info {
            flex: 1;
        }

        .task-name {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .task-desc {
            font-size: 0.85rem;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .task-desc i {
            font-size: 0.8rem;
        }

        .task-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .task-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid #DDD;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .task-checkbox.completed {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .task-checkbox.completed i {
            font-size: 0.9rem;
        }

        .task-time {
            font-size: 0.8rem;
            color: var(--gray);
            background: #F5F5F5;
            padding: 3px 8px;
            border-radius: 10px;
        }

        .notification-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .notification-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .notification-content {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: var(--radius);
            overflow: hidden;
            transform: translateY(20px);
            transition: transform 0.3s;
        }

        .notification-modal.active .notification-content {
            transform: translateY(0);
        }

        .notification-header {
            background: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .notification-header i {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .notification-header h3 {
            font-family: 'Amiri', serif;
            font-size: 1.8rem;
        }

        .notification-body {
            padding: 25px;
            text-align: center;
        }

        .notification-verse {
            font-family: 'Amiri', serif;
            font-size: 1.2rem;
            color: var(--primary-dark);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .notification-message {
            font-size: 1rem;
            color: var(--dark);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .notification-source {
            font-size: 0.9rem;
            color: var(--gray);
            font-style: italic;
            margin-bottom: 25px;
        }

        .notification-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: #F5F5F5;
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: #E0E0E0;
        }

        .progress-bar {
            height: 8px;
            background: #E0E0E0;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 4px;
            width: 0%;
            transition: width 0.5s;
        }

        .daily-progress {
            background: white;
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .prayer-times {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .prayer-card {
            background: white;
            padding: 15px;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: var(--shadow);
        }

        .prayer-name {
            font-weight: 500;
            color: var(--primary-dark);
            margin-bottom: 8px;
        }

        .prayer-time {
            font-size: 1.2rem;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .prayer-status {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 10px;
            display: inline-block;
        }

        .prayer-completed {
            background: #E8F5E9;
            color: var(--primary);
        }

        .prayer-pending {
            background: #FFF3E0;
            color: #EF6C00;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #E0E0E0;
        }

        @media (max-width: 600px) {
            .stats-bar {
                grid-template-columns: 1fr;
            }
            
            .prayer-times {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-mosque"></i>
                <h1>FaithTask</h1>
            </div>
            <p class="tagline">Islamic Task Manager - Combining Faith & Productivity</p>
            <div class="date-display" id="currentDate">
                <!-- Date will be inserted by JS -->
            </div>
        </header>

        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-value streak" id="streakCount">0</div>
                <div class="stat-label">Day Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="completedToday">0</div>
                <div class="stat-label">Completed Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalTasks">14</div>
                <div class="stat-label">Total Tasks</div>
            </div>
        </div>

        <div class="daily-progress">
            <div class="progress-text">
                <span>Today's Progress</span>
                <span id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="daily">Daily</div>
            <div class="tab" data-tab="weekly">Weekly</div>
            <div class="tab" data-tab="monthly">Monthly</div>
        </div>

        <!-- DAILY TAB CONTENT -->
        <div class="tab-content active" id="daily-tab">
            <h2 class="section-title">Today's Prayers</h2>
            <div class="prayer-times" id="prayerContainer">
                <!-- Prayer cards will be generated by JS -->
            </div>

            <h2 class="section-title">Daily Tasks & Ibadah</h2>
            <div class="task-list" id="dailyTasks">
                <!-- Daily tasks will be generated by JS -->
            </div>
        </div>

        <!-- WEEKLY TAB CONTENT -->
        <div class="tab-content" id="weekly-tab">
            <h2 class="section-title">Weekly Goals</h2>
            <div class="task-list" id="weeklyTasks">
                <!-- Weekly tasks will be generated by JS -->
            </div>
        </div>

        <!-- MONTHLY TAB CONTENT -->
        <div class="tab-content" id="monthly-tab">
            <h2 class="section-title">Monthly Goals</h2>
            <div class="empty-state">
                <i class="fas fa-calendar-alt"></i>
                <p>Monthly goals will appear here</p>
                <p>Set your goals at the beginning of each month</p>
            </div>
        </div>
    </div>

    <!-- NOTIFICATION MODAL -->
    <div class="notification-modal" id="notificationModal">
        <div class="notification-content">
            <div class="notification-header">
                <i class="fas fa-star"></i>
                <h3>MashaAllah!</h3>
            </div>
            <div class="notification-body">
                <div class="notification-verse" id="notificationVerse">
                    <!-- Verse will be inserted by JS -->
                </div>
                <div class="notification-message" id="notificationMessage">
                    <!-- Message will be inserted by JS -->
                </div>
                <div class="notification-source" id="notificationSource">
                    <!-- Source will be inserted by JS -->
                </div>
                <div class="notification-actions">
                    <button class="btn btn-secondary" id="closeNotification">Close</button>
                    <button class="btn btn-primary" id="shareNotification">
                        <i class="fas fa-share"></i> Share
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Database of Islamic tasks with notifications
        const islamicTasks = {
            daily: [
                {
                    id: "fajr",
                    name: "Fajr Prayer",
                    description: "Morning prayer",
                    time: "Before sunrise",
                    category: "prayer",
                    completed: false,
                    islamicContext: {
                        verse: "Establish prayer at the decline of the sun until the darkness of the night and the Quran at dawn. Indeed, the Quran at dawn is ever witnessed.",
                        source: "Quran 17:78",
                        reward: "Allah's protection for the day",
                        encouragement: "The Prophet ﷺ said: 'Whoever prays Fajr is under Allah's protection.'"
                    }
                },
                {
                    id: "dhuhr",
                    name: "Dhuhr Prayer",
                    description: "Midday prayer",
                    time: "After noon",
                    category: "prayer",
                    completed: false,
                    islamicContext: {
                        verse: "Guard strictly your prayers, especially the middle prayer. And stand before Allah with devotion.",
                        source: "Quran 2:238",
                        reward: "Forgiveness of sins",
                        encouragement: "Consistency in prayer leads to Allah's love"
                    }
                },
                {
                    id: "asr",
                    name: "Asr Prayer",
                    description: "Afternoon prayer",
                    time: "Late afternoon",
                    category: "prayer",
                    completed: false,
                    islamicContext: {
                        verse: "So glorify Allah when you reach evening and when you rise in the morning.",
                        source: "Quran 30:17",
                        reward: "Light on Day of Judgment",
                        encouragement: "Asr prayer is the middle prayer - guard it well"
                    }
                },
                {
                    id: "maghrib",
                    name: "Maghrib Prayer",
                    description: "Sunset prayer",
                    time: "After sunset",
                    category: "prayer",
                    completed: false,
                    islamicContext: {
                        verse: "And establish prayer at the two ends of the day and at the approach of the night.",
                        source: "Quran 11:114",
                        reward: "Acceptance of supplications",
                        encouragement: "Maghrib is answered prayer time"
                    }
                },
                {
                    id: "isha",
                    name: "Isha Prayer",
                    description: "Night prayer",
                    time: "After twilight",
                    category: "prayer",
                    completed: false,
                    islamicContext: {
                        verse: "And during night, prostrate to Him and glorify Him a long night through.",
                        source: "Quran 76:26",
                        reward: "Peaceful sleep under Allah's care",
                        encouragement: "Isha prayer equals half the night in reward"
                    }
                },
                {
                    id: "quran",
                    name: "Quran Reading",
                    description: "Daily recitation",
                    time: "Anytime",
                    category: "quran",
                    completed: false,
                    islamicContext: {
                        verse: "Recite what has been revealed to you of the Book and establish prayer. Indeed, prayer prohibits immorality and wrongdoing.",
                        source: "Quran 29:45",
                        reward: "10 rewards per letter",
                        encouragement: "The Quran will intercede for you on Judgment Day"
                    }
                },
                {
                    id: "dhikr",
                    name: "Morning & Evening Dhikr",
                    description: "Remembrance of Allah",
                    time: "Morning/Evening",
                    category: "dhikr",
                    completed: false,
                    islamicContext: {
                        verse: "And remember your Lord within yourself in humility and in fear without being apparent in speech - in the mornings and the evenings.",
                        source: "Quran 7:205",
                        reward: "Protection and peace",
                        encouragement: "Dhikr is fortress against Shaytan"
                    }
                },
                {
                    id: "charity",
                    name: "Daily Charity",
                    description: "Even a smile is charity",
                    time: "Anytime",
                    category: "charity",
                    completed: false,
                    islamicContext: {
                        verse: "The example of those who spend their wealth in the way of Allah is like a seed which grows seven spikes; in each spike is a hundred grains.",
                        source: "Quran 2:261",
                        reward: "Wealth multiplied 700 times",
                        encouragement: "Charity extinguishes sins like water extinguishes fire"
                    }
                }
            ],
            weekly: [
                {
                    id: "friday",
                    name: "Jumu'ah Prayer",
                    description: "Friday congregational prayer",
                    time: "Friday afternoon",
                    category: "prayer",
                    completed: false,
                    islamicContext: {
                        verse: "O you who have believed, when the call to prayer is made on Friday, then proceed to the remembrance of Allah and leave trade.",
                        source: "Quran 62:9",
                        reward: "Forgiveness of week's sins",
                        encouragement: "Jumu'ah is the best day the sun rises upon"
                    }
                },
                {
                    id: "fasting",
                    name: "Optional Fasting",
                    description: "Monday/Thursday fasting",
                    time: "Weekly",
                    category: "fasting",
                    completed: false,
                    islamicContext: {
                        verse: "And fast, it is better for you, if only you knew.",
                        source: "Quran 2:184",
                        reward: "Sins forgiven, dua accepted",
                        encouragement: "Deeds presented to Allah on Monday and Thursday"
                    }
                },
                {
                    id: "family",
                    name: "Family Time & Rights",
                    description: "Spend quality time with family",
                    time: "Weekly",
                    category: "family",
                    completed: false,
                    islamicContext: {
                        verse: "And worship Allah and associate nothing with Him, and to parents do good, and to relatives, orphans, the needy, the near neighbor, the neighbor farther away...",
                        source: "Quran 4:36",
                        reward: "Barakah in home and relationships",
                        encouragement: "The best of you are those best to their families"
                    }
                }
            ]
        };

        // Database of Islamic notifications
        const islamicNotifications = {
            prayer: [
                "Allah says: 'Indeed, I am Allah. There is no deity except Me, so worship Me and establish prayer for My remembrance.' (Quran 20:14)",
                "The Prophet ﷺ said: 'The first matter the slave will be accountable for is prayer.'",
                "Prayer is the pillar of religion. Whoever establishes it has established religion."
            ],
            quran: [
                "Allah says: 'This is the Book about which there is no doubt, a guidance for those conscious of Allah.' (Quran 2:2)",
                "The best of you are those who learn the Quran and teach it.",
                "Recite the Quran, for it will come as an intercessor for its reciter on the Day of Resurrection."
            ],
            charity: [
                "Allah says: 'Take from their wealth a charity by which you purify them and cause them increase.' (Quran 9:103)",
                "Charity does not decrease wealth.",
                "Protect yourself from Hellfire even with half a date in charity."
            ],
            general: [
                "Allah loves those who are consistent in good deeds, even if small.",
                "The most beloved deeds to Allah are those done consistently, even if little.",
                "Do not belittle any good deed, even meeting your brother with a cheerful face."
            ]
        };

        // App State
        const appState = {
            streak: parseInt(localStorage.getItem('faithStreak')) || 0,
            completedToday: parseInt(localStorage.getItem('completedToday')) || 0,
            lastLogin: localStorage.getItem('lastLogin') || null,
            tasks: JSON.parse(localStorage.getItem('faithTasks')) || islamicTasks
        };

        // DOM Elements
        const currentDateEl = document.getElementById('currentDate');
        const streakCountEl = document.getElementById('streakCount');
        const completedTodayEl = document.getElementById('completedToday');
        const totalTasksEl = document.getElementById('totalTasks');
        const progressPercentEl = document.getElementById('progressPercent');
        const progressFillEl = document.getElementById('progressFill');
        const prayerContainerEl = document.getElementById('prayerContainer');
        const dailyTasksEl = document.getElementById('dailyTasks');
        const weeklyTasksEl = document.getElementById('weeklyTasks');
        const notificationModal = document.getElementById('notificationModal');
        const notificationVerseEl = document.getElementById('notificationVerse');
        const notificationMessageEl = document.getElementById('notificationMessage');
        const notificationSourceEl = document.getElementById('notificationSource');
        const closeNotificationBtn = document.getElementById('closeNotification');
        const shareNotificationBtn = document.getElementById('shareNotification');
        const tabs = document.querySelectorAll('.tab');

        // Initialize
        function init() {
            updateDate();
            checkStreak();
            renderStats();
            renderPrayerTimes();
            renderDailyTasks();
            renderWeeklyTasks();
            setupEventListeners();
        }

        // Update current date
        function updateDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const hijriDate = getHijriDate();
            currentDateEl.innerHTML = `
                ${now.toLocaleDateString('en-US', options)}<br>
                <span style="color: var(--secondary);">${hijriDate}</span>
            `;
        }

        // Get Hijri date (simplified)
        function getHijriDate() {
            const hijriMonths = ['Muharram', 'Safar', 'Rabi\' al-Awwal', 'Rabi\' al-Thani', 
                                'Jumada al-Awwal', 'Jumada al-Thani', 'Rajab', 'Sha\'ban', 
                                'Ramadan', 'Shawwal', 'Dhu al-Qi\'dah', 'Dhu al-Hijjah'];
            const now = new Date();
            const randomOffset = Math.floor(Math.random() * 30); // Simplified
            const day = (randomOffset % 30) + 1;
            const monthIndex = Math.floor(randomOffset / 30);
            return `${day} ${hijriMonths[monthIndex]} 1445 AH`;
        }

        // Check and update streak
        function checkStreak() {
            const today = new Date().toDateString();
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (!appState.lastLogin) {
                appState.lastLogin = today;
                appState.streak = 1;
            } else if (appState.lastLogin === yesterday.toDateString()) {
                appState.streak++;
                appState.lastLogin = today;
            } else if (appState.lastLogin !== today) {
                appState.streak = 1;
                appState.lastLogin = today;
            }
            
            localStorage.setItem('lastLogin', appState.lastLogin);
            localStorage.setItem('faithStreak', appState.streak.toString());
        }

        // Render stats
        function renderStats() {
            streakCountEl.textContent = appState.streak;
            
            // Count completed tasks for today
            const completedCount = appState.tasks.daily.filter(task => task.completed).length;
            appState.completedToday = completedCount;
            completedTodayEl.textContent = completedCount;
            
            // Calculate progress
            const totalDailyTasks = appState.tasks.daily.length;
            const progress = totalDailyTasks > 0 ? Math.round((completedCount / totalDailyTasks) * 100) : 0;
            progressPercentEl.textContent = `${progress}%`;
            progressFillEl.style.width = `${progress}%`;
            
            totalTasksEl.textContent = appState.tasks.daily.length + appState.tasks.weekly.length;
            
            localStorage.setItem('completedToday', appState.completedToday.toString());
        }

        // Render prayer times
        function renderPrayerTimes() {
            const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
            const times = ['5:30 AM', '12:30 PM', '4:00 PM', '6:15 PM', '7:45 PM']; // Example times
            
            prayerContainerEl.innerHTML = '';
            
            prayers.forEach((prayer, index) => {
                const prayerData = appState.tasks.daily.find(t => t.id === prayer.toLowerCase());
                const isCompleted = prayerData ? prayerData.completed : false;
                
                const prayerCard = document.createElement('div');
                prayerCard.className = 'prayer-card';
                prayerCard.innerHTML = `
                    <div class="prayer-name">${prayer}</div>
                    <div class="prayer-time">${times[index]}</div>
                    <div class="prayer-status ${isCompleted ? 'prayer-completed' : 'prayer-pending'}">
                        ${isCompleted ? '✅ Completed' : '⏳ Pending'}
                    </div>
                `;
                
                prayerCard.addEventListener('click', () => {
                    if (prayerData) {
                        toggleTaskCompletion(prayerData, 'daily');
                    }
                });
                
                prayerContainerEl.appendChild(prayerCard);
            });
        }

        // Render daily tasks
        function renderDailyTasks() {
            dailyTasksEl.innerHTML = '';
            
            const categories = {};
            appState.tasks.daily.forEach(task => {
                if (!categories[task.category]) {
                    categories[task.category] = [];
                }
                categories[task.category].push(task);
            });
            
            for (const [category, tasks] of Object.entries(categories)) {
                const categoryTitle = document.createElement('div');
                categoryTitle.className = 'task-category';
                categoryTitle.innerHTML = `<h3 style="color: var(--primary); margin-bottom: 10px; text-transform: capitalize;">${category}</h3>`;
                dailyTasksEl.appendChild(categoryTitle);
                
                tasks.forEach(task => {
                    const taskItem = document.createElement('div');
                    taskItem.className = 'task-item';
                    taskItem.innerHTML = `
                        <div class="task-info">
                            <div class="task-name">${task.name}</div>
                            <div class="task-desc">
                                <i class="fas fa-${getCategoryIcon(task.category)}"></i>
                                ${task.description}
                            </div>
                        </div>
                        <div class="task-actions">
                            <div class="task-time">${task.time}</div>
                            <div class="task-checkbox ${task.completed ? 'completed' : ''}">
                                ${task.completed ? '<i class="fas fa-check"></i>' : ''}
                            </div>
                        </div>
                    `;
                    
                    taskItem.addEventListener('click', () => {
                        toggleTaskCompletion(task, 'daily');
                    });
                    
                    dailyTasksEl.appendChild(taskItem);
                });
            }
        }

        // Render weekly tasks
        function renderWeeklyTasks() {
            weeklyTasksEl.innerHTML = '';
            
            appState.tasks.weekly.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item';
                taskItem.innerHTML = `
                    <div class="task-info">
                        <div class="task-name">${task.name}</div>
                        <div class="task-desc">
                            <i class="fas fa-${getCategoryIcon(task.category)}"></i>
                            ${task.description}
                        </div>
                    </div>
                    <div class="task-actions">
                        <div class="task-time">${task.time}</div>
                        <div class="task-checkbox ${task.completed ? 'completed' : ''}">
                            ${task.completed ? '<i class="fas fa-check"></i>' : ''}
                        </div>
                    </div>
                `;
                
                taskItem.addEventListener('click', () => {
                    toggleTaskCompletion(task, 'weekly');
                });
                
                weeklyTasksEl.appendChild(taskItem);
            });
        }

        // Get icon for category
        function getCategoryIcon(category) {
            const icons = {
                prayer: 'pray',
                quran: 'book-quran',
                dhikr: 'dharmachakra',
                charity: 'hand-holding-heart',
                fasting: 'cloud-sun',
                family: 'users'
            };
            return icons[category] || 'tasks';
        }

        // Toggle task completion
        function toggleTaskCompletion(task, type) {
            task.completed = !task.completed;
            
            // Save to localStorage
            localStorage.setItem('faithTasks', JSON.stringify(appState.tasks));
            
            // Update stats
            renderStats();
            
            // Re-render affected section
            if (type === 'daily') {
                renderPrayerTimes();
                renderDailyTasks();
                
                // Show notification if task was completed (not uncompleted)
                if (task.completed) {
                    showIslamicNotification(task);
                }
            } else {
                renderWeeklyTasks();
            }
        }

        // Show Islamic notification
        function showIslamicNotification(task) {
            // Prepare notification content
            const context = task.islamicContext;
            const categoryNotifications = islamicNotifications[task.category] || islamicNotifications.general;
            const randomNotification = categoryNotifications[Math.floor(Math.random() * categoryNotifications.length)];
            
            notificationVerseEl.textContent = `"${context.verse}"`;
            notificationMessageEl.innerHTML = `
                <strong>${task.name} Completed!</strong><br><br>
                ${context.encouragement}<br><br>
                ${randomNotification}
            `;
            notificationSourceEl.textContent = context.source;
            
            // Show modal
            notificationModal.classList.add('active');
            
            // Play success sound (if needed)
            playSuccessSound();
        }

        // Play success sound
        function playSuccessSound() {
            // You can add actual sound files here
            console.log("Playing success sound");
        }

        // Setup event listeners
        function setupEventListeners() {
            // Tab switching
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show corresponding content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Notification modal
            closeNotificationBtn.addEventListener('click', () => {
                notificationModal.classList.remove('active');
            });
            
            shareNotificationBtn.addEventListener('click', () => {
                const verse = notificationVerseEl.textContent;
                const message = notificationMessageEl.textContent;
                const shareText = `${verse}\n\n${message}\n\nShared via FaithTask App`;
                
                if (navigator.share) {
                    navigator.share({
                        title: 'MashaAllah!',
                        text: shareText
                    });
                } else {
                    navigator.clipboard.writeText(shareText).then(() => {
                        alert('Copied to clipboard! Share with others.');
                    });
                }
            });
            
            // Close modal when clicking outside
            notificationModal.addEventListener('click', (e) => {
                if (e.target === notificationModal) {
                    notificationModal.classList.remove('active');
                }
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && notificationModal.classList.contains('active')) {
                    notificationModal.classList.remove('active');
                }
            });
        }

        // Export/Import functionality (for future use)
        function exportData() {
            const data = {
                tasks: appState.tasks,
                streak: appState.streak,
                exportDate: new Date().toISOString()
            };
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'faithtask-data.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function importData(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.tasks && data.streak !== undefined) {
                        appState.tasks = data.tasks;
                        appState.streak = data.streak;
                        localStorage.setItem('faithTasks', JSON.stringify(appState.tasks));
                        localStorage.setItem('faithStreak', appState.streak.toString());
                        init();
                        alert('Data imported successfully!');
                    }
                } catch (error) {
                    alert('Error importing data. Invalid file format.');
                }
            };
            reader.readAsText(file);
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
