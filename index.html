<!DOCTYPE html>
<html>
<head>
    <title>PRO Crypto Auto-Trade - TEST MODE</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial; 
            background: #0a0a0a; 
            color: white; 
            padding: 10px;
            overflow-x: hidden;
        }
        
        /* Animated Bubbles */
        .bubbles-container {
            position: relative;
            height: 60vh;
            overflow: hidden;
            margin-bottom: 20px;
            border: 2px solid #333;
            border-radius: 15px;
            background: #111;
        }
        
        .coin-bubble {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.2);
            animation: float 3s infinite ease-in-out;
            text-align: center;
            padding: 10px;
            flex-direction: column;
        }
        
        .coin-bubble:hover {
            transform: scale(1.1);
            border-color: #00ff88;
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.4);
        }
        
        .bubble-large { width: 120px; height: 120px; }
        .bubble-medium { width: 100px; height: 100px; }
        .bubble-small { width: 80px; height: 80px; }
        
        .volume-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            position: absolute;
            top: 5px;
            right: 5px;
        }
        .volume-high { background: #00ff88; }
        .volume-medium { background: #ffaa00; }
        .volume-low { background: #ff4444; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(1deg); }
        }
        
        /* API Setup */
        .api-setup {
            background: #1a1a2e;
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
        }
        
        .input-field {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border: 1px solid #444;
            background: #0a0a0a;
            color: white;
        }
        
        .btn {
            background: #00ff88;
            color: black;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            width: 100%;
            margin: 10px 0;
            cursor: pointer;
        }
        
        .btn-test { background: #ffaa00; }
        .btn-danger { background: #ff4444; }
        
        /* Trading Panel */
        .trading-panel {
            background: #1a1a2e;
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            display: none;
        }
        
        .param-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 10px 0;
        }
        
        .param-btn {
            background: #2d2d44;
            border: none;
            color: white;
            padding: 10px 5px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 12px;
        }
        
        .param-btn.selected {
            background: #00ff88;
            color: black;
            font-weight: bold;
        }
        
        .status-connected { color: #00ff88; }
        .status-disconnected { color: #ff4444; }
        
        .test-notice {
            background: #ffaa00;
            color: black;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Test Notice -->
        <div class="test-notice">
            üß™ TEST MODE - Using Binance TestNet Simulation
        </div>

        <!-- Header -->
        <div class="header" style="text-align: center; margin-bottom: 20px;">
            <h1>üöÄ PRO Crypto Auto-Trade</h1>
            <p>TEST MODE - Safe Testing with Simulated Binance API</p>
        </div>

        <!-- API Configuration -->
        <div class="api-setup" id="apiSetup">
            <h3>üîë Test API Setup (Simulated)</h3>
            <div class="test-notice" style="background: #444; color: white;">
                üîí No real API keys needed for testing
            </div>
            
            <input type="text" class="input-field" id="apiKey" placeholder="Enter any test API Key" value="test_api_key_123">
            <input type="text" class="input-field" id="apiSecret" placeholder="Enter any test Secret" value="test_secret_456">
            
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-test" onclick="testBinanceConnection()">üß™ Test Connection</button>
                <button class="btn" onclick="connectToTestNet()">üöÄ Connect to TestNet</button>
            </div>
            
            <div style="margin-top: 10px;">
                <span>Status: </span>
                <span id="apiStatus" class="status-disconnected">Disconnected</span>
            </div>
        </div>

        <!-- Live Crypto Bubbles -->
        <div class="bubbles-container" id="bubblesContainer">
            <!-- Animated bubbles will be loaded here -->
        </div>

        <!-- Trading Configuration Panel -->
        <div class="trading-panel" id="tradingPanel">
            <h3 id="selectedCoin">BTC/USDT</h3>
            
            <!-- Frequency -->
            <h4>üïê Trade Frequency</h4>
            <div class="param-grid">
                <div class="param-btn" data-param="frequency" data-value="1h">1 Hour</div>
                <div class="param-btn" data-param="frequency" data-value="4h">4 Hours</div>
                <div class="param-btn" data-param="frequency" data-value="1d">1 Day</div>
                <div class="param-btn" data-param="frequency" data-value="1w">1 Week</div>
                <div class="param-btn" data-param="frequency" data-value="30m">30 Min</div>
                <div class="param-btn" data-param="frequency" data-value="6h">6 Hours</div>
            </div>

            <!-- Amount -->
            <h4>üí∞ Amount per Trade</h4>
            <div class="param-grid">
                <div class="param-btn" data-param="amount" data-value="0.1">0.1 USDT</div>
                <div class="param-btn" data-param="amount" data-value="0.5">0.5 USDT</div>
                <div class="param-btn" data-param="amount" data-value="1">1 USDT</div>
                <div class="param-btn" data-param="amount" data-value="5">5 USDT</div>
                <div class="param-btn" data-param="amount" data-value="10">10 USDT</div>
                <div class="param-btn" data-param="amount" data-value="25">25 USDT</div>
                <div class="param-btn" data-param="amount" data-value="50">50 USDT</div>
                <div class="param-btn" data-param="amount" data-value="100">100 USDT</div>
                <input type="number" class="input-field" id="customAmount" placeholder="Custom USDT" style="grid-column: span 3;">
            </div>

            <!-- Strategy -->
            <h4>üéØ Trading Strategy</h4>
            <div class="param-grid">
                <div class="param-btn" data-param="strategy" data-value="dca">DCA Only</div>
                <div class="param-btn" data-param="strategy" data-value="tp_sl">TP/SL</div>
                <div class="param-btn" data-param="strategy" data-value="grid">Grid Bot</div>
            </div>

            <!-- Action Buttons -->
            <button class="btn" onclick="startRealTrading()">üöÄ EXECUTE TEST TRADE</button>
            <button class="btn btn-test" onclick="testTrading()">üß™ TEST SMALL TRADE ($0.10)</button>
            <button class="btn btn-danger" onclick="closePanel()">‚úñÔ∏è CANCEL</button>
            
            <div class="test-notice" style="margin-top: 15px;">
                üí° Test trades use simulated Binance TestNet
            </div>
        </div>

        <!-- Active Bots & Portfolio -->
        <div class="api-setup">
            <h3>ü§ñ Active Test Trades</h3>
            <div id="activeBots">
                <p style="text-align: center; color: #888;">No active trades yet</p>
            </div>
            
            <h3 style="margin-top: 20px;">üìä Test Portfolio</h3>
            <div id="portfolioInfo">
                <p style="text-align: center; color: #888;">Connect to TestNet to view portfolio</p>
            </div>
        </div>

        <!-- Add More Coins -->
        <div class="api-setup">
            <h3>‚ûï Add More Coins for Testing</h3>
            <input type="text" class="input-field" id="newCoin" placeholder="Enter coin symbol (e.g., SOL, DOT, MATIC)">
            <button class="btn" onclick="addCustomCoin()">Add Coin to Bubbles</button>
            <div style="font-size: 12px; color: #888; margin-top: 10px;">
                Popular: SOL, ADA, DOT, MATIC, AVAX, LINK, LTC, BCH, XLM, EOS
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // Test configuration
        const TEST_MODE = true;
        let API_CONNECTED = false;
        let testPortfolio = {
            'USDT': { free: 1000, locked: 0 },
            'BTC': { free: 0.01, locked: 0 },
            'ETH': { free: 0.1, locked: 0 },
            'BNB': { free: 1, locked: 0 }
        };

        // Current trading selection
        let currentSelection = {
            coin: null,
            frequency: null,
            amount: null,
            strategy: 'dca'
        };

        // Top coins by volume with realistic test data
        let cryptocurrencies = [
            { symbol: 'BTC', name: 'Bitcoin', price: 43450.25, change: 2.34, volume: 28000000000, marketCap: 845000000000 },
            { symbol: 'ETH', name: 'Ethereum', price: 2380.67, change: 1.56, volume: 12000000000, marketCap: 285000000000 },
            { symbol: 'BNB', name: 'Binance Coin', price: 312.89, change: -0.23, volume: 800000000, marketCap: 48000000000 },
            { symbol: 'SOL', name: 'Solana', price: 102.45, change: 5.67, volume: 2500000000, marketCap: 42000000000 },
            { symbol: 'XRP', name: 'Ripple', price: 0.6234, change: 0.89, volume: 1500000000, marketCap: 34000000000 },
            { symbol: 'ADA', name: 'Cardano', price: 0.5123, change: -1.23, volume: 500000000, marketCap: 18000000000 },
            { symbol: 'AVAX', name: 'Avalanche', price: 34.56, change: 4.32, volume: 600000000, marketCap: 14000000000 },
            { symbol: 'DOT', name: 'Polkadot', price: 7.89, change: 3.45, volume: 400000000, marketCap: 9000000000 },
            { symbol: 'DOGE', name: 'Dogecoin', price: 0.0987, change: 2.11, volume: 800000000, marketCap: 12000000000 },
            { symbol: 'MATIC', name: 'Polygon', price: 0.8234, change: 1.23, volume: 300000000, marketCap: 8000000000 }
        ];

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeAnimatedBubbles();
            startLivePriceUpdates();
        });

        // Create animated floating bubbles
        function initializeAnimatedBubbles() {
            const container = document.getElementById('bubblesContainer');
            container.innerHTML = '';

            cryptocurrencies.forEach((coin, index) => {
                const bubble = document.createElement('div');
                bubble.className = `coin-bubble ${getBubbleSize(coin.volume)}`;
                
                // Random position with collision avoidance
                const position = getRandomPosition(index);
                bubble.style.left = position.x + 'px';
                bubble.style.top = position.y + 'px';
                bubble.style.animationDelay = (Math.random() * 2) + 's';
                
                // Volume indicator dot
                const volumeDot = document.createElement('div');
                volumeDot.className = `volume-dot ${getVolumeClass(coin.volume)}`;
                
                bubble.innerHTML = `
                    <div style="font-weight: bold; font-size: ${getFontSize(coin.volume)}">${coin.symbol}</div>
                    <div style="font-size: 10px; color: #00ff88">$${coin.price.toLocaleString()}</div>
                    <div style="font-size: 8px; color: ${coin.change >= 0 ? '#00ff88' : '#ff4444'}">
                        ${coin.change >= 0 ? '‚Üó' : '‚Üò'} ${Math.abs(coin.change)}%
                    </div>
                `;
                
                bubble.appendChild(volumeDot);
                bubble.addEventListener('click', () => openTradingPanel(coin));
                container.appendChild(bubble);
            });
        }

        // Get bubble size based on volume
        function getBubbleSize(volume) {
            if (volume > 1000000000) return 'bubble-large';
            if (volume > 500000000) return 'bubble-medium';
            return 'bubble-small';
        }

        // Get font size based on volume
        function getFontSize(volume) {
            if (volume > 1000000000) return '16px';
            if (volume > 500000000) return '14px';
            return '12px';
        }

        // Get volume indicator class
        function getVolumeClass(volume) {
            if (volume > 5000000000) return 'volume-high';
            if (volume > 1000000000) return 'volume-medium';
            return 'volume-low';
        }

        // Random position for bubbles
        function getRandomPosition(index) {
            const container = document.getElementById('bubblesContainer');
            const width = container.clientWidth - 120;
            const height = container.clientHeight - 120;
            
            // Create grid-like positions but with some randomness
            const row = Math.floor(index / 3);
            const col = index % 3;
            
            return {
                x: 60 + (col * (width / 3)) + (Math.random() * 50 - 25),
                y: 60 + (row * (height / 4)) + (Math.random() * 50 - 25)
            };
        }

        // Simulate live price updates
        function startLivePriceUpdates() {
            setInterval(() => {
                cryptocurrencies.forEach(coin => {
                    // Simulate small price changes
                    const change = (Math.random() - 0.5) * 2;
                    coin.price = Math.max(0.0001, coin.price * (1 + change/100));
                    coin.change = (Math.random() * 10 - 5).toFixed(2);
                });
                initializeAnimatedBubbles();
            }, 5000);
        }

        // Test Binance connection (simulated)
        function testBinanceConnection() {
            const apiKey = document.getElementById('apiKey').value;
            const apiSecret = document.getElementById('apiSecret').value;
            
            if (!apiKey || !apiSecret) {
                tg.showAlert('Please enter both test API Key and Secret');
                return;
            }

            // Simulate API connection delay
            setTimeout(() => {
                document.getElementById('apiStatus').textContent = 'Connected to TestNet ‚úÖ';
                document.getElementById('apiStatus').className = 'status-connected';
                API_CONNECTED = true;
                
                tg.showAlert('‚úÖ Successfully connected to Binance TestNet Simulation!\n\nYou can now test trading functionality.');
                updatePortfolioInfo();
                
            }, 1000);
        }

        // Connect to TestNet
        function connectToTestNet() {
            document.getElementById('apiKey').value = 'testnet_api_key_' + Math.random().toString(36).substr(2, 9);
            document.getElementById('apiSecret').value = 'testnet_secret_' + Math.random().toString(36).substr(2, 9);
            testBinanceConnection();
        }

        // Open trading panel
        function openTradingPanel(coin) {
            if (!API_CONNECTED) {
                tg.showAlert('Please connect to TestNet first');
                return;
            }
            
            currentSelection.coin = coin;
            document.getElementById('selectedCoin').textContent = `${coin.symbol}/USDT`;
            document.getElementById('tradingPanel').style.display = 'block';
            document.getElementById('tradingPanel').scrollIntoView({ behavior: 'smooth' });
        }

        // Start REAL trading (simulated)
        async function startRealTrading() {
            if (!validateTradingSelection()) return;

            const amount = currentSelection.amount || document.getElementById('customAmount').value;
            if (!amount) {
                tg.showAlert('Please select or enter an amount');
                return;
            }

            // Simulate API call delay
            setTimeout(() => {
                const orderId = 'TEST_' + Date.now();
                const price = currentSelection.coin.price;
                const quantity = (amount / price).toFixed(6);

                // Save bot configuration
                const botConfig = {
                    id: Date.now(),
                    coin: currentSelection.coin.symbol,
                    frequency: currentSelection.frequency,
                    amount: parseFloat(amount),
                    strategy: currentSelection.strategy,
                    status: 'running',
                    orderId: orderId,
                    price: price,
                    quantity: quantity,
                    createdAt: new Date().toLocaleString()
                };

                saveBot(botConfig);
                
                // Update portfolio
                updateTestPortfolio(currentSelection.coin.symbol, parseFloat(quantity), parseFloat(amount));
                
                tg.showAlert(`‚úÖ TEST TRADE EXECUTED!\n\nüí∏ ${amount} USDT of ${currentSelection.coin.symbol}\nüìä Price: $${price}\nü™ô Quantity: ${quantity}\nüé´ Order ID: ${orderId}`);
                closePanel();
                updateActiveBots();
                updatePortfolioInfo();
                
            }, 1500);
        }

        // Test trading with small amount
        async function testTrading() {
            if (!validateTradingSelection()) return;

            // Simulate small test trade
            setTimeout(() => {
                const orderId = 'TEST_SMALL_' + Date.now();
                const price = currentSelection.coin.price;
                const quantity = (0.10 / price).toFixed(8);

                tg.showAlert(`üß™ TEST TRADE SUCCESS!\n\nüí∏ $0.10 of ${currentSelection.coin.symbol}\nüìä Price: $${price}\nü™ô Quantity: ${quantity}\nüé´ Order ID: ${orderId}`);
                
            }, 1000);
        }

        // Update test portfolio after trade
        function updateTestPortfolio(coin, quantity, amount) {
            // Subtract USDT
            testPortfolio.USDT.free -= amount;
            
            // Add crypto
            if (!testPortfolio[coin]) {
                testPortfolio[coin] = { free: 0, locked: 0 };
            }
            testPortfolio[coin].free += quantity;
        }

        // Add custom coin
        function addCustomCoin() {
            const newCoinSymbol = document.getElementById('newCoin').value.toUpperCase().trim();
            if (!newCoinSymbol) {
                tg.showAlert('Please enter a coin symbol');
                return;
            }

            // Check if coin already exists
            if (cryptocurrencies.find(c => c.symbol === newCoinSymbol)) {
                tg.showAlert('Coin already in list');
                return;
            }

            // Add new coin with random data
            const randomPrice = (Math.random() * 1000).toFixed(4);
            const randomChange = (Math.random() * 10 - 5).toFixed(2);
            const randomVolume = Math.random() * 1000000000;

            cryptocurrencies.push({
                symbol: newCoinSymbol,
                name: newCoinSymbol,
                price: parseFloat(randomPrice),
                change: parseFloat(randomChange),
                volume: randomVolume,
                marketCap: randomVolume * 10
            });

            document.getElementById('newCoin').value = '';
            initializeAnimatedBubbles();
            tg.showAlert(`‚úÖ ${newCoinSymbol} added to bubbles!\nPrice: $${randomPrice}`);
        }

        // Parameter selection handling
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('param-btn')) {
                const param = e.target.dataset.param;
                const value = e.target.dataset.value;
                
                e.target.parentElement.querySelectorAll('.param-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                e.target.classList.add('selected');
                
                currentSelection[param] = value;
            }
        });

        // Helper functions
        function validateTradingSelection() {
            if (!currentSelection.coin) {
                tg.showAlert('Please select a coin');
                return false;
            }
            if (!currentSelection.frequency) {
                tg.showAlert('Please select trading frequency');
                return false;
            }
            return true;
        }

        function closePanel() {
            document.getElementById('tradingPanel').style.display = 'none';
        }

        function saveBot(botConfig) {
            let bots = JSON.parse(localStorage.getItem('autoInvestBots') || '[]');
            bots.push(botConfig);
            localStorage.setItem('autoInvestBots', JSON.stringify(bots));
        }

        function updateActiveBots() {
            const bots = JSON.parse(localStorage.getItem('autoInvestBots') || '[]');
            const container = document.getElementById('activeBots');
            
            if (bots.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #888;">No active trades yet</p>';
                return;
            }
            
            container.innerHTML = bots.map(bot => `
                <div style="background: #2d2d44; padding: 15px; border-radius: 10px; margin: 10px 0;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${bot.coin}</strong> - ${bot.amount} USDT
                        </div>
                        <span style="color: #00ff88;">${bot.status}</span>
                    </div>
                    <div style="font-size: 12px; color: #888; margin-top: 5px;">
                        üìä $${bot.price} ‚Ä¢ ü™ô ${bot.quantity} ‚Ä¢ üé´ ${bot.orderId}
                    </div>
                    <div style="font-size: 10px; color: #666; margin-top: 3px;">
                        ${new Date(bot.createdAt).toLocaleString()}
                    </div>
                </div>
            `).join('');
        }

        // Load portfolio information
        function updatePortfolioInfo() {
            if (!API_CONNECTED) return;
            
            const container = document.getElementById('portfolioInfo');
            let html = '';
            
            for (const [asset, balance] of Object.entries(testPortfolio)) {
                if (balance.free > 0 || balance.locked > 0) {
                    const total = balance.free + balance.locked;
                    html += `
                        <div style="display: flex; justify-content: space-between; margin: 8px 0; padding: 8px; background: #2d2d44; border-radius: 8px;">
                            <span style="font-weight: bold;">${asset}</span>
                            <span>${total.toFixed(6)}</span>
                        </div>
                    `;
                }
            }
            
            container.innerHTML = html || '<p style="text-align: center; color: #888;">No assets in portfolio</p>';
        }
    </script>
</body>
</html>
