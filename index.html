<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Cafe Orders History</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* Telegram-like Styles */
        :root {
            --tg-bg: #18222d;
            --tg-secondary-bg: #1e2a38;
            --tg-text: #ffffff;
            --tg-secondary-text: #8e8e93;
            --tg-accent: #2ea6ff;
            --tg-green: #33c659;
            --tg-red: #ff3b30;
            --tg-border: #2c3b4d;
            --tg-card-bg: #222f3d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--tg-bg);
            color: var(--tg-text);
            line-height: 1.4;
            font-size: 15px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding-bottom: 80px;
        }

        /* Header */
        .app-header {
            background: var(--tg-secondary-bg);
            padding: 12px 16px;
            border-bottom: 1px solid var(--tg-border);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stats-badge {
            background: var(--tg-accent);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--tg-border);
            background: var(--tg-secondary-bg);
            position: sticky;
            top: 53px;
            z-index: 99;
        }

        .tab {
            flex: 1;
            padding: 14px;
            text-align: center;
            background: none;
            border: none;
            color: var(--tg-secondary-text);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            position: relative;
        }

        .tab.active {
            color: var(--tg-accent);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--tg-accent);
            border-radius: 3px 3px 0 0;
        }

        /* Orders List */
        .orders-list {
            padding: 8px 0;
        }

        .order-card {
            background: var(--tg-card-bg);
            margin: 8px 12px;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            border: 1px solid var(--tg-border);
        }

        .order-card:hover {
            transform: translateY(-2px);
            background: #253341;
        }

        .order-card:active {
            transform: translateY(0);
        }

        .order-header {
            padding: 14px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-id {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            color: var(--tg-accent);
            font-weight: 600;
        }

        .order-status {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-completed { background: rgba(51, 198, 89, 0.2); color: var(--tg-green); }
        .status-pending { background: rgba(255, 204, 0, 0.2); color: #ffcc00; }
        .status-cancelled { background: rgba(255, 59, 48, 0.2); color: var(--tg-red); }

        .order-body {
            padding: 0 16px 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .customer-info {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .customer-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--tg-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
        }

        .customer-name {
            font-weight: 500;
        }

        .order-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }

        .order-amount {
            font-size: 18px;
            font-weight: 700;
            color: var(--tg-green);
        }

        .order-time {
            font-size: 12px;
            color: var(--tg-secondary-text);
        }

        .divider {
            height: 1px;
            background: var(--tg-border);
            margin: 8px 12px;
            opacity: 0.5;
        }

        /* Summary Card */
        .summary-card {
            background: var(--tg-card-bg);
            margin: 16px 12px;
            padding: 16px;
            border-radius: 12px;
            border: 1px solid var(--tg-border);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }

        .summary-label {
            color: var(--tg-secondary-text);
        }

        .summary-value {
            font-weight: 600;
        }

        .summary-total {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--tg-border);
            font-size: 18px;
        }

        .summary-total .summary-value {
            color: var(--tg-green);
            font-size: 20px;
        }

        /* Order Detail Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--tg-card-bg);
            border-radius: 16px;
            width: 100%;
            max-width: 400px;
            max-height: 85vh;
            overflow: hidden;
            border: 1px solid var(--tg-border);
            transform: translateY(20px);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 20px 16px;
            text-align: center;
            border-bottom: 1px solid var(--tg-border);
            background: linear-gradient(135deg, var(--tg-secondary-bg) 0%, var(--tg-card-bg) 100%);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .modal-subtitle {
            color: var(--tg-secondary-text);
            font-size: 14px;
        }

        .modal-body {
            padding: 20px 16px;
            overflow-y: auto;
            max-height: 60vh;
        }

        /* Order Detail Content */
        .customer-section {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding: 16px;
            background: var(--tg-secondary-bg);
            border-radius: 12px;
        }

        .customer-avatar.large {
            width: 48px;
            height: 48px;
            font-size: 18px;
        }

        .customer-details h3 {
            font-size: 16px;
            margin-bottom: 4px;
        }

        .customer-id {
            font-size: 12px;
            color: var(--tg-secondary-text);
            font-family: 'Monaco', 'Courier New', monospace;
        }

        .items-section {
            margin: 20px 0;
        }

        .section-title {
            font-size: 14px;
            color: var(--tg-secondary-text);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .item-row:last-child {
            border-bottom: none;
        }

        .item-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .item-emoji {
            font-size: 20px;
            width: 36px;
            text-align: center;
        }

        .item-details h4 {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .item-price {
            font-size: 14px;
            color: var(--tg-green);
            font-weight: 600;
        }

        .item-quantity {
            font-size: 12px;
            color: var(--tg-secondary-text);
        }

        .total-section {
            margin-top: 24px;
            padding-top: 16px;
            border-top: 2px solid var(--tg-border);
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 18px;
            font-weight: 700;
            margin-top: 8px;
        }

        .total-amount {
            color: var(--tg-green);
            font-size: 22px;
        }

        .meta-section {
            margin-top: 20px;
            padding: 16px;
            background: var(--tg-secondary-bg);
            border-radius: 12px;
        }

        .meta-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 14px;
        }

        .meta-label {
            color: var(--tg-secondary-text);
        }

        .meta-value {
            font-weight: 500;
            font-family: 'Monaco', 'Courier New', monospace;
        }

        .modal-actions {
            padding: 16px;
            border-top: 1px solid var(--tg-border);
            display: flex;
            gap: 12px;
        }

        .action-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-btn.primary {
            background: var(--tg-accent);
            color: white;
        }

        .action-btn.primary:hover {
            background: #1d8ed8;
        }

        .action-btn.secondary {
            background: var(--tg-secondary-bg);
            color: var(--tg-text);
        }

        .action-btn.secondary:hover {
            background: #2c3b4d;
        }

        /* Filter Buttons */
        .filter-buttons {
            display: flex;
            gap: 8px;
            padding: 12px;
            background: var(--tg-secondary-bg);
            position: sticky;
            top: 105px;
            z-index: 98;
        }

        .filter-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid var(--tg-border);
            background: var(--tg-card-bg);
            color: var(--tg-text);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn.active {
            background: var(--tg-accent);
            border-color: var(--tg-accent);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--tg-secondary-text);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Search Bar */
        .search-container {
            padding: 12px;
            background: var(--tg-secondary-bg);
            position: sticky;
            top: 105px;
            z-index: 98;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            background: var(--tg-card-bg);
            border: 1px solid var(--tg-border);
            border-radius: 12px;
            color: var(--tg-text);
            font-size: 15px;
            outline: none;
        }

        .search-input::placeholder {
            color: var(--tg-secondary-text);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--tg-secondary-text);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--tg-secondary-bg);
            color: var(--tg-text);
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1100;
            opacity: 0;
            transition: all 0.3s;
            max-width: 90%;
            text-align: center;
            border: 1px solid var(--tg-border);
            backdrop-filter: blur(10px);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--tg-secondary-text);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--tg-border);
            border-top-color: var(--tg-accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .order-card {
            animation: fadeIn 0.3s ease-out;
        }

        /* Print Styles */
        @media print {
            .tabs, .filter-buttons, .search-container, .modal-overlay {
                display: none !important;
            }
            
            .order-card {
                break-inside: avoid;
                border: 1px solid #000 !important;
                margin: 10px 0 !important;
            }
        }

        /* Responsive */
        @media (max-width: 480px) {
            .order-card {
                margin: 6px 8px;
            }
            
            .modal {
                max-height: 90vh;
            }
            
            .modal-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Main App -->
    <div id="app" class="container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="app-title">
                    <span>üìä ORDERS HISTORY</span>
                </div>
                <div class="stats-badge" id="orders-count">20 orders</div>
            </div>
        </header>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="all">All Orders</button>
            <button class="tab" data-tab="today">Today</button>
            <button class="tab" data-tab="week">This Week</button>
        </div>

        <!-- Search -->
        <div class="search-container">
            <div class="search-box">
                <i class="search-icon">üîç</i>
                <input type="text" class="search-input" id="search-input" placeholder="Search by customer or order ID...">
            </div>
        </div>

        <!-- Orders List -->
        <div class="orders-list" id="orders-list">
            <!-- Orders loaded dynamically -->
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading orders...</p>
            </div>
        </div>

        <!-- Summary Card -->
        <div class="summary-card">
            <div class="summary-row">
                <span class="summary-label">üìà Total Orders</span>
                <span class="summary-value" id="total-orders">20</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">üí∞ Total Revenue</span>
                <span class="summary-value" id="total-revenue">$123</span>
            </div>
            <div class="summary-row summary-total">
                <span class="summary-label">üìä Average Order</span>
                <span class="summary-value" id="average-order">$6.15</span>
            </div>
        </div>
    </div>

    <!-- Order Detail Modal -->
    <div class="modal-overlay" id="order-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">
                    <span>‚úÖ ORDER COMPLETED!</span>
                </div>
                <div class="modal-subtitle" id="modal-subtitle">Order details</div>
            </div>
            
            <div class="modal-body">
                <!-- Customer Info -->
                <div class="customer-section">
                    <div class="customer-avatar large" id="customer-avatar">H</div>
                    <div class="customer-details">
                        <h3 id="customer-name">Hero</h3>
                        <div class="customer-id" id="customer-id">CUST001</div>
                    </div>
                </div>

                <!-- Items List -->
                <div class="items-section">
                    <div class="section-title">Items</div>
                    <div id="order-items">
                        <!-- Items loaded dynamically -->
                    </div>
                </div>

                <!-- Total -->
                <div class="total-section">
                    <div class="section-title">Payment</div>
                    <div class="total-row">
                        <span>TOTAL:</span>
                        <span class="total-amount" id="order-total">$15</span>
                    </div>
                </div>

                <!-- Order Meta -->
                <div class="meta-section">
                    <div class="meta-row">
                        <span class="meta-label">üÜî Order ID</span>
                        <span class="meta-value" id="modal-order-id">ORDER20251112112138</span>
                    </div>
                    <div class="meta-row">
                        <span class="meta-label">‚è∞ Time</span>
                        <span class="meta-value" id="modal-time">2025-11-12 11:21</span>
                    </div>
                    <div class="meta-row">
                        <span class="meta-label">üìù Status</span>
                        <span class="meta-value" id="modal-status">Completed</span>
                    </div>
                    <div class="meta-row">
                        <span class="meta-label">üíæ Storage</span>
                        <span class="meta-value" id="modal-storage">Local Database</span>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button class="action-btn secondary" onclick="closeModal()">
                    <span>‚Üê Back</span>
                </button>
                <button class="action-btn primary" onclick="reprintOrder()">
                    <span>üñ®Ô∏è Reprint</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // =================== INITIALIZATION ===================
        const tg = window.Telegram.WebApp;
        let orders = [];
        let filteredOrders = [];
        let currentTab = 'all';
        let currentSearch = '';

        // Sample data with your exact format
        const sampleOrders = [
            {
                id: 'ORDER20251112104950',
                customer: { name: 'kotharey', avatar: 'K', id: 'CUST001' },
                amount: 5,
                time: '2025-11-12 10:49',
                status: 'completed',
                items: [
                    { name: 'Coffee', emoji: '‚òï', price: 5, quantity: 1 }
                ],
                payment: { method: 'Cash', status: 'paid' }
            },
            {
                id: 'ORDER20251112093405',
                customer: { name: 'fallo', avatar: 'F', id: 'CUST002' },
                amount: 10,
                time: '2025-11-12 09:34',
                status: 'completed',
                items: [
                    { name: 'Burger', emoji: 'üçî', price: 8, quantity: 1 },
                    { name: 'Fries', emoji: 'üçü', price: 2, quantity: 1 }
                ],
                payment: { method: 'Card', status: 'paid' }
            },
            {
                id: 'ORDER20251112080624',
                customer: { name: 'Fallo', avatar: 'F', id: 'CUST003' },
                amount: 20,
                time: '2025-11-12 08:06',
                status: 'completed',
                items: [
                    { name: 'Pizza', emoji: 'üçï', price: 15, quantity: 1 },
                    { name: 'Coke', emoji: 'ü•§', price: 3, quantity: 1 },
                    { name: 'Ice Cream', emoji: 'üç¶', price: 2, quantity: 1 }
                ],
                payment: { method: 'Cash', status: 'paid' }
            },
            {
                id: 'ORDER20251112074947',
                customer: { name: 'fallo', avatar: 'F', id: 'CUST004' },
                amount: 15,
                time: '2025-11-12 07:49',
                status: 'pending',
                items: [
                    { name: 'Coffee', emoji: '‚òï', price: 5, quantity: 2 },
                    { name: 'Croissant', emoji: 'ü•ê', price: 5, quantity: 1 }
                ],
                payment: { method: 'Card', status: 'pending' }
            },
            {
                id: 'ORDER20251111175440',
                customer: { name: 'Faudy', avatar: 'F', id: 'CUST005' },
                amount: 13,
                time: '2025-11-11 17:54',
                status: 'completed',
                items: [
                    { name: 'Tea', emoji: 'üçµ', price: 3, quantity: 1 },
                    { name: 'Sandwich', emoji: 'ü•™', price: 10, quantity: 1 }
                ],
                payment: { method: 'Cash', status: 'paid' }
            },
            {
                id: 'ORDER20251111174601',
                customer: { name: 'fallo', avatar: 'F', id: 'CUST006' },
                amount: 10,
                time: '2025-11-11 17:46',
                status: 'completed',
                items: [
                    { name: 'Water', emoji: 'üíß', price: 5, quantity: 2 }
                ],
                payment: { method: 'Card', status: 'paid' }
            },
            {
                id: 'ORDER20251111174214',
                customer: { name: 'fallo', avatar: 'F', id: 'CUST007' },
                amount: 10,
                time: '2025-11-11 17:42',
                status: 'cancelled',
                items: [
                    { name: 'Coffee', emoji: '‚òï', price: 5, quantity: 2 }
                ],
                payment: { method: 'Cash', status: 'refunded' }
            },
            {
                id: 'ORDER20251111153412',
                customer: { name: 'fallo', avatar: 'F', id: 'CUST008' },
                amount: 20,
                time: '2025-11-11 15:34',
                status: 'completed',
                items: [
                    { name: 'Steak', emoji: 'ü•©', price: 18, quantity: 1 },
                    { name: 'Water', emoji: 'üíß', price: 2, quantity: 1 }
                ],
                payment: { method: 'Card', status: 'paid' }
            },
            {
                id: 'ORDER20251111152237',
                customer: { name: 'Siday', avatar: 'S', id: 'CUST009' },
                amount: 10,
                time: '2025-11-11 15:22',
                status: 'completed',
                items: [
                    { name: 'Salad', emoji: 'ü•ó', price: 8, quantity: 1 },
                    { name: 'Juice', emoji: 'üßÉ', price: 2, quantity: 1 }
                ],
                payment: { method: 'Cash', status: 'paid' }
            },
            {
                id: 'ORDER20251111144545',
                customer: { name: 'fallo', avatar: 'F', id: 'CUST010' },
                amount: 10,
                time: '2025-11-11 14:45',
                status: 'completed',
                items: [
                    { name: 'Pasta', emoji: 'üçù', price: 10, quantity: 1 }
                ],
                payment: { method: 'Card', status: 'paid' }
            },
            {
                id: 'ORDER20251111133412',
                customer: { name: 'John', avatar: 'J', id: 'CUST011' },
                amount: 8,
                time: '2025-11-11 13:34',
                status: 'completed',
                items: [
                    { name: 'Coffee', emoji: '‚òï', price: 4, quantity: 2 }
                ],
                payment: { method: 'Cash', status: 'paid' }
            },
            {
                id: 'ORDER20251111122137',
                customer: { name: 'Emma', avatar: 'E', id: 'CUST012' },
                amount: 12,
                time: '2025-11-11 12:21',
                status: 'completed',
                items: [
                    { name: 'Cake', emoji: 'üç∞', price: 6, quantity: 2 }
                ],
                payment: { method: 'Card', status: 'paid' }
            },
            {
                id: 'ORDER20251111111549',
                customer: { name: 'Mike', avatar: 'M', id: 'CUST013' },
                amount: 18,
                time: '2025-11-11 11:15',
                status: 'completed',
                items: [
                    { name: 'Burger', emoji: 'üçî', price: 9, quantity: 2 }
                ],
                payment: { method: 'Cash', status: 'paid' }
            },
            {
                id: 'ORDER20251111100928',
                customer: { name: 'Sarah', avatar: 'S', id: 'CUST014' },
                amount: 7,
                time: '2025-11-11 10:09',
                status: 'completed',
                items: [
                    { name: 'Tea', emoji: 'üçµ', price: 3.5, quantity: 2 }
                ],
                payment: { method: 'Card', status: 'paid' }
            },
            {
                id: 'ORDER20251111085716',
                customer: { name: 'David', avatar: 'D', id: 'CUST015' },
                amount: 22,
                time: '2025-11-11 08:57',
                status: 'completed',
                items: [
                    { name: 'Pizza', emoji: 'üçï', price: 15, quantity: 1 },
                    { name: 'Beer', emoji: 'üç∫', price: 7, quantity: 1 }
                ],
                payment: { method: 'Cash', status: 'paid' }
            },
            {
                id: 'ORDER20251111074503',
                customer: { name: 'Lisa', avatar: 'L', id: 'CUST016' },
                amount: 9,
                time: '2025-11-11 07:45',
                status: 'completed',
                items: [
                    { name: 'Croissant', emoji: 'ü•ê', price: 4.5, quantity: 2 }
                ],
                payment: { method: 'Card', status: 'paid' }
            },
            {
                id: 'ORDER20251111063251',
                customer: { name: 'Tom', avatar: 'T', id: 'CUST017' },
                amount: 14,
                time: '2025-11-11 06:32',
                status: 'completed',
                items: [
                    { name: 'Breakfast Set', emoji: 'üç≥', price: 14, quantity: 1 }
                ],
                payment: { method: 'Cash', status: 'paid' }
            },
            {
                id: 'ORDER20251111052148',
                customer: { name: 'Anna', avatar: 'A', id: 'CUST018' },
                amount: 6,
                time: '2025-11-11 05:21',
                status: 'completed',
                items: [
                    { name: 'Coffee', emoji: '‚òï', price: 3, quantity: 2 }
                ],
                payment: { method: 'Card', status: 'paid' }
            },
            {
                id: 'ORDER20251111041537',
                customer: { name: 'Peter', avatar: 'P', id: 'CUST019' },
                amount: 16,
                time: '2025-11-11 04:15',
                status: 'completed',
                items: [
                    { name: 'Steak', emoji: 'ü•©', price: 16, quantity: 1 }
                ],
                payment: { method: 'Cash', status: 'paid' }
            },
            {
                id: 'ORDER20251111031226',
                customer: { name: 'Maria', avatar: 'M', id: 'CUST020' },
                amount: 11,
                time: '2025-11-11 03:12',
                status: 'completed',
                items: [
                    { name: 'Pasta', emoji: 'üçù', price: 11, quantity: 1 }
                ],
                payment: { method: 'Card', status: 'paid' }
            }
        ];

        // =================== DOM ELEMENTS ===================
        const ordersListEl = document.getElementById('orders-list');
        const ordersCountEl = document.getElementById('orders-count');
        const totalOrdersEl = document.getElementById('total-orders');
        const totalRevenueEl = document.getElementById('total-revenue');
        const averageOrderEl = document.getElementById('average-order');
        const searchInputEl = document.getElementById('search-input');
        const orderModalEl = document.getElementById('order-modal');
        const toastEl = document.getElementById('toast');
        const tabs = document.querySelectorAll('.tab');

        // =================== INITIAL LOAD ===================
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Telegram Web App
            tg.expand();
            tg.setHeaderColor('#18222d');
            tg.setBackgroundColor('#18222d');
            
            // Load orders from localStorage or use sample data
            loadOrders();
            
            // Setup event listeners
            setupEventListeners();
            
            // Initial render
            renderOrders();
            updateStats();
        });

        function setupEventListeners() {
            // Tab switching
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    currentTab = tab.dataset.tab;
                    filterOrders();
                });
            });

            // Search
            searchInputEl.addEventListener('input', () => {
                currentSearch = searchInputEl.value.toLowerCase();
                filterOrders();
            });

            // Close modal on overlay click
            orderModalEl.addEventListener('click', (e) => {
                if (e.target === orderModalEl) {
                    closeModal();
                }
            });

            // Escape key to close modal
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && orderModalEl.classList.contains('active')) {
                    closeModal();
                }
            });
        }

        function loadOrders() {
            // Try to load from localStorage first
            const savedOrders = localStorage.getItem('cafe_orders');
            if (savedOrders) {
                orders = JSON.parse(savedOrders);
            } else {
                // Use sample data and save it
                orders = sampleOrders;
                localStorage.setItem('cafe_orders', JSON.stringify(orders));
            }
            
            // Sort by time (newest first)
            orders.sort((a, b) => new Date(b.time) - new Date(a.time));
        }

        function filterOrders() {
            let filtered = [...orders];
            
            // Apply tab filter
            const now = new Date();
            if (currentTab === 'today') {
                const today = now.toISOString().split('T')[0];
                filtered = filtered.filter(order => order.time.startsWith(today));
            } else if (currentTab === 'week') {
                const weekAgo = new Date(now - 7 * 24 * 60 * 60 * 1000);
                filtered = filtered.filter(order => new Date(order.time) >= weekAgo);
            }
            
            // Apply search filter
            if (currentSearch) {
                filtered = filtered.filter(order => 
                    order.customer.name.toLowerCase().includes(currentSearch) ||
                    order.id.toLowerCase().includes(currentSearch) ||
                    order.items.some(item => item.name.toLowerCase().includes(currentSearch))
                );
            }
            
            filteredOrders = filtered;
            renderOrders();
        }

        function renderOrders() {
            if (filteredOrders.length === 0) {
                ordersListEl.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <h3>No orders found</h3>
                        <p>${currentSearch ? 'Try a different search' : 'No orders in this period'}</p>
                    </div>
                `;
                return;
            }
            
            let ordersHTML = '';
            
            filteredOrders.forEach((order, index) => {
                const orderDate = new Date(order.time);
                const formattedTime = `${orderDate.getHours().toString().padStart(2, '0')}:${orderDate.getMinutes().toString().padStart(2, '0')}`;
                const formattedDate = `${(orderDate.getMonth() + 1).toString().padStart(2, '0')}/${orderDate.getDate().toString().padStart(2, '0')}`;
                
                ordersHTML += `
                    <div class="order-card" onclick="viewOrder('${order.id}')">
                        <div class="order-header">
                            <div class="order-id">${order.id}</div>
                            <div class="order-status status-${order.status}">${order.status}</div>
                        </div>
                        <div class="order-body">
                            <div class="order-info">
                                <div class="customer-avatar">${order.customer.avatar}</div>
                                <div class="customer-info">
                                    <div class="customer-name">${order.customer.name}</div>
                                </div>
                            </div>
                            <div class="order-meta">
                                <div class="order-amount">$${order.amount}</div>
                                <div class="order-time">${formattedDate} ${formattedTime}</div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add divider if not last item
                if (index < filteredOrders.length - 1) {
                    ordersHTML += '<div class="divider"></div>';
                }
            });
            
            ordersListEl.innerHTML = ordersHTML;
        }

        function viewOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            // Format date and time
            const orderDate = new Date(order.time);
            const formattedDate = orderDate.toISOString().split('T')[0];
            const formattedTime = `${orderDate.getHours().toString().padStart(2, '0')}:${orderDate.getMinutes().toString().padStart(2, '0')}`;
            const fullDateTime = `${formattedDate} ${formattedTime}`;
            
            // Update modal content
            document.getElementById('customer-avatar').textContent = order.customer.avatar;
            document.getElementById('customer-name').textContent = order.customer.name;
            document.getElementById('customer-id').textContent = order.customer.id;
            document.getElementById('modal-order-id').textContent = order.id;
            document.getElementById('modal-time').textContent = fullDateTime;
            document.getElementById('order-total').textContent = `$${order.amount}`;
            document.getElementById('modal-status').textContent = order.status.charAt(0).toUpperCase() + order.status.slice(1);
            document.getElementById('modal-storage').textContent = 'Local Database';
            
            // Build items list
            let itemsHTML = '';
            order.items.forEach(item => {
                const itemTotal = item.price * item.quantity;
                itemsHTML += `
                    <div class="item-row">
                        <div class="item-info">
                            <div class="item-emoji">${item.emoji}</div>
                            <div class="item-details">
                                <h4>${item.name}</h4>
                                <div class="item-quantity">x${item.quantity}</div>
                            </div>
                        </div>
                        <div class="item-price">$${itemTotal}</div>
                    </div>
                `;
            });
            document.getElementById('order-items').innerHTML = itemsHTML;
            
            // Update subtitle based on status
            const subtitleMap = {
                'completed': '‚úÖ Order completed successfully',
                'pending': '‚è≥ Order is being processed',
                'cancelled': '‚ùå Order was cancelled'
            };
            document.getElementById('modal-subtitle').textContent = subtitleMap[order.status] || 'Order details';
            
            // Open modal
            orderModalEl.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Haptic feedback
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }

        function closeModal() {
            orderModalEl.classList.remove('active');
            document.body.style.overflow = '';
        }

        function updateStats() {
            const totalOrders = orders.length;
            const totalRevenue = orders.reduce((sum, order) => sum + order.amount, 0);
            const averageOrder = totalOrders > 0 ? (totalRevenue / totalOrders).toFixed(2) : 0;
            const today = new Date().toISOString().split('T')[0];
            const todayOrders = orders.filter(order => order.time.startsWith(today)).length;
            
            // Update counters
            ordersCountEl.textContent = `${totalOrders} orders`;
            totalOrdersEl.textContent = totalOrders;
            totalRevenueEl.textContent = `$${totalRevenue}`;
            averageOrderEl.textContent = `$${averageOrder}`;
            
            // Update Telegram Main Button with today's stats
            tg.MainButton.setParams({
                text: `üìä Today: ${todayOrders} orders`,
                color: '#2ea6ff',
                text_color: '#ffffff'
            });
            tg.MainButton.show();
        }

        function reprintOrder() {
            const orderId = document.getElementById('modal-order-id').textContent;
            showToast(`üñ®Ô∏è Reprinting order ${orderId}...`, 'info');
            
            // Simulate reprint action
            setTimeout(() => {
                showToast('‚úÖ Receipt sent to printer', 'success');
            }, 1000);
        }

        function showToast(message, type = 'info') {
            toastEl.textContent = message;
            toastEl.className = 'toast';
            toastEl.classList.add('show');
            
            // Add type class if needed
            if (type === 'success') {
                toastEl.style.background = 'rgba(51, 198, 89, 0.9)';
            } else if (type === 'error') {
                toastEl.style.background = 'rgba(255, 59, 48, 0.9)';
            } else if (type === 'warning') {
                toastEl.style.background = 'rgba(255, 204, 0, 0.9)';
            }
            
            setTimeout(() => {
                toastEl.classList.remove('show');
            }, 3000);
        }

        // =================== TELEGRAM INTEGRATION ===================
        tg.MainButton.onClick(() => {
            // Show today's summary
            const today = new Date().toISOString().split('T')[0];
            const todayOrders = orders.filter(order => order.time.startsWith(today));
            const todayRevenue = todayOrders.reduce((sum, order) => sum + order.amount, 0);
            
            showToast(`üìä Today: ${todayOrders.length} orders, $${todayRevenue} revenue`, 'info');
        });

        // Handle back button
        tg.BackButton.onClick(() => {
            if (orderModalEl.classList.contains('active')) {
                closeModal();
            } else {
                tg.close();
            }
        });

        // Show back button when modal is open
        const observer = new MutationObserver(() => {
            if (orderModalEl.classList.contains('active')) {
                tg.BackButton.show();
            } else {
                tg.BackButton.hide();
            }
        });

        observer.observe(orderModalEl, { attributes: true, attributeFilter: ['class'] });

        // =================== DATA MANAGEMENT ===================
        function addTestOrder() {
            const newOrder = {
                id: `ORDER${new Date().toISOString().replace(/[-:T.Z]/g, '').slice(0, 14)}`,
                customer: { 
                    name: 'Test Customer', 
                    avatar: 'T', 
                    id: `CUST${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}`
                },
                amount: Math.floor(Math.random() * 50) + 5,
                time: new Date().toISOString().replace('T', ' ').slice(0, 19),
                status: 'completed',
                items: [
                    { name: 'Test Item', emoji: 'üß™', price: 10, quantity: 1 }
                ],
                payment: { method: 'Cash', status: 'paid' }
            };
            
            orders.unshift(newOrder);
            localStorage.setItem('cafe_orders', JSON.stringify(orders));
            filterOrders();
            updateStats();
            showToast('‚úÖ Test order added', 'success');
        }

        function exportOrders() {
            const dataStr = JSON.stringify(orders, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `orders_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('üìÅ Orders exported to JSON', 'success');
        }

        function clearAllOrders() {
            if (confirm('Are you sure you want to clear all orders? This cannot be undone.')) {
                localStorage.removeItem('cafe_orders');
                orders = [];
                filterOrders();
                updateStats();
                showToast('üóëÔ∏è All orders cleared', 'warning');
            }
        }

        // Expose functions to console for testing
        window.addTestOrder = addTestOrder;
        window.exportOrders = exportOrders;
        window.clearAllOrders = clearAllOrders;
    </script>
</body>
</html>
