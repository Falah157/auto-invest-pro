<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Islamic Food Business Tracker</title>
    <style>
        :root {
            --primary-bg: #0a0a0a;
            --secondary-bg: #1a1a1a;
            --accent-color: #FF8C00;
            --accent-light: #FFA500;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --success: #00aa00;
            --danger: #ff4444;
            --border-color: #333333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--primary-bg);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 20px;
            border-bottom: 2px solid var(--accent-color);
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--secondary-bg), var(--primary-bg));
            border-radius: 10px;
        }

        h1 {
            color: var(--accent-color);
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1em;
        }

        .bismillah {
            font-size: 1.5em;
            color: var(--accent-light);
            margin-top: 10px;
            font-weight: bold;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: var(--secondary-bg);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-color);
        }

        .card-title {
            color: var(--accent-color);
            font-size: 1.3em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .stat-box {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .stat-label {
            color: var(--text-secondary);
        }

        .stat-value {
            color: var(--accent-light);
            font-weight: bold;
        }

        .profit {
            color: var(--success);
        }

        .loss {
            color: var(--danger);
        }

        .tabs {
            display: flex;
            background-color: var(--secondary-bg);
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            margin-bottom: 0;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background-color: var(--secondary-bg);
            color: var(--text-secondary);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .tab:hover {
            background-color: #2a2a2a;
        }

        .tab.active {
            background-color: var(--accent-color);
            color: var(--primary-bg);
        }

        .tab-content {
            display: none;
            background-color: var(--secondary-bg);
            padding: 20px;
            border-radius: 0 0 10px 10px;
            border: 1px solid var(--border-color);
            border-top: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            background-color: var(--primary-bg);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            color: var(--text-primary);
            font-size: 1em;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .btn {
            background-color: var(--accent-color);
            color: var(--primary-bg);
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
            margin-top: 10px;
        }

        .btn:hover {
            background-color: var(--accent-light);
        }

        .btn-secondary {
            background-color: var(--border-color);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background-color: #444444;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background-color: var(--primary-bg);
            color: var(--accent-color);
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid var(--accent-color);
        }

        td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        tr:hover {
            background-color: rgba(255, 140, 0, 0.1);
        }

        .actions {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .edit-btn {
            background-color: var(--accent-color);
            color: var(--primary-bg);
        }

        .delete-btn {
            background-color: var(--danger);
            color: white;
        }

        .dua-box {
            background: linear-gradient(135deg, var(--primary-bg), #1a0a00);
            border-left: 4px solid var(--accent-color);
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-style: italic;
        }

        .arabic {
            font-size: 1.2em;
            text-align: right;
            direction: rtl;
            margin-bottom: 10px;
            color: var(--accent-light);
        }

        .translation {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            display: none;
        }

        .alert.success {
            background-color: rgba(0, 170, 0, 0.2);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .alert.error {
            background-color: rgba(255, 68, 68, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üçåü•• Islamic Food Business Tracker</h1>
            <div class="subtitle">Track your halal business with barakah</div>
            <div class="bismillah">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸíŸÖŸê</div>
        </header>

        <div class="dua-box">
            <div class="arabic">ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ®Ÿéÿßÿ±ŸêŸÉŸí ŸÑŸêŸä ŸÅŸêŸäŸÖŸéÿß ÿ±Ÿéÿ≤ŸéŸÇŸíÿ™ŸéŸÜŸêŸä</div>
            <div class="translation">"O Allah, bless me in what You have provided me."</div>
        </div>

        <div id="alert" class="alert"></div>

        <div class="dashboard">
            <div class="card">
                <h3 class="card-title">üìä Today's Summary</h3>
                <div class="stat-box">
                    <span class="stat-label">Total Items Made:</span>
                    <span class="stat-value" id="totalMade">0</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">Total Items Sold:</span>
                    <span class="stat-value" id="totalSold">0</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">Total Revenue:</span>
                    <span class="stat-value" id="totalRevenue">0 MVR</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">Total Profit:</span>
                    <span class="stat-value profit" id="totalProfit">0 MVR</span>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">üí∞ Weekly Stats</h3>
                <div class="stat-box">
                    <span class="stat-label">Week Profit:</span>
                    <span class="stat-value profit" id="weekProfit">0 MVR</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">Best Seller:</span>
                    <span class="stat-value" id="bestSeller">-</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">Profit Margin:</span>
                    <span class="stat-value" id="profitMargin">0%</span>
                </div>
                <button class="btn" onclick="viewReport()">üìà View Full Report</button>
            </div>

            <div class="card">
                <h3 class="card-title">üì¶ Inventory Status</h3>
                <div id="inventoryList">
                    <div class="stat-box">
                        <span class="stat-label">Bananas:</span>
                        <span class="stat-value">Loading...</span>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="showTab('inventory')">Manage Inventory</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('ingredients')">üõí Ingredients</button>
            <button class="tab" onclick="showTab('recipes')">üçΩÔ∏è Recipes</button>
            <button class="tab" onclick="showTab('sales')">üí∞ Daily Sales</button>
            <button class="tab" onclick="showTab('inventory')">üì¶ Inventory</button>
        </div>

        <div id="ingredients" class="tab-content active">
            <h2 class="card-title">Manage Ingredients</h2>
            <form id="ingredientForm">
                <div class="form-group">
                    <label for="ingredientName">Ingredient Name:</label>
                    <input type="text" id="ingredientName" required>
                </div>
                <div class="form-group">
                    <label for="quantity">Quantity:</label>
                    <input type="number" id="quantity" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="unit">Unit:</label>
                    <select id="unit" required>
                        <option value="piece">Piece</option>
                        <option value="gram">Gram (g)</option>
                        <option value="kg">Kilogram (kg)</option>
                        <option value="ml">Milliliter (ml)</option>
                        <option value="liter">Liter (L)</option>
                        <option value="pack">Pack</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="purchasePrice">Purchase Price (MVR):</label>
                    <input type="number" id="purchasePrice" step="0.01" required>
                </div>
                <button type="submit" class="btn">‚ûï Add Ingredient</button>
            </form>

            <div class="table-container">
                <h3 class="card-title">Ingredient List</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Quantity</th>
                            <th>Unit</th>
                            <th>Cost/Unit</th>
                            <th>Total Value</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="ingredientTable">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div id="recipes" class="tab-content">
            <h2 class="card-title">Manage Recipes</h2>
            <form id="recipeForm">
                <div class="form-group">
                    <label for="recipeName">Recipe Name:</label>
                    <input type="text" id="recipeName" required>
                </div>
                <div class="form-group">
                    <label for="piecesMade">Pieces Made per Batch:</label>
                    <input type="number" id="piecesMade" required>
                </div>
                <div class="form-group">
                    <label for="sellingPrice">Selling Price per Piece (MVR):</label>
                    <input type="number" id="sellingPrice" step="0.01" required>
                </div>
                <h3 class="card-title">Ingredients for this Recipe</h3>
                <div id="recipeIngredients">
                    <div class="form-group">
                        <select class="ingredient-select">
                            <option value="">Select Ingredient</option>
                        </select>
                        <input type="number" class="ingredient-qty" placeholder="Quantity" step="0.01">
                        <button type="button" class="btn-secondary" onclick="addIngredientRow()">‚ûï Add More</button>
                    </div>
                </div>
                <button type="submit" class="btn">üç≥ Save Recipe</button>
            </form>

            <div class="table-container">
                <h3 class="card-title">Recipe List</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Recipe</th>
                            <th>Cost/Piece</th>
                            <th>Sell Price</th>
                            <th>Profit/Piece</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="recipeTable">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div id="sales" class="tab-content">
            <h2 class="card-title">Daily Sales Tracking</h2>
            <form id="salesForm">
                <div class="form-group">
                    <label for="salesDate">Date:</label>
                    <input type="date" id="salesDate" required>
                </div>
                <div class="form-group">
                    <label for="salesRecipe">Select Recipe:</label>
                    <select id="salesRecipe" required>
                        <option value="">Select Recipe</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="piecesMadeToday">Pieces Made Today:</label>
                    <input type="number" id="piecesMadeToday" required>
                </div>
                <div class="form-group">
                    <label for="piecesSoldToday">Pieces Sold Today:</label>
                    <input type="number" id="piecesSoldToday" required>
                </div>
                <button type="submit" class="btn">üìä Record Sales</button>
            </form>

            <div class="table-container">
                <h3 class="card-title">Sales History</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Item</th>
                            <th>Made</th>
                            <th>Sold</th>
                            <th>Cost</th>
                            <th>Revenue</th>
                            <th>Profit</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="salesTable">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div id="inventory" class="tab-content">
            <h2 class="card-title">Inventory Management</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Ingredient</th>
                            <th>Current Stock</th>
                            <th>Used Today</th>
                            <th>Remaining</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryTable">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
            <button class="btn" onclick="generateShoppingList()">üõçÔ∏è Generate Shopping List</button>
            <div id="shoppingList" class="card" style="display: none; margin-top: 20px;">
                <h3 class="card-title">üõí Shopping List</h3>
                <div id="shoppingItems"></div>
            </div>
        </div>

        <div class="dua-box" style="margin-top: 40px;">
            <div class="arabic">ÿ±Ÿéÿ®ŸêŸë ÿ≤ŸêÿØŸíŸÜŸêŸä ÿπŸêŸÑŸíŸÖŸãÿß ŸàŸéÿßÿ±Ÿíÿ≤ŸèŸÇŸíŸÜŸêŸä ŸÅŸéŸáŸíŸÖŸãÿß</div>
            <div class="translation">"My Lord, increase me in knowledge and grant me understanding."</div>
        </div>
    </div>

    <script>
        // Data storage
        let ingredients = JSON.parse(localStorage.getItem('ingredients')) || [];
        let recipes = JSON.parse(localStorage.getItem('recipes')) || [];
        let sales = JSON.parse(localStorage.getItem('sales')) || [];
        
        // Sample data if empty
        if (ingredients.length === 0) {
            ingredients = [
                { id: 1, name: "Banana", quantity: 10, unit: "piece", purchasePrice: 50 },
                { id: 2, name: "Milk Chocolate", quantity: 200, unit: "gram", purchasePrice: 30 },
                { id: 3, name: "Peanuts", quantity: 100, unit: "gram", purchasePrice: 10 },
                { id: 4, name: "Desiccated Coconut", quantity: 500, unit: "gram", purchasePrice: 25 },
                { id: 5, name: "Condensed Milk", quantity: 200, unit: "ml", purchasePrice: 16 },
                { id: 6, name: "Cardamom Powder", quantity: 50, unit: "gram", purchasePrice: 20 }
            ];
            saveIngredients();
        }

        if (recipes.length === 0) {
            recipes = [
                {
                    id: 1,
                    name: "Chocolate Banana Bites",
                    piecesPerBatch: 10,
                    sellPrice: 8,
                    ingredients: [
                        { ingredientId: 1, quantity: 2 },
                        { ingredientId: 2, quantity: 100 },
                        { ingredientId: 3, quantity: 50 }
                    ]
                },
                {
                    id: 2,
                    name: "Coconut Cardamom Balls",
                    piecesPerBatch: 10,
                    sellPrice: 6,
                    ingredients: [
                        { ingredientId: 4, quantity: 200 },
                        { ingredientId: 5, quantity: 100 },
                        { ingredientId: 6, quantity: 10 }
                    ]
                }
            ];
            saveRecipes();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadIngredientsTable();
            loadRecipesTable();
            loadSalesTable();
            loadInventoryTable();
            updateDashboard();
            populateRecipeSelect();
            populateIngredientSelect();
        });

        // Save functions
        function saveIngredients() {
            localStorage.setItem('ingredients', JSON.stringify(ingredients));
        }

        function saveRecipes() {
            localStorage.setItem('recipes', JSON.stringify(recipes));
        }

        function saveSales() {
            localStorage.setItem('sales', JSON.stringify(sales));
        }

        // Tab switching
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Alert system
        function showAlert(message, type = 'success') {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert ${type}`;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 3000);
        }

        // INGREDIENTS MANAGEMENT
        document.getElementById('ingredientForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const ingredient = {
                id: Date.now(),
                name: document.getElementById('ingredientName').value,
                quantity: parseFloat(document.getElementById('quantity').value),
                unit: document.getElementById('unit').value,
                purchasePrice: parseFloat(document.getElementById('purchasePrice').value)
            };
            
            ingredients.push(ingredient);
            saveIngredients();
            loadIngredientsTable();
            loadInventoryTable();
            updateDashboard();
            populateIngredientSelect();
            
            showAlert(`Ingredient "${ingredient.name}" added successfully!`);
            this.reset();
        });

        function loadIngredientsTable() {
            const tbody = document.getElementById('ingredientTable');
            tbody.innerHTML = '';
            
            ingredients.forEach(ingredient => {
                const costPerUnit = ingredient.purchasePrice / ingredient.quantity;
                const totalValue = ingredient.purchasePrice;
                
                const row = `
                    <tr>
                        <td>${ingredient.name}</td>
                        <td>${ingredient.quantity}</td>
                        <td>${ingredient.unit}</td>
                        <td>${costPerUnit.toFixed(2)} MVR</td>
                        <td>${totalValue.toFixed(2)} MVR</td>
                        <td class="actions">
                            <button class="action-btn edit-btn" onclick="editIngredient(${ingredient.id})">‚úèÔ∏è</button>
                            <button class="action-btn delete-btn" onclick="deleteIngredient(${ingredient.id})">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function editIngredient(id) {
            const ingredient = ingredients.find(i => i.id === id);
            if (ingredient) {
                document.getElementById('ingredientName').value = ingredient.name;
                document.getElementById('quantity').value = ingredient.quantity;
                document.getElementById('unit').value = ingredient.unit;
                document.getElementById('purchasePrice').value = ingredient.purchasePrice;
                
                // Remove from array
                ingredients = ingredients.filter(i => i.id !== id);
                saveIngredients();
                showAlert(`Editing "${ingredient.name}"`);
            }
        }

        function deleteIngredient(id) {
            if (confirm('Are you sure you want to delete this ingredient?')) {
                ingredients = ingredients.filter(i => i.id !== id);
                saveIngredients();
                loadIngredientsTable();
                loadInventoryTable();
                updateDashboard();
                showAlert('Ingredient deleted successfully!');
            }
        }

        // RECIPES MANAGEMENT
        function populateIngredientSelect() {
            const selects = document.querySelectorAll('.ingredient-select');
            selects.forEach(select => {
                select.innerHTML = '<option value="">Select Ingredient</option>';
                ingredients.forEach(ingredient => {
                    select.innerHTML += `<option value="${ingredient.id}">${ingredient.name}</option>`;
                });
            });
        }

        function addIngredientRow() {
            const container = document.getElementById('recipeIngredients');
            const div = document.createElement('div');
            div.className = 'form-group';
            div.innerHTML = `
                <select class="ingredient-select">
                    <option value="">Select Ingredient</option>
                    ${ingredients.map(i => `<option value="${i.id}">${i.name}</option>`).join('')}
                </select>
                <input type="number" class="ingredient-qty" placeholder="Quantity" step="0.01">
                <button type="button" class="btn-secondary" onclick="this.parentElement.remove()">üóëÔ∏è Remove</button>
            `;
            container.appendChild(div);
        }

        document.getElementById('recipeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Collect ingredients
            const ingredientRows = document.querySelectorAll('#recipeIngredients .form-group');
            const recipeIngredients = [];
            
            ingredientRows.forEach(row => {
                const select = row.querySelector('.ingredient-select');
                const qtyInput = row.querySelector('.ingredient-qty');
                
                if (select.value && qtyInput.value) {
                    recipeIngredients.push({
                        ingredientId: parseInt(select.value),
                        quantity: parseFloat(qtyInput.value)
                    });
                }
            });
            
            if (recipeIngredients.length === 0) {
                showAlert('Please add at least one ingredient!', 'error');
                return;
            }
            
            const recipe = {
                id: Date.now(),
                name: document.getElementById('recipeName').value,
                piecesPerBatch: parseInt(document.getElementById('piecesMade').value),
                sellPrice: parseFloat(document.getElementById('sellingPrice').value),
                ingredients: recipeIngredients
            };
            
            recipes.push(recipe);
            saveRecipes();
            loadRecipesTable();
            populateRecipeSelect();
            updateDashboard();
            
            showAlert(`Recipe "${recipe.name}" added successfully!`);
            this.reset();
            // Reset ingredients
            document.getElementById('recipeIngredients').innerHTML = `
                <div class="form-group">
                    <select class="ingredient-select">
                        <option value="">Select Ingredient</option>
                    </select>
                    <input type="number" class="ingredient-qty" placeholder="Quantity" step="0.01">
                    <button type="button" class="btn-secondary" onclick="addIngredientRow()">‚ûï Add More</button>
                </div>
            `;
            populateIngredientSelect();
        });

        function calculateRecipeCost(recipe) {
            let totalCost = 0;
            
            recipe.ingredients.forEach(recipeIngredient => {
                const ingredient = ingredients.find(i => i.id === recipeIngredient.ingredientId);
                if (ingredient) {
                    const costPerUnit = ingredient.purchasePrice / ingredient.quantity;
                    totalCost += costPerUnit * recipeIngredient.quantity;
                }
            });
            
            return totalCost;
        }

        function loadRecipesTable() {
            const tbody = document.getElementById('recipeTable');
            tbody.innerHTML = '';
            
            recipes.forEach(recipe => {
                const totalCost = calculateRecipeCost(recipe);
                const costPerPiece = totalCost / recipe.piecesPerBatch;
                const profitPerPiece = recipe.sellPrice - costPerPiece;
                
                const row = `
                    <tr>
                        <td>${recipe.name}</td>
                        <td>${costPerPiece.toFixed(2)} MVR</td>
                        <td>${recipe.sellPrice.toFixed(2)} MVR</td>
                        <td class="${profitPerPiece >= 0 ? 'profit' : 'loss'}">${profitPerPiece.toFixed(2)} MVR</td>
                        <td class="actions">
                            <button class="action-btn edit-btn" onclick="editRecipe(${recipe.id})">‚úèÔ∏è</button>
                            <button class="action-btn delete-btn" onclick="deleteRecipe(${recipe.id})">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function editRecipe(id) {
            showAlert('Edit feature coming soon!', 'error');
        }

        function deleteRecipe(id) {
            if (confirm('Are you sure you want to delete this recipe?')) {
                recipes = recipes.filter(r => r.id !== id);
                saveRecipes();
                loadRecipesTable();
                populateRecipeSelect();
                updateDashboard();
                showAlert('Recipe deleted successfully!');
            }
        }

        // SALES MANAGEMENT
        function populateRecipeSelect() {
            const select = document.getElementById('salesRecipe');
            select.innerHTML = '<option value="">Select Recipe</option>';
            recipes.forEach(recipe => {
                select.innerHTML += `<option value="${recipe.id}">${recipe.name}</option>`;
            });
        }

        document.getElementById('salesForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const recipeId = parseInt(document.getElementById('salesRecipe').value);
            const recipe = recipes.find(r => r.id === recipeId);
            
            if (!recipe) {
                showAlert('Please select a valid recipe!', 'error');
                return;
            }
            
            const sale = {
                id: Date.now(),
                date: document.getElementById('salesDate').value,
                recipeId: recipeId,
                piecesMade: parseInt(document.getElementById('piecesMadeToday').value),
                piecesSold: parseInt(document.getElementById('piecesSoldToday').value)
            };
            
            // Update inventory
            recipe.ingredients.forEach(recipeIngredient => {
                const ingredient = ingredients.find(i => i.id === recipeIngredient.ingredientId);
                if (ingredient) {
                    // Calculate quantity used for this batch
                    const quantityPerPiece = recipeIngredient.quantity / recipe.piecesPerBatch;
                    const totalUsed = quantityPerPiece * sale.piecesMade;
                    ingredient.quantity -= totalUsed;
                }
            });
            
            sales.push(sale);
            saveSales();
            saveIngredients();
            
            loadSalesTable();
            loadInventoryTable();
            updateDashboard();
            
            showAlert(`Sales recorded for ${recipe.name}!`);
            this.reset();
        });

        function loadSalesTable() {
            const tbody = document.getElementById('salesTable');
            tbody.innerHTML = '';
            
            let totalRevenue = 0;
            let totalCost = 0;
            let totalProfit = 0;
            
            sales.forEach(sale => {
                const recipe = recipes.find(r => r.id === sale.recipeId);
                if (recipe) {
                    const recipeCost = calculateRecipeCost(recipe);
                    const costPerPiece = recipeCost / recipe.piecesPerBatch;
                    const totalSaleCost = costPerPiece * sale.piecesMade;
                    const revenue = recipe.sellPrice * sale.piecesSold;
                    const profit = revenue - totalSaleCost;
                    
                    totalRevenue += revenue;
                    totalCost += totalSaleCost;
                    totalProfit += profit;
                    
                    const row = `
                        <tr>
                            <td>${sale.date}</td>
                            <td>${recipe.name}</td>
                            <td>${sale.piecesMade}</td>
                            <td>${sale.piecesSold}</td>
                            <td>${totalSaleCost.toFixed(2)} MVR</td>
                            <td>${revenue.toFixed(2)} MVR</td>
                            <td class="${profit >= 0 ? 'profit' : 'loss'}">${profit.toFixed(2)} MVR</td>
                            <td class="actions">
                                <button class="action-btn delete-btn" onclick="deleteSale(${sale.id})">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                }
            });
            
            // Add totals row
            if (sales.length > 0) {
                tbody.innerHTML += `
                    <tr style="font-weight: bold; background-color: rgba(255, 140, 0, 0.1);">
                        <td colspan="4">TOTAL</td>
                        <td>${totalCost.toFixed(2)} MVR</td>
                        <td>${totalRevenue.toFixed(2)} MVR</td>
                        <td class="${totalProfit >= 0 ? 'profit' : 'loss'}">${totalProfit.toFixed(2)} MVR</td>
                        <td></td>
                    </tr>
                `;
            }
        }

        function deleteSale(id) {
            if (confirm('Are you sure you want to delete this sales record?')) {
                sales = sales.filter(s => s.id !== id);
                saveSales();
                loadSalesTable();
                updateDashboard();
                showAlert('Sales record deleted!');
            }
        }

        // INVENTORY MANAGEMENT
        function loadInventoryTable() {
            const tbody = document.getElementById('inventoryTable');
            tbody.innerHTML = '';
            
            let inventoryList = '';
            
            ingredients.forEach(ingredient => {
                // Calculate used today
                let usedToday = 0;
                const today = new Date().toISOString().split('T')[0];
                
                sales.forEach(sale => {
                    if (sale.date === today) {
                        const recipe = recipes.find(r => r.id === sale.recipeId);
                        if (recipe) {
                            const recipeIngredient = recipe.ingredients.find(ri => ri.ingredientId === ingredient.id);
                            if (recipeIngredient) {
                                const quantityPerPiece = recipeIngredient.quantity / recipe.piecesPerBatch;
                                usedToday += quantityPerPiece * sale.piecesMade;
                            }
                        }
                    }
                });
                
                const remaining = ingredient.quantity - usedToday;
                const status = remaining <= 0 ? '‚ùå Out of Stock' : 
                              remaining < (ingredient.quantity * 0.2) ? '‚ö†Ô∏è Low Stock' : '‚úÖ In Stock';
                
                const row = `
                    <tr>
                        <td>${ingredient.name}</td>
                        <td>${ingredient.quantity.toFixed(2)} ${ingredient.unit}</td>
                        <td>${usedToday.toFixed(2)} ${ingredient.unit}</td>
                        <td>${remaining.toFixed(2)} ${ingredient.unit}</td>
                        <td>${status}</td>
                        <td>
                            <button class="action-btn edit-btn" onclick="restockIngredient(${ingredient.id})">üõí Restock</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
                
                // Update inventory list in dashboard
                inventoryList += `
                    <div class="stat-box">
                        <span class="stat-label">${ingredient.name}:</span>
                        <span class="stat-value">${remaining.toFixed(1)} ${ingredient.unit}</span>
                    </div>
                `;
            });
            
            document.getElementById('inventoryList').innerHTML = inventoryList;
        }

        function restockIngredient(id) {
            const ingredient = ingredients.find(i => i.id === id);
            if (ingredient) {
                const addQty = prompt(`How much ${ingredient.unit} of ${ingredient.name} to add?`);
                if (addQty && !isNaN(addQty)) {
                    ingredient.quantity += parseFloat(addQty);
                    saveIngredients();
                    loadInventoryTable();
                    showAlert(`${addQty} ${ingredient.unit} of ${ingredient.name} added to stock!`);
                }
            }
        }

        function generateShoppingList() {
            const shoppingList = document.getElementById('shoppingList');
            const shoppingItems = document.getElementById('shoppingItems');
            shoppingItems.innerHTML = '';
            
            let listHTML = '';
            
            ingredients.forEach(ingredient => {
                const remaining = ingredient.quantity;
                if (remaining <= ingredient.quantity * 0.2) { // If less than 20% stock
                    const needed = Math.max(ingredient.quantity - remaining, ingredient.quantity * 0.5);
                    listHTML += `
                        <div class="stat-box">
                            <span class="stat-label">${ingredient.name}:</span>
                            <span class="stat-value">${needed.toFixed(1)} ${ingredient.unit}</span>
                        </div>
                    `;
                }
            });
            
            if (listHTML === '') {
                listHTML = '<p>All items are sufficiently stocked! üéâ</p>';
            }
            
            shoppingItems.innerHTML = listHTML;
            shoppingList.style.display = 'block';
        }

        // DASHBOARD UPDATES
        function updateDashboard() {
            // Today's date
            const today = new Date().toISOString().split('T')[0];
            
            // Calculate today's totals
            let totalMade = 0;
            let totalSold = 0;
            let totalRevenue = 0;
            let totalCost = 0;
            
            sales.forEach(sale => {
                if (sale.date === today) {
                    totalMade += sale.piecesMade;
                    totalSold += sale.piecesSold;
                    
                    const recipe = recipes.find(r => r.id === sale.recipeId);
                    if (recipe) {
                        const recipeCost = calculateRecipeCost(recipe);
                        const costPerPiece = recipeCost / recipe.piecesPerBatch;
                        
                        totalRevenue += recipe.sellPrice * sale.piecesSold;
                        totalCost += costPerPiece * sale.piecesMade;
                    }
                }
            });
            
            const totalProfit = totalRevenue - totalCost;
            
            // Update dashboard
            document.getElementById('totalMade').textContent = totalMade;
            document.getElementById('totalSold').textContent = totalSold;
            document.getElementById('totalRevenue').textContent = `${totalRevenue.toFixed(2)} MVR`;
            document.getElementById('totalProfit').textContent = `${totalProfit.toFixed(2)} MVR`;
            
            // Calculate weekly stats
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            
            let weekProfit = 0;
            let bestSeller = '';
            let bestSellerCount = 0;
            const salesByRecipe = {};
            
            sales.forEach(sale => {
                const saleDate = new Date(sale.date);
                if (saleDate >= oneWeekAgo) {
                    const recipe = recipes.find(r => r.id === sale.recipeId);
                    if (recipe) {
                        const recipeCost = calculateRecipeCost(recipe);
                        const costPerPiece = recipeCost / recipe.piecesPerBatch;
                        const profit = recipe.sellPrice * sale.piecesSold - costPerPiece * sale.piecesMade;
                        weekProfit += profit;
                        
                        // Track best seller
                        salesByRecipe[recipe.name] = (salesByRecipe[recipe.name] || 0) + sale.piecesSold;
                    }
                }
            });
            
            // Find best seller
            for (const [recipe, count] of Object.entries(salesByRecipe)) {
                if (count > bestSellerCount) {
                    bestSellerCount = count;
                    bestSeller = recipe;
                }
            }
            
            document.getElementById('weekProfit').textContent = `${weekProfit.toFixed(2)} MVR`;
            document.getElementById('bestSeller').textContent = bestSeller || '-';
            
            const profitMargin = totalCost > 0 ? ((totalProfit / totalCost) * 100) : 0;
            document.getElementById('profitMargin').textContent = `${profitMargin.toFixed(1)}%`;
        }

        function viewReport() {
            // Simple report generation
            let report = `üìä BUSINESS REPORT\n`;
            report += `Generated: ${new Date().toLocaleDateString()}\n\n`;
            
            report += `TODAY'S SUMMARY:\n`;
            report += `Items Made: ${document.getElementById('totalMade').textContent}\n`;
            report += `Items Sold: ${document.getElementById('totalSold').textContent}\n`;
            report += `Revenue: ${document.getElementById('totalRevenue').textContent}\n`;
            report += `Profit: ${document.getElementById('totalProfit').textContent}\n\n`;
            
            report += `WEEKLY PERFORMANCE:\n`;
            report += `Weekly Profit: ${document.getElementById('weekProfit').textContent}\n`;
            report += `Best Seller: ${document.getElementById('bestSeller').textContent}\n`;
            report += `Profit Margin: ${document.getElementById('profitMargin').textContent}\n\n`;
            
            report += `DU'A FOR SUCCESS:\n`;
            report += `ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ®Ÿéÿßÿ±ŸêŸÉŸí ŸÑŸêŸä ŸÅŸêŸäŸÖŸéÿß ÿ±Ÿéÿ≤ŸéŸÇŸíÿ™ŸéŸÜŸêŸä\n`;
            report += `"O Allah, bless me in what You have provided me."`;
            
            alert(report);
        }

        // Initialize date to today
        document.getElementById('salesDate').value = new Date().toISOString().split('T')[0];
    </script>
</body>
</html>
