<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçΩÔ∏è Cafe Pro - Complete Management</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* Telegram-like Styles */
        :root {
            --tg-bg: #18222d;
            --tg-secondary-bg: #1e2a38;
            --tg-text: #ffffff;
            --tg-secondary-text: #8e8e93;
            --tg-accent: #2ea6ff;
            --tg-green: #33c659;
            --tg-red: #ff3b30;
            --tg-orange: #ff9500;
            --tg-border: #2c3b4d;
            --tg-card-bg: #222f3d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--tg-bg);
            color: var(--tg-text);
            line-height: 1.4;
            font-size: 15px;
        }

        .hidden {
            display: none !important;
        }

        /* App Layout */
        #app {
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
            padding-bottom: 60px;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--tg-secondary-bg);
            border-top: 1px solid var(--tg-border);
            display: flex;
            z-index: 1000;
            max-width: 500px;
            margin: 0 auto;
        }

        .nav-item {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            color: var(--tg-secondary-text);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
        }

        .nav-item.active {
            color: var(--tg-accent);
        }

        .nav-item i {
            font-size: 18px;
        }

        /* Screen Container */
        .screen {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header */
        .screen-header {
            background: var(--tg-secondary-bg);
            padding: 16px;
            border-bottom: 1px solid var(--tg-border);
            position: sticky;
            top: 0;
            z-index: 99;
        }

        .screen-title {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .screen-subtitle {
            font-size: 14px;
            color: var(--tg-secondary-text);
            margin-top: 4px;
        }

        /* Quick Actions */
        .quick-actions {
            padding: 16px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .action-card {
            background: var(--tg-card-bg);
            border: 1px solid var(--tg-border);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .action-card:hover {
            transform: translateY(-2px);
            border-color: var(--tg-accent);
        }

        .action-icon {
            font-size: 24px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .new-order .action-icon { background: rgba(46, 166, 255, 0.2); color: var(--tg-accent); }
        .edit-order .action-icon { background: rgba(255, 149, 0, 0.2); color: var(--tg-orange); }
        .history .action-icon { background: rgba(51, 198, 89, 0.2); color: var(--tg-green); }
        .customers .action-icon { background: rgba(175, 82, 222, 0.2); color: #af52de; }

        .action-title {
            font-weight: 600;
            font-size: 16px;
        }

        .action-desc {
            font-size: 12px;
            color: var(--tg-secondary-text);
        }

        /* Search Box */
        .search-container {
            padding: 16px;
            background: var(--tg-secondary-bg);
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            background: var(--tg-card-bg);
            border: 1px solid var(--tg-border);
            border-radius: 12px;
            color: var(--tg-text);
            font-size: 15px;
            outline: none;
        }

        .search-input::placeholder {
            color: var(--tg-secondary-text);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--tg-secondary-text);
        }

        /* Orders List */
        .orders-list {
            padding: 8px 16px;
        }

        .order-card {
            background: var(--tg-card-bg);
            border: 1px solid var(--tg-border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .order-card:hover {
            border-color: var(--tg-accent);
            transform: translateX(4px);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .order-id {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            color: var(--tg-accent);
            font-weight: 600;
        }

        .order-status {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-new { background: rgba(255, 149, 0, 0.2); color: var(--tg-orange); }
        .status-preparing { background: rgba(46, 166, 255, 0.2); color: var(--tg-accent); }
        .status-ready { background: rgba(51, 198, 89, 0.2); color: var(--tg-green); }
        .status-completed { background: rgba(255, 59, 48, 0.2); color: var(--tg-red); }

        .order-body {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .customer-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .customer-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--tg-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .customer-details h4 {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .customer-telegram {
            font-size: 12px;
            color: var(--tg-secondary-text);
        }

        .order-meta {
            text-align: right;
        }

        .order-amount {
            font-size: 18px;
            font-weight: 700;
            color: var(--tg-green);
            margin-bottom: 4px;
        }

        .order-time {
            font-size: 12px;
            color: var(--tg-secondary-text);
        }

        /* Items List */
        .items-list {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--tg-border);
        }

        .item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .item-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .item-emoji {
            font-size: 20px;
            width: 30px;
        }

        .item-name {
            font-weight: 500;
        }

        .item-quantity {
            font-size: 12px;
            color: var(--tg-secondary-text);
        }

        .item-price {
            font-weight: 600;
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--tg-card-bg);
            border-radius: 16px;
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow: hidden;
            border: 1px solid var(--tg-border);
            transform: translateY(20px);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid var(--tg-border);
            background: linear-gradient(135deg, var(--tg-secondary-bg) 0%, var(--tg-card-bg) 100%);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .modal-subtitle {
            color: var(--tg-secondary-text);
            font-size: 14px;
        }

        .modal-close {
            position: absolute;
            right: 16px;
            top: 16px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: none;
            color: var(--tg-text);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            max-height: 60vh;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            background: var(--tg-secondary-bg);
            border: 1px solid var(--tg-border);
            border-radius: 12px;
            color: var(--tg-text);
            font-size: 15px;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: var(--tg-accent);
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        /* Customer Search */
        .customer-search-results {
            margin-top: 16px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--tg-border);
            border-radius: 12px;
        }

        .customer-result {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--tg-border);
            cursor: pointer;
            transition: background 0.2s;
        }

        .customer-result:hover {
            background: var(--tg-secondary-bg);
        }

        .customer-result:last-child {
            border-bottom: none;
        }

        .customer-result-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--tg-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .customer-result-info h4 {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .customer-result-telegram {
            font-size: 12px;
            color: var(--tg-secondary-text);
        }

        /* Menu Items */
        .menu-items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .menu-item {
            background: var(--tg-secondary-bg);
            border: 1px solid var(--tg-border);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .menu-item:hover {
            border-color: var(--tg-accent);
            transform: scale(1.05);
        }

        .menu-item.selected {
            border-color: var(--tg-accent);
            background: rgba(46, 166, 255, 0.1);
        }

        .menu-item-emoji {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .menu-item-name {
            font-weight: 500;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .menu-item-price {
            font-size: 14px;
            color: var(--tg-green);
            font-weight: 600;
        }

        /* Quantity Selector */
        .quantity-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin: 20px 0;
        }

        .qty-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--tg-accent);
            background: none;
            color: var(--tg-accent);
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .qty-btn:hover {
            background: var(--tg-accent);
            color: white;
        }

        .quantity-display {
            font-size: 24px;
            font-weight: 700;
            min-width: 40px;
            text-align: center;
        }

        /* Current Items */
        .current-items {
            margin-top: 20px;
            border-top: 1px solid var(--tg-border);
            padding-top: 20px;
        }

        .current-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--tg-secondary-bg);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .current-item-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .current-item-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .remove-item {
            color: var(--tg-red);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
        }

        /* Buttons */
        .btn {
            padding: 14px 24px;
            border-radius: 12px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
        }

        .btn-primary {
            background: var(--tg-accent);
            color: white;
        }

        .btn-primary:hover {
            background: #1d8ed8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--tg-secondary-bg);
            color: var(--tg-text);
            border: 1px solid var(--tg-border);
        }

        .btn-secondary:hover {
            background: #2c3b4d;
        }

        .btn-success {
            background: var(--tg-green);
            color: white;
        }

        .btn-success:hover {
            background: #2aa952;
        }

        .btn-danger {
            background: var(--tg-red);
            color: white;
        }

        .btn-danger:hover {
            background: #e02c21;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .action-buttons .btn {
            flex: 1;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--tg-secondary-bg);
            color: var(--tg-text);
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 3000;
            opacity: 0;
            transition: all 0.3s;
            max-width: 90%;
            text-align: center;
            border: 1px solid var(--tg-border);
            backdrop-filter: blur(10px);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Customers Screen */
        .customers-list {
            padding: 16px;
        }

        .customer-card {
            background: var(--tg-card-bg);
            border: 1px solid var(--tg-border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .customer-stats {
            margin-top: 8px;
            display: flex;
            gap: 16px;
            font-size: 12px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--tg-secondary-text);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .menu-items-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }

        /* Telegram User Info */
        .telegram-user {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--tg-secondary-bg);
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .telegram-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--tg-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 18px;
        }

        .telegram-info h3 {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .telegram-info p {
            font-size: 14px;
            color: var(--tg-secondary-text);
        }
    </style>
</head>
<body>
    <!-- Main App -->
    <div id="app">
        <!-- Home Screen -->
        <div class="screen active" id="home-screen">
            <div class="screen-header">
                <div class="screen-title">
                    <span>üçΩÔ∏è Cafe Pro</span>
                </div>
                <div class="screen-subtitle" id="greeting">Good morning!</div>
            </div>

            <!-- Current Stats -->
            <div style="padding: 16px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                <div style="text-align: center; background: var(--tg-card-bg); padding: 12px; border-radius: 12px;">
                    <div style="font-size: 24px; font-weight: 700; color: var(--tg-accent);" id="today-orders">0</div>
                    <div style="font-size: 12px; color: var(--tg-secondary-text);">Today</div>
                </div>
                <div style="text-align: center; background: var(--tg-card-bg); padding: 12px; border-radius: 12px;">
                    <div style="font-size: 24px; font-weight: 700; color: var(--tg-green);" id="today-revenue">$0</div>
                    <div style="font-size: 12px; color: var(--tg-secondary-text);">Revenue</div>
                </div>
                <div style="text-align: center; background: var(--tg-card-bg); padding: 12px; border-radius: 12px;">
                    <div style="font-size: 24px; font-weight: 700; color: var(--tg-orange);" id="active-tables">0</div>
                    <div style="font-size: 12px; color: var(--tg-secondary-text);">Active</div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <div class="action-card new-order" onclick="openNewOrderModal()">
                    <div class="action-icon">‚ûï</div>
                    <div class="action-title">New Order</div>
                    <div class="action-desc">Take order from customer</div>
                </div>
                <div class="action-card edit-order" onclick="showEditOrders()">
                    <div class="action-icon">‚úèÔ∏è</div>
                    <div class="action-title">Edit Orders</div>
                    <div class="action-desc">Modify existing orders</div>
                </div>
                <div class="action-card history" onclick="switchScreen('orders-screen')">
                    <div class="action-icon">üìä</div>
                    <div class="action-title">Orders History</div>
                    <div class="action-desc">View all past orders</div>
                </div>
                <div class="action-card customers" onclick="switchScreen('customers-screen')">
                    <div class="action-icon">üë•</div>
                    <div class="action-title">Customers</div>
                    <div class="action-desc">Manage customers</div>
                </div>
            </div>

            <!-- Recent Orders -->
            <div style="padding: 16px;">
                <h3 style="margin-bottom: 12px; font-size: 16px;">üïê Recent Orders</h3>
                <div id="recent-orders">
                    <!-- Recent orders loaded here -->
                </div>
            </div>
        </div>

        <!-- Orders Screen -->
        <div class="screen" id="orders-screen">
            <div class="screen-header">
                <div class="screen-title">
                    <span>üìä Orders History</span>
                </div>
                <div class="screen-subtitle" id="orders-count">Loading...</div>
            </div>

            <div class="search-container">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" id="orders-search" placeholder="Search by customer, order ID, or item...">
                </div>
            </div>

            <div class="orders-list" id="all-orders-list">
                <!-- All orders loaded here -->
            </div>
        </div>

        <!-- Customers Screen -->
        <div class="screen" id="customers-screen">
            <div class="screen-header">
                <div class="screen-title">
                    <span>üë• Customers</span>
                </div>
                <div class="screen-subtitle" id="customers-count">Loading...</div>
            </div>

            <div class="search-container">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" id="customers-search" placeholder="Search customers...">
                </div>
            </div>

            <div class="customers-list" id="customers-list">
                <!-- Customers loaded here -->
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <button class="nav-item active" onclick="switchScreen('home-screen')">
                <span>üè†</span>
                <span>Home</span>
            </button>
            <button class="nav-item" onclick="openNewOrderModal()">
                <span>‚ûï</span>
                <span>New Order</span>
            </button>
            <button class="nav-item" onclick="switchScreen('orders-screen')">
                <span>üìä</span>
                <span>Orders</span>
            </button>
            <button class="nav-item" onclick="switchScreen('customers-screen')">
                <span>üë•</span>
                <span>Customers</span>
            </button>
        </div>
    </div>

    <!-- New Order Modal -->
    <div class="modal-overlay" id="new-order-modal">
        <div class="modal">
            <div class="modal-header">
                <button class="modal-close" onclick="closeModal()">√ó</button>
                <div class="modal-title">‚ûï New Order</div>
                <div class="modal-subtitle">Create a new customer order</div>
            </div>
            
            <div class="modal-body">
                <!-- Customer Selection -->
                <div class="form-group">
                    <label class="form-label">üë§ Select Customer</label>
                    <input type="text" class="form-input" id="customer-search-input" placeholder="Search by name or Telegram ID..." oninput="searchTelegramUsers()">
                    <div class="customer-search-results" id="customer-results">
                        <!-- Results loaded here -->
                    </div>
                    <div style="margin-top: 12px; text-align: center;">
                        <button class="btn btn-secondary" onclick="useCurrentTelegramUser()">
                            üë§ Use My Telegram Account
                        </button>
                    </div>
                </div>

                <!-- Selected Customer -->
                <div class="telegram-user hidden" id="selected-customer">
                    <div class="telegram-avatar" id="selected-avatar">?</div>
                    <div class="telegram-info">
                        <h3 id="selected-name">Customer Name</h3>
                        <p id="selected-telegram">@username</p>
                    </div>
                </div>

                <!-- Menu Items -->
                <div class="form-group" id="menu-section">
                    <label class="form-label">üçΩÔ∏è Select Items</label>
                    <div class="menu-items-grid" id="menu-items">
                        <!-- Menu items loaded here -->
                    </div>
                </div>

                <!-- Quantity Selector -->
                <div class="form-group hidden" id="quantity-section">
                    <div class="quantity-selector">
                        <button class="qty-btn" onclick="adjustQuantity(-1)">-</button>
                        <div class="quantity-display" id="current-quantity">1</div>
                        <button class="qty-btn" onclick="adjustQuantity(1)">+</button>
                    </div>
                    <div style="text-align: center; margin-top: 12px;">
                        <button class="btn btn-secondary" onclick="addSelectedItem()">
                            ‚ûï Add to Order
                        </button>
                    </div>
                </div>

                <!-- Current Items -->
                <div class="current-items" id="current-items-container">
                    <!-- Current order items shown here -->
                </div>

                <!-- Special Instructions -->
                <div class="form-group">
                    <label class="form-label">üìù Special Instructions</label>
                    <textarea class="form-textarea" id="order-notes" placeholder="Any allergies, modifications, etc."></textarea>
                </div>

                <!-- Submit Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="submitOrder()" id="submit-order-btn">
                        ‚úÖ Submit Order
                    </button>
                    <button class="btn btn-secondary" onclick="clearCurrentOrder()">
                        üóëÔ∏è Clear Order
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Order Modal -->
    <div class="modal-overlay" id="edit-order-modal">
        <div class="modal">
            <div class="modal-header">
                <button class="modal-close" onclick="closeModal()">√ó</button>
                <div class="modal-title">‚úèÔ∏è Edit Order</div>
                <div class="modal-subtitle" id="edit-order-id">ORDER20251112112138</div>
            </div>
            
            <div class="modal-body">
                <!-- Current Items -->
                <div id="edit-items-container">
                    <!-- Items loaded here -->
                </div>

                <!-- Add More Items -->
                <div class="form-group">
                    <label class="form-label">‚ûï Add More Items</label>
                    <div class="menu-items-grid" id="edit-menu-items">
                        <!-- Menu items loaded here -->
                    </div>
                </div>

                <!-- Special Instructions -->
                <div class="form-group">
                    <label class="form-label">üìù Special Instructions</label>
                    <textarea class="form-textarea" id="edit-notes" placeholder="Any allergies, modifications, etc."></textarea>
                </div>

                <!-- Status Update -->
                <div class="form-group">
                    <label class="form-label">üîÑ Update Status</label>
                    <select class="form-select" id="edit-status">
                        <option value="new">üÜï New</option>
                        <option value="preparing">üë®‚Äçüç≥ Preparing</option>
                        <option value="ready">‚úÖ Ready</option>
                        <option value="completed">üì¶ Completed</option>
                        <option value="cancelled">‚ùå Cancelled</option>
                    </select>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="saveOrderChanges()">
                        üíæ Save Changes
                    </button>
                    <button class="btn btn-danger" onclick="deleteOrder()">
                        üóëÔ∏è Delete Order
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // =================== INITIALIZATION ===================
        const tg = window.Telegram.WebApp;
        let orders = JSON.parse(localStorage.getItem('cafe_orders')) || [];
        let customers = JSON.parse(localStorage.getItem('cafe_customers')) || [];
        let menuItems = [
            { id: 1, name: 'Espresso', emoji: '‚òï', price: 3.5, category: 'drinks' },
            { id: 2, name: 'Cappuccino', emoji: '‚òï', price: 4.5, category: 'drinks' },
            { id: 3, name: 'Latte', emoji: '‚òï', price: 4.8, category: 'drinks' },
            { id: 4, name: 'Americano', emoji: '‚òï', price: 3.8, category: 'drinks' },
            { id: 5, name: 'Tea', emoji: 'üçµ', price: 2.5, category: 'drinks' },
            { id: 6, name: 'Iced Coffee', emoji: 'ü•§', price: 4.2, category: 'cold' },
            { id: 7, name: 'Fresh Juice', emoji: 'üßÉ', price: 3.8, category: 'cold' },
            { id: 8, name: 'Water', emoji: 'üíß', price: 1.0, category: 'cold' },
            { id: 9, name: 'Soda', emoji: 'ü•§', price: 2.0, category: 'cold' },
            { id: 10, name: 'Burger', emoji: 'üçî', price: 8.5, category: 'food' },
            { id: 11, name: 'Pizza', emoji: 'üçï', price: 12.0, category: 'food' },
            { id: 12, name: 'Sandwich', emoji: 'ü•™', price: 6.5, category: 'food' },
            { id: 13, name: 'Salad', emoji: 'ü•ó', price: 7.0, category: 'food' },
            { id: 14, name: 'Pasta', emoji: 'üçù', price: 9.5, category: 'food' },
            { id: 15, name: 'Fries', emoji: 'üçü', price: 3.5, category: 'sides' },
            { id: 16, name: 'Cake', emoji: 'üç∞', price: 5.5, category: 'dessert' },
            { id: 17, name: 'Ice Cream', emoji: 'üç¶', price: 4.0, category: 'dessert' },
            { id: 18, name: 'Croissant', emoji: 'ü•ê', price: 2.5, category: 'breakfast' },
            { id: 19, name: 'Pancakes', emoji: 'ü•û', price: 6.0, category: 'breakfast' },
            { id: 20, name: 'Omelette', emoji: 'üç≥', price: 7.5, category: 'breakfast' }
        ];

        // Current state
        let currentOrder = {
            customer: null,
            items: [],
            notes: '',
            status: 'new'
        };
        let currentEditOrderId = null;
        let selectedMenuItem = null;
        let currentQuantity = 1;
        let searchQuery = '';

        // =================== DOM ELEMENTS ===================
        const screens = document.querySelectorAll('.screen');
        const navItems = document.querySelectorAll('.nav-item');
        const toastEl = document.getElementById('toast');

        // =================== INITIAL LOAD ===================
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Telegram Web App
            tg.expand();
            tg.setHeaderColor('#18222d');
            tg.setBackgroundColor('#18222d');
            tg.enableClosingConfirmation();
            
            // Set greeting based on time
            setGreeting();
            
            // Load data
            loadSampleDataIfEmpty();
            
            // Initial render
            updateHomeStats();
            renderRecentOrders();
            renderMenuItems();
            
            // Setup event listeners
            setupEventListeners();
            
            // Show Telegram user info if available
            if (tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                showToast(`üëã Welcome, ${user.first_name || 'User'}!`, 'info');
            }
        });

        function setGreeting() {
            const hour = new Date().getHours();
            let greeting = 'Good ';
            if (hour < 12) greeting += 'morning!';
            else if (hour < 18) greeting += 'afternoon!';
            else greeting += 'evening!';
            document.getElementById('greeting').textContent = greeting;
        }

        function loadSampleDataIfEmpty() {
            if (orders.length === 0) {
                // Load sample orders
                orders = [
                    {
                        id: 'ORDER20251112104950',
                        customer: { name: 'kotharey', telegramId: '@kotharey', avatar: 'K' },
                        items: [{ id: 1, quantity: 1 }],
                        notes: '',
                        amount: 3.5,
                        status: 'completed',
                        time: '2025-11-12 10:49'
                    },
                    {
                        id: 'ORDER20251112093405',
                        customer: { name: 'fallo', telegramId: '@fallo', avatar: 'F' },
                        items: [{ id: 10, quantity: 1 }, { id: 15, quantity: 1 }],
                        notes: 'Extra cheese',
                        amount: 12.0,
                        status: 'completed',
                        time: '2025-11-12 09:34'
                    }
                ];
                localStorage.setItem('cafe_orders', JSON.stringify(orders));
            }

            if (customers.length === 0) {
                customers = [
                    { id: '@kotharey', name: 'kotharey', avatar: 'K', totalOrders: 5, totalSpent: 42.5 },
                    { id: '@fallo', name: 'fallo', avatar: 'F', totalOrders: 8, totalSpent: 98.0 },
                    { id: '@faudy', name: 'Faudy', avatar: 'F', totalOrders: 3, totalSpent: 39.0 },
                    { id: '@siday', name: 'Siday', avatar: 'S', totalOrders: 2, totalSpent: 20.0 }
                ];
                localStorage.setItem('cafe_customers', JSON.stringify(customers));
            }
        }

        function setupEventListeners() {
            // Search listeners
            document.getElementById('orders-search').addEventListener('input', (e) => {
                searchQuery = e.target.value.toLowerCase();
                renderAllOrders();
            });

            document.getElementById('customers-search').addEventListener('input', (e) => {
                searchQuery = e.target.value.toLowerCase();
                renderCustomers();
            });
        }

        // =================== SCREEN MANAGEMENT ===================
        function switchScreen(screenId) {
            // Hide all screens
            screens.forEach(screen => screen.classList.remove('active'));
            
            // Update nav items
            navItems.forEach(item => item.classList.remove('active'));
            
            // Show target screen
            document.getElementById(screenId).classList.add('active');
            
            // Update active nav item
            const navMap = {
                'home-screen': 0,
                'orders-screen': 2,
                'customers-screen': 3
            };
            if (navMap[screenId] !== undefined) {
                navItems[navMap[screenId]].classList.add('active');
            }
            
            // Refresh screen content
            if (screenId === 'orders-screen') {
                renderAllOrders();
            } else if (screenId === 'customers-screen') {
                renderCustomers();
            }
            
            // Close modal if open
            closeModal();
        }

        function showEditOrders() {
            switchScreen('orders-screen');
            showToast('Tap any order to edit it', 'info');
        }

        // =================== MODAL MANAGEMENT ===================
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            document.body.style.overflow = 'hidden';
            tg.BackButton.show();
        }

        function closeModal() {
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.classList.remove('active');
            });
            document.body.style.overflow = '';
            tg.BackButton.hide();
            
            // Reset current order if closing new order modal
            if (currentOrder.items.length === 0) {
                resetCurrentOrder();
            }
        }

        function resetCurrentOrder() {
            currentOrder = {
                customer: null,
                items: [],
                notes: '',
                status: 'new'
            };
            currentQuantity = 1;
            selectedMenuItem = null;
            
            document.getElementById('selected-customer').classList.add('hidden');
            document.getElementById('quantity-section').classList.add('hidden');
            document.getElementById('menu-section').classList.remove('hidden');
            document.getElementById('current-quantity').textContent = '1';
            document.getElementById('order-notes').value = '';
            document.getElementById('customer-search-input').value = '';
            document.getElementById('customer-results').innerHTML = '';
            document.getElementById('current-items-container').innerHTML = '';
        }

        // =================== ORDER MANAGEMENT ===================
        function openNewOrderModal() {
            resetCurrentOrder();
            openModal('new-order-modal');
            loadTelegramUsers();
        }

        function searchTelegramUsers() {
            const searchInput = document.getElementById('customer-search-input').value.toLowerCase();
            const resultsContainer = document.getElementById('customer-results');
            
            if (!searchInput) {
                loadTelegramUsers();
                return;
            }
            
            // Filter customers
            const filtered = customers.filter(customer => 
                customer.name.toLowerCase().includes(searchInput) ||
                customer.id.toLowerCase().includes(searchInput)
            );
            
            // Add Telegram users from current session
            if (tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                if (user.username && user.username.toLowerCase().includes(searchInput)) {
                    filtered.push({
                        id: `@${user.username}`,
                        name: user.first_name || 'Telegram User',
                        avatar: user.first_name ? user.first_name[0].toUpperCase() : 'T',
                        isCurrentUser: true
                    });
                }
            }
            
            renderCustomerResults(filtered);
        }

        function loadTelegramUsers() {
            const resultsContainer = document.getElementById('customer-results');
            
            // Start with existing customers
            let results = [...customers];
            
            // Add current Telegram user if available
            if (tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                if (user.username) {
                    results.unshift({
                        id: `@${user.username}`,
                        name: user.first_name || 'Telegram User',
                        avatar: user.first_name ? user.first_name[0].toUpperCase() : 'T',
                        isCurrentUser: true
                    });
                }
            }
            
            renderCustomerResults(results);
        }

        function renderCustomerResults(customers) {
            const resultsContainer = document.getElementById('customer-results');
            
            if (customers.length === 0) {
                resultsContainer.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--tg-secondary-text);">
                        <div>üë§</div>
                        <div>No customers found</div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            customers.forEach(customer => {
                html += `
                    <div class="customer-result" onclick="selectCustomer('${customer.id}', '${customer.name}', '${customer.avatar}')">
                        <div class="customer-result-avatar">${customer.avatar}</div>
                        <div class="customer-result-info">
                            <h4>${customer.name}</h4>
                            <div class="customer-result-telegram">${customer.id}</div>
                        </div>
                    </div>
                `;
            });
            
            resultsContainer.innerHTML = html;
        }

        function selectCustomer(telegramId, name, avatar) {
            currentOrder.customer = { telegramId, name, avatar };
            
            // Update UI
            document.getElementById('selected-avatar').textContent = avatar;
            document.getElementById('selected-name').textContent = name;
            document.getElementById('selected-telegram').textContent = telegramId;
            document.getElementById('selected-customer').classList.remove('hidden');
            
            // Clear search
            document.getElementById('customer-search-input').value = '';
            document.getElementById('customer-results').innerHTML = '';
            
            showToast(`üë§ Selected: ${name}`, 'success');
        }

        function useCurrentTelegramUser() {
            if (tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                const telegramId = user.username ? `@${user.username}` : `user_${user.id}`;
                const name = user.first_name || 'Telegram User';
                const avatar = user.first_name ? user.first_name[0].toUpperCase() : 'T';
                
                selectCustomer(telegramId, name, avatar);
                
                // Save as customer if not exists
                const existing = customers.find(c => c.id === telegramId);
                if (!existing) {
                    customers.push({
                        id: telegramId,
                        name: name,
                        avatar: avatar,
                        totalOrders: 0,
                        totalSpent: 0
                    });
                    localStorage.setItem('cafe_customers', JSON.stringify(customers));
                }
            } else {
                showToast('Telegram user data not available', 'error');
            }
        }

        function renderMenuItems() {
            const container = document.getElementById('menu-items');
            let html = '';
            
            menuItems.forEach(item => {
                html += `
                    <div class="menu-item" onclick="selectMenu(${item.id})">
                        <div class="menu-item-emoji">${item.emoji}</div>
                        <div class="menu-item-name">${item.name}</div>
                        <div class="menu-item-price">$${item.price.toFixed(2)}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function selectMenu(itemId) {
            selectedMenuItem = menuItems.find(item => item.id === itemId);
            
            // Update UI
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.target.closest('.menu-item').classList.add('selected');
            
            // Show quantity selector
            document.getElementById('quantity-section').classList.remove('hidden');
            currentQuantity = 1;
            document.getElementById('current-quantity').textContent = currentQuantity;
            
            showToast(`Selected: ${selectedMenuItem.name}`, 'info');
        }

        function adjustQuantity(change) {
            currentQuantity = Math.max(1, currentQuantity + change);
            document.getElementById('current-quantity').textContent = currentQuantity;
        }

        function addSelectedItem() {
            if (!selectedMenuItem || !currentOrder.customer) {
                showToast('Please select a customer first', 'error');
                return;
            }
            
            // Check if item already exists
            const existingIndex = currentOrder.items.findIndex(item => item.id === selectedMenuItem.id);
            
            if (existingIndex > -1) {
                currentOrder.items[existingIndex].quantity += currentQuantity;
            } else {
                currentOrder.items.push({
                    ...selectedMenuItem,
                    quantity: currentQuantity
                });
            }
            
            // Update UI
            renderCurrentItems();
            
            // Reset selection
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.getElementById('quantity-section').classList.add('hidden');
            selectedMenuItem = null;
            currentQuantity = 1;
            document.getElementById('current-quantity').textContent = currentQuantity;
            
            showToast(`Added ${currentQuantity}x ${selectedMenuItem.name}`, 'success');
        }

        function renderCurrentItems() {
            const container = document.getElementById('current-items-container');
            
            if (currentOrder.items.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--tg-secondary-text);">
                        <div>üõí</div>
                        <div>No items added yet</div>
                    </div>
                `;
                document.getElementById('submit-order-btn').disabled = true;
                return;
            }
            
            let html = '<div style="font-weight: 600; margin-bottom: 12px;">üõí Current Order:</div>';
            let total = 0;
            
            currentOrder.items.forEach((item, index) => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                html += `
                    <div class="current-item">
                        <div class="current-item-info">
                            <div class="item-emoji">${item.emoji}</div>
                            <div>
                                <div class="item-name">${item.name}</div>
                                <div class="item-quantity">x${item.quantity} = $${itemTotal.toFixed(2)}</div>
                            </div>
                        </div>
                        <div class="current-item-controls">
                            <div style="font-weight: 600;">$${item.price.toFixed(2)}</div>
                            <button class="remove-item" onclick="removeCurrentItem(${index})">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            });
            
            html += `
                <div style="display: flex; justify-content: space-between; margin-top: 16px; padding-top: 16px; border-top: 2px solid var(--tg-border); font-weight: 700; font-size: 18px;">
                    <span>TOTAL:</span>
                    <span style="color: var(--tg-green);">$${total.toFixed(2)}</span>
                </div>
            `;
            
            container.innerHTML = html;
            document.getElementById('submit-order-btn').disabled = false;
        }

        function removeCurrentItem(index) {
            currentOrder.items.splice(index, 1);
            renderCurrentItems();
            showToast('Item removed', 'warning');
        }

        function submitOrder() {
            if (!currentOrder.customer || currentOrder.items.length === 0) {
                showToast('Please select a customer and add items', 'error');
                return;
            }
            
            // Calculate total
            const total = currentOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // Create order
            const newOrder = {
                id: `ORDER${new Date().toISOString().replace(/[-:.TZ]/g, '').slice(0, 14)}`,
                customer: currentOrder.customer,
                items: currentOrder.items.map(item => ({ id: item.id, quantity: item.quantity })),
                notes: document.getElementById('order-notes').value,
                amount: total,
                status: 'new',
                time: new Date().toISOString().replace('T', ' ').slice(0, 19)
            };
            
            // Add to orders
            orders.unshift(newOrder);
            localStorage.setItem('cafe_orders', JSON.stringify(orders));
            
            // Update customer stats
            updateCustomerStats(newOrder.customer.telegramId, total);
            
            // Show success
            showToast(`‚úÖ Order ${newOrder.id} created!`, 'success');
            
            // Send to Telegram bot
            if (tg.sendData) {
                const orderData = {
                    type: 'new_order',
                    orderId: newOrder.id,
                    customer: newOrder.customer,
                    total: total,
                    items: newOrder.items.length
                };
                tg.sendData(JSON.stringify(orderData));
            }
            
            // Haptic feedback
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('heavy');
            }
            
            // Close modal and reset
            closeModal();
            resetCurrentOrder();
            
            // Update UI
            updateHomeStats();
            renderRecentOrders();
        }

        function updateCustomerStats(telegramId, amount) {
            let customer = customers.find(c => c.id === telegramId);
            
            if (customer) {
                customer.totalOrders = (customer.totalOrders || 0) + 1;
                customer.totalSpent = (customer.totalSpent || 0) + amount;
            } else {
                // Create new customer
                customer = {
                    id: telegramId,
                    name: currentOrder.customer.name,
                    avatar: currentOrder.customer.avatar,
                    totalOrders: 1,
                    totalSpent: amount
                };
                customers.push(customer);
            }
            
            localStorage.setItem('cafe_customers', JSON.stringify(customers));
        }

        function clearCurrentOrder() {
            if (confirm('Clear current order?')) {
                resetCurrentOrder();
                showToast('Order cleared', 'warning');
            }
        }

        // =================== EDIT ORDER ===================
        function editOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            currentEditOrderId = orderId;
            
            // Update modal header
            document.getElementById('edit-order-id').textContent = orderId;
            
            // Render current items
            renderEditItems(order);
            
            // Load menu items
            renderEditMenuItems();
            
            // Set notes and status
            document.getElementById('edit-notes').value = order.notes || '';
            document.getElementById('edit-status').value = order.status;
            
            // Open modal
            openModal('edit-order-modal');
        }

        function renderEditItems(order) {
            const container = document.getElementById('edit-items-container');
            let html = '<div style="font-weight: 600; margin-bottom: 12px;">üìù Current Items:</div>';
            
            if (order.items && order.items.length > 0) {
                order.items.forEach((itemData, index) => {
                    const item = menuItems.find(m => m.id === itemData.id);
                    if (item) {
                        const itemTotal = item.price * itemData.quantity;
                        html += `
                            <div class="current-item">
                                <div class="current-item-info">
                                    <div class="item-emoji">${item.emoji}</div>
                                    <div>
                                        <div class="item-name">${item.name}</div>
                                        <div class="item-quantity">x${itemData.quantity} = $${itemTotal.toFixed(2)}</div>
                                    </div>
                                </div>
                                <div class="current-item-controls">
                                    <div style="font-weight: 600;">$${item.price.toFixed(2)}</div>
                                    <button class="remove-item" onclick="removeEditItem(${index})">üóëÔ∏è</button>
                                </div>
                            </div>
                        `;
                    }
                });
            } else {
                html += '<div style="text-align: center; padding: 20px; color: var(--tg-secondary-text);">No items</div>';
            }
            
            container.innerHTML = html;
        }

        function renderEditMenuItems() {
            const container = document.getElementById('edit-menu-items');
            let html = '';
            
            menuItems.forEach(item => {
                html += `
                    <div class="menu-item" onclick="addToEditOrder(${item.id})">
                        <div class="menu-item-emoji">${item.emoji}</div>
                        <div class="menu-item-name">${item.name}</div>
                        <div class="menu-item-price">$${item.price.toFixed(2)}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function addToEditOrder(itemId) {
            const order = orders.find(o => o.id === currentEditOrderId);
            if (!order) return;
            
            const item = menuItems.find(m => m.id === itemId);
            if (!item) return;
            
            // Check if item already exists
            const existingIndex = order.items.findIndex(i => i.id === itemId);
            
            if (existingIndex > -1) {
                order.items[existingIndex].quantity += 1;
            } else {
                order.items.push({ id: itemId, quantity: 1 });
            }
            
            // Recalculate total
            order.amount = order.items.reduce((sum, itemData) => {
                const menuItem = menuItems.find(m => m.id === itemData.id);
                return sum + (menuItem.price * itemData.quantity);
            }, 0);
            
            // Update UI
            renderEditItems(order);
            showToast(`Added ${item.name}`, 'success');
        }

        function removeEditItem(index) {
            const order = orders.find(o => o.id === currentEditOrderId);
            if (!order || !order.items[index]) return;
            
            order.items.splice(index, 1);
            
            // Recalculate total
            order.amount = order.items.reduce((sum, itemData) => {
                const menuItem = menuItems.find(m => m.id === itemData.id);
                return sum + (menuItem.price * itemData.quantity);
            }, 0);
            
            // Update UI
            renderEditItems(order);
            showToast('Item removed', 'warning');
        }

        function saveOrderChanges() {
            const order = orders.find(o => o.id === currentEditOrderId);
            if (!order) return;
            
            // Update notes and status
            order.notes = document.getElementById('edit-notes').value;
            order.status = document.getElementById('edit-status').value;
            order.updatedAt = new Date().toISOString();
            
            // Save
            localStorage.setItem('cafe_orders', JSON.stringify(orders));
            
            // Update UI
            closeModal();
            renderAllOrders();
            updateHomeStats();
            
            showToast('‚úÖ Order updated!', 'success');
        }

        function deleteOrder() {
            if (!confirm('Delete this order permanently?')) return;
            
            orders = orders.filter(o => o.id !== currentEditOrderId);
            localStorage.setItem('cafe_orders', JSON.stringify(orders));
            
            closeModal();
            renderAllOrders();
            updateHomeStats();
            
            showToast('üóëÔ∏è Order deleted', 'warning');
        }

        // =================== DISPLAY FUNCTIONS ===================
        function updateHomeStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayOrders = orders.filter(o => o.time.startsWith(today));
            const todayRevenue = todayOrders.reduce((sum, order) => sum + order.amount, 0);
            const activeOrders = orders.filter(o => ['new', 'preparing'].includes(o.status)).length;
            
            document.getElementById('today-orders').textContent = todayOrders.length;
            document.getElementById('today-revenue').textContent = `$${todayRevenue.toFixed(2)}`;
            document.getElementById('active-tables').textContent = activeOrders;
        }

        function renderRecentOrders() {
            const container = document.getElementById('recent-orders');
            const recent = orders.slice(0, 5);
            
            if (recent.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <div>No recent orders</div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            recent.forEach(order => {
                const orderDate = new Date(order.time);
                const timeStr = `${orderDate.getHours().toString().padStart(2, '0')}:${orderDate.getMinutes().toString().padStart(2, '0')}`;
                
                html += `
                    <div class="order-card" onclick="editOrder('${order.id}')">
                        <div class="order-header">
                            <div class="order-id">${order.id}</div>
                            <div class="order-status status-${order.status}">${order.status}</div>
                        </div>
                        <div class="order-body">
                            <div class="customer-info">
                                <div class="customer-avatar">${order.customer.avatar}</div>
                                <div class="customer-details">
                                    <h4>${order.customer.name}</h4>
                                    <div class="customer-telegram">${order.customer.telegramId}</div>
                                </div>
                            </div>
                            <div class="order-meta">
                                <div class="order-amount">$${order.amount.toFixed(2)}</div>
                                <div class="order-time">${timeStr}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function renderAllOrders() {
            const container = document.getElementById('all-orders-list');
            const countEl = document.getElementById('orders-count');
            
            let filtered = [...orders];
            
            // Apply search filter
            if (searchQuery) {
                filtered = filtered.filter(order => 
                    order.customer.name.toLowerCase().includes(searchQuery) ||
                    order.customer.telegramId.toLowerCase().includes(searchQuery) ||
                    order.id.toLowerCase().includes(searchQuery) ||
                    order.status.toLowerCase().includes(searchQuery)
                );
            }
            
            countEl.textContent = `${filtered.length} orders`;
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <div>No orders found</div>
                        ${searchQuery ? '<div style="margin-top: 8px;">Try a different search</div>' : ''}
                    </div>
                `;
                return;
            }
            
            let html = '';
            filtered.forEach(order => {
                const orderDate = new Date(order.time);
                const timeStr = `${orderDate.getHours().toString().padStart(2, '0')}:${orderDate.getMinutes().toString().padStart(2, '0')}`;
                const dateStr = `${orderDate.getDate().toString().padStart(2, '0')}/${(orderDate.getMonth() + 1).toString().padStart(2, '0')}`;
                
                html += `
                    <div class="order-card" onclick="editOrder('${order.id}')">
                        <div class="order-header">
                            <div class="order-id">${order.id}</div>
                            <div class="order-status status-${order.status}">${order.status}</div>
                        </div>
                        <div class="order-body">
                            <div class="customer-info">
                                <div class="customer-avatar">${order.customer.avatar}</div>
                                <div class="customer-details">
                                    <h4>${order.customer.name}</h4>
                                    <div class="customer-telegram">${order.customer.telegramId}</div>
                                </div>
                            </div>
                            <div class="order-meta">
                                <div class="order-amount">$${order.amount.toFixed(2)}</div>
                                <div class="order-time">${dateStr} ${timeStr}</div>
                            </div>
                        </div>
                        ${order.notes ? `
                        <div style="margin-top: 12px; padding: 8px 12px; background: var(--tg-secondary-bg); border-radius: 8px; font-size: 13px;">
                            üìù ${order.notes}
                        </div>
                        ` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function renderCustomers() {
            const container = document.getElementById('customers-list');
            const countEl = document.getElementById('customers-count');
            
            let filtered = [...customers];
            
            // Apply search filter
            if (searchQuery) {
                filtered = filtered.filter(customer => 
                    customer.name.toLowerCase().includes(searchQuery) ||
                    customer.id.toLowerCase().includes(searchQuery)
                );
            }
            
            countEl.textContent = `${filtered.length} customers`;
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üë§</div>
                        <div>No customers found</div>
                        ${searchQuery ? '<div style="margin-top: 8px;">Try a different search</div>' : ''}
                    </div>
                `;
                return;
            }
            
            let html = '';
            filtered.forEach(customer => {
                const customerOrders = orders.filter(o => o.customer.telegramId === customer.id);
                const lastOrder = customerOrders[0];
                
                html += `
                    <div class="customer-card" onclick="selectCustomer('${customer.id}', '${customer.name}', '${customer.avatar}')">
                        <div class="telegram-avatar">${customer.avatar}</div>
                        <div style="flex: 1;">
                            <h3 style="margin-bottom: 4px;">${customer.name}</h3>
                            <div style="font-size: 13px; color: var(--tg-secondary-text); margin-bottom: 8px;">${customer.id}</div>
                            <div class="customer-stats">
                                <div class="stat-item">
                                    <span>üìä</span>
                                    <span>${customer.totalOrders || 0} orders</span>
                                </div>
                                <div class="stat-item">
                                    <span>üí∞</span>
                                    <span>$${(customer.totalSpent || 0).toFixed(2)}</span>
                                </div>
                                ${lastOrder ? `
                                <div class="stat-item">
                                    <span>üïê</span>
                                    <span>Last: ${new Date(lastOrder.time).toLocaleDateString()}</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // =================== UTILITIES ===================
        function showToast(message, type = 'info') {
            toastEl.textContent = message;
            toastEl.className = 'toast';
            toastEl.classList.add('show');
            
            // Set color based on type
            const colors = {
                success: 'rgba(51, 198, 89, 0.9)',
                error: 'rgba(255, 59, 48, 0.9)',
                warning: 'rgba(255, 149, 0, 0.9)',
                info: 'rgba(46, 166, 255, 0.9)'
            };
            
            toastEl.style.background = colors[type] || colors.info;
            
            setTimeout(() => {
                toastEl.classList.remove('show');
            }, 3000);
        }

        // =================== TELEGRAM INTEGRATION ===================
        tg.MainButton.setParams({
            text: '‚ûï NEW ORDER',
            color: '#2ea6ff',
            text_color: '#ffffff'
        });

        tg.MainButton.onClick(openNewOrderModal);
        tg.MainButton.show();

        tg.BackButton.onClick(() => {
            if (document.querySelector('.modal-overlay.active')) {
                closeModal();
            } else {
                switchScreen('home-screen');
            }
        });

        // Handle viewport changes
        tg.onEvent('viewportChanged', () => {
            tg.expand();
        });

        // Export functions for testing
        window.addTestOrder = function() {
            const testOrder = {
                id: `TEST${Date.now()}`,
                customer: { name: 'Test User', telegramId: '@test', avatar: 'T' },
                items: [{ id: 1, quantity: 2 }, { id: 10, quantity: 1 }],
                notes: 'Test order',
                amount: 15.5,
                status: 'completed',
                time: new Date().toISOString().replace('T', ' ').slice(0, 19)
            };
            
            orders.unshift(testOrder);
            localStorage.setItem('cafe_orders', JSON.stringify(orders));
            
            updateHomeStats();
            renderRecentOrders();
            showToast('‚úÖ Test order added', 'success');
        };

        window.clearAllData = function() {
            if (confirm('Clear ALL data? This cannot be undone!')) {
                localStorage.clear();
                orders = [];
                customers = [];
                loadSampleDataIfEmpty();
                updateHomeStats();
                renderRecentOrders();
                showToast('üóëÔ∏è All data cleared', 'warning');
            }
        };
    </script>
</body>
</html>
