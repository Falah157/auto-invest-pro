<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkyForce Islamic - Air Defense Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
            color: white;
            min-height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-container {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            text-align: center;
            position: relative;
        }

        /* Game Header */
        .game-header {
            background: linear-gradient(to right, #2c3e50, #4a6491);
            padding: 20px;
            border-radius: 15px 15px 0 0;
            border-bottom: 3px solid #f1c40f;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .game-title {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(to right, #f1c40f, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .game-subtitle {
            font-size: 1.2rem;
            color: #ecf0f1;
            margin-bottom: 15px;
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #f1c40f;
            text-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
        }

        .stat-label {
            font-size: 0.9rem;
            color: #bdc3c7;
            margin-top: 5px;
        }

        /* Game Canvas */
        .game-wrapper {
            position: relative;
            border: 5px solid #2c3e50;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            margin: 20px 0;
        }

        #gameCanvas {
            background: linear-gradient(to bottom, #1a2980, #26d0ce);
            display: block;
            width: 100%;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .control-btn {
            background: linear-gradient(to bottom, #3498db, #2980b9);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .control-btn:active {
            transform: translateY(1px);
        }

        .control-btn.start {
            background: linear-gradient(to bottom, #2ecc71, #27ae60);
        }

        .control-btn.pause {
            background: linear-gradient(to bottom, #f39c12, #d35400);
        }

        .control-btn.reset {
            background: linear-gradient(to bottom, #e74c3c, #c0392b);
        }

        /* Mobile Controls */
        .mobile-controls {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
            padding: 20px;
        }

        .mobile-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }

        .mobile-btn:active {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(0.95);
        }

        .mobile-fire {
            grid-column: 2;
            background: rgba(231, 76, 60, 0.8);
            border-color: #e74c3c;
        }

        /* Instructions */
        .instructions {
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: left;
        }

        .instructions h3 {
            color: #f1c40f;
            margin-bottom: 15px;
            text-align: center;
        }

        .instruction-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .instruction-item i {
            color: #3498db;
            font-size: 1.2rem;
            width: 30px;
        }

        /* Power-ups Display */
        .powerups-display {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .powerup-item {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 2px solid transparent;
        }

        .powerup-item.active {
            border-color: #f1c40f;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Game Over Screen */
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            display: none;
            z-index: 100;
            width: 80%;
            max-width: 500px;
            border: 5px solid #f1c40f;
            box-shadow: 0 0 50px rgba(241, 196, 15, 0.5);
        }

        .game-over h2 {
            color: #e74c3c;
            font-size: 3rem;
            margin-bottom: 20px;
            text-transform: uppercase;
        }

        .final-score {
            font-size: 4rem;
            color: #f1c40f;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 0 0 20px rgba(241, 196, 15, 0.8);
        }

        /* Level Complete Screen */
        .level-complete {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            display: none;
            z-index: 100;
            width: 80%;
            max-width: 500px;
            border: 5px solid #2ecc71;
            box-shadow: 0 0 50px rgba(46, 204, 113, 0.5);
        }

        .level-complete h2 {
            color: #2ecc71;
            font-size: 3rem;
            margin-bottom: 20px;
        }

        /* Islamic Theme Elements */
        .islamic-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255,255,255,0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255,255,255,0.05) 0%, transparent 20%);
            pointer-events: none;
            z-index: -1;
        }

        .islamic-decoration {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2rem;
            color: rgba(255, 255, 255, 0.1);
            z-index: -1;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .game-title {
                font-size: 2rem;
            }
            
            .mobile-controls {
                display: grid;
            }
            
            .control-btn {
                padding: 12px 20px;
                font-size: 1rem;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .stats-bar {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .stat-item {
                flex: 1 0 calc(50% - 10px);
            }
            
            .controls {
                flex-wrap: wrap;
            }
            
            .control-btn {
                flex: 1;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="islamic-pattern"></div>
    <div class="islamic-decoration">
        <i class="fas fa-star-and-crescent"></i>
    </div>

    <div class="game-container">
        <!-- Game Header -->
        <div class="game-header">
            <h1 class="game-title">SkyForce Islamic</h1>
            <div class="game-subtitle">Defend the Ummah from Evil Forces!</div>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="score">0</div>
                <div class="stat-label">SCORE</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="lives">3</div>
                <div class="stat-label">LIVES</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="level">1</div>
                <div class="stat-label">LEVEL</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="enemies">0</div>
                <div class="stat-label">ENEMIES</div>
            </div>
        </div>

        <!-- Power-ups Display -->
        <div class="powerups-display">
            <div class="powerup-item" id="shieldPowerup">
                <i class="fas fa-shield-alt"></i>
                <span>Shield: <span id="shieldTime">0</span>s</span>
            </div>
            <div class="powerup-item" id="rapidFirePowerup">
                <i class="fas fa-bolt"></i>
                <span>Rapid Fire: <span id="rapidFireTime">0</span>s</span>
            </div>
            <div class="powerup-item" id="bombPowerup">
                <i class="fas fa-bomb"></i>
                <span>Bombs: <span id="bombCount">0</span></span>
            </div>
        </div>

        <!-- Game Canvas -->
        <div class="game-wrapper">
            <canvas id="gameCanvas" width="800" height="500"></canvas>
        </div>

        <!-- Desktop Controls -->
        <div class="controls">
            <button class="control-btn start" id="startBtn">
                <i class="fas fa-play"></i> START
            </button>
            <button class="control-btn pause" id="pauseBtn">
                <i class="fas fa-pause"></i> PAUSE
            </button>
            <button class="control-btn reset" id="resetBtn">
                <i class="fas fa-redo"></i> RESET
            </button>
        </div>

        <!-- Mobile Controls -->
        <div class="mobile-controls">
            <div class="mobile-btn" id="moveLeft">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="mobile-btn mobile-fire" id="fireBtn">
                <i class="fas fa-crosshairs"></i>
            </div>
            <div class="mobile-btn" id="moveRight">
                <i class="fas fa-arrow-right"></i>
            </div>
            <div class="mobile-btn" id="bombBtn">
                <i class="fas fa-bomb"></i> BOMB
            </div>
            <div class="mobile-btn" id="moveUp">
                <i class="fas fa-arrow-up"></i>
            </div>
            <div class="mobile-btn" id="moveDown">
                <i class="fas fa-arrow-down"></i>
            </div>
        </div>

        <!-- Instructions -->
        <div class="instructions">
            <h3>How to Play</h3>
            <div class="instruction-item">
                <i class="fas fa-arrows-alt-h"></i>
                <span>Use Arrow Keys or WASD to move your fighter jet</span>
            </div>
            <div class="instruction-item">
                <i class="fas fa-space-shuttle"></i>
                <span>Press SPACE or Click/Tap to fire missiles</span>
            </div>
            <div class="instruction-item">
                <i class="fas fa-star"></i>
                <span>Collect power-ups: Shield (Blue), Rapid Fire (Yellow), Bomb (Red)</span>
            </div>
            <div class="instruction-item">
                <i class="fas fa-skull-crossbones"></i>
                <span>Destroy evil enemies before they reach the bottom</span>
            </div>
            <div class="instruction-item">
                <i class="fas fa-mosque"></i>
                <span>Protect the Islamic cities at the bottom!</span>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div class="game-over" id="gameOverScreen">
            <h2>Game Over</h2>
            <div class="final-score" id="finalScore">0</div>
            <p>Your score: <span id="gameOverScore">0</span></p>
            <p>Level reached: <span id="gameOverLevel">1</span></p>
            <div style="margin-top: 30px;">
                <button class="control-btn start" id="restartBtn">
                    <i class="fas fa-redo"></i> PLAY AGAIN
                </button>
            </div>
        </div>

        <!-- Level Complete Screen -->
        <div class="level-complete" id="levelCompleteScreen">
            <h2>Level Complete!</h2>
            <div style="font-size: 3rem; color: #f1c40f; margin: 20px 0;">
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
            </div>
            <p style="font-size: 1.2rem; margin-bottom: 20px;">Congratulations! You defended the Ummah!</p>
            <p>Score: <span style="color: #f1c40f; font-weight: bold;" id="levelScore">0</span></p>
            <div style="margin-top: 30px;">
                <button class="control-btn start" id="nextLevelBtn">
                    <i class="fas fa-arrow-right"></i> NEXT LEVEL
                </button>
            </div>
        </div>
    </div>

    <!-- Audio Elements -->
    <audio id="shootSound" src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==" preload="auto"></audio>
    <audio id="explosionSound" src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==" preload="auto"></audio>
    <audio id="powerupSound" src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==" preload="auto"></audio>

    <script>
        // ================================
        // SKYFORCE ISLAMIC GAME
        // ================================

        // Game variables
        let canvas, ctx;
        let gameRunning = false;
        let gamePaused = false;
        let score = 0;
        let lives = 3;
        let level = 1;
        let enemiesRemaining = 0;
        let gameLoop;

        // Player variables
        let player = {
            x: 400,
            y: 450,
            width: 60,
            height: 40,
            speed: 8,
            color: '#3498db',
            missiles: [],
            lastShot: 0,
            shootDelay: 300, // ms between shots
            shield: false,
            shieldTime: 0,
            rapidFire: false,
            rapidFireTime: 0,
            bombs: 0
        };

        // Keys object
        let keys = {
            ArrowLeft: false,
            ArrowRight: false,
            ArrowUp: false,
            ArrowDown: false,
            ' ': false // Space for shooting
        };

        // Arrays for game objects
        let enemies = [];
        let powerups = [];
        let explosions = [];
        let enemyMissiles = [];

        // Enemy types with Islamic-themed names
        const enemyTypes = [
            { name: "Fitan", color: "#e74c3c", health: 1, speed: 2, points: 100, shape: "triangle" },
            { name: "Batil", color: "#9b59b6", health: 2, speed: 1.5, points: 200, shape: "square" },
            { name: "Dajjal", color: "#c0392b", health: 3, speed: 1, points: 300, shape: "pentagon" },
            { name: "Shaytan", color: "#2c3e50", health: 5, speed: 0.8, points: 500, shape: "hexagon" }
        ];

        // Power-up types
        const powerupTypes = [
            { type: "shield", color: "#3498db", symbol: "ðŸ›¡ï¸", duration: 10000 },
            { type: "rapid", color: "#f1c40f", symbol: "âš¡", duration: 8000 },
            { type: "bomb", color: "#e74c3c", symbol: "ðŸ’£", duration: 0 },
            { type: "life", color: "#2ecc71", symbol: "â¤ï¸", duration: 0 }
        ];

        // Cities at the bottom (to protect)
        let cities = [
            { x: 100, y: 480, width: 40, height: 20, color: '#2ecc71', alive: true },
            { x: 200, y: 480, width: 40, height: 20, color: '#2ecc71', alive: true },
            { x: 300, y: 480, width: 40, height: 20, color: '#2ecc71', alive: true },
            { x: 400, y: 480, width: 40, height: 20, color: '#2ecc71', alive: true },
            { x: 500, y: 480, width: 40, height: 20, color: '#2ecc71', alive: true },
            { x: 600, y: 480, width: 40, height: 20, color: '#2ecc71', alive: true },
            { x: 700, y: 480, width: 40, height: 20, color: '#2ecc71', alive: true }
        ];

        // Initialize game
        function init() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // Set up event listeners
            setupEventListeners();
            
            // Initialize game state
            resetGame();
            
            // Draw initial screen
            drawStartScreen();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Keyboard controls
            document.addEventListener('keydown', (e) => {
                if (keys.hasOwnProperty(e.key)) {
                    keys[e.key] = true;
                    e.preventDefault();
                }
                
                // Space bar for shooting
                if (e.key === ' ') {
                    if (gameRunning && !gamePaused) {
                        shootMissile();
                    }
                    e.preventDefault();
                }
                
                // B for bomb
                if (e.key === 'b' || e.key === 'B') {
                    if (gameRunning && !gamePaused && player.bombs > 0) {
                        useBomb();
                    }
                }
            });

            document.addEventListener('keyup', (e) => {
                if (keys.hasOwnProperty(e.key)) {
                    keys[e.key] = false;
                    e.preventDefault();
                }
            });

            // Button controls
            document.getElementById('startBtn').addEventListener('click', startGame);
            document.getElementById('pauseBtn').addEventListener('click', togglePause);
            document.getElementById('resetBtn').addEventListener('click', resetGame);
            document.getElementById('restartBtn').addEventListener('click', resetGame);
            document.getElementById('nextLevelBtn').addEventListener('click', nextLevel);

            // Mobile controls
            document.getElementById('moveLeft').addEventListener('touchstart', () => keys.ArrowLeft = true);
            document.getElementById('moveLeft').addEventListener('touchend', () => keys.ArrowLeft = false);
            document.getElementById('moveRight').addEventListener('touchstart', () => keys.ArrowRight = true);
            document.getElementById('moveRight').addEventListener('touchend', () => keys.ArrowRight = false);
            document.getElementById('moveUp').addEventListener('touchstart', () => keys.ArrowUp = true);
            document.getElementById('moveUp').addEventListener('touchend', () => keys.ArrowUp = false);
            document.getElementById('moveDown').addEventListener('touchstart', () => keys.ArrowDown = true);
            document.getElementById('moveDown').addEventListener('touchend', () => keys.ArrowDown = false);
            document.getElementById('fireBtn').addEventListener('touchstart', () => {
                if (gameRunning && !gamePaused) shootMissile();
            });
            document.getElementById('bombBtn').addEventListener('touchstart', () => {
                if (gameRunning && !gamePaused && player.bombs > 0) useBomb();
            });

            // Mouse controls for shooting
            canvas.addEventListener('click', (e) => {
                if (gameRunning && !gamePaused) {
                    shootMissile();
                }
            });

            // Prevent context menu on canvas
            canvas.addEventListener('contextmenu', (e) => e.preventDefault());
        }

        // Draw start screen
        function drawStartScreen() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw background
            drawBackground();
            
            // Draw title
            ctx.fillStyle = '#f1c40f';
            ctx.font = 'bold 48px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('SKYFORCE ISLAMIC', canvas.width / 2, 150);
            
            // Draw subtitle
            ctx.fillStyle = '#ecf0f1';
            ctx.font = '24px Arial';
            ctx.fillText('Defend the Ummah from Evil Forces', canvas.width / 2, 200);
            
            // Draw instructions
            ctx.fillStyle = '#3498db';
            ctx.font = '20px Arial';
            ctx.fillText('Press START or SPACE to begin', canvas.width / 2, 300);
            
            // Draw player ship
            drawPlayer();
            
            // Draw Islamic decoration
            ctx.fillStyle = 'rgba(46, 204, 113, 0.3)';
            for (let i = 0; i < 5; i++) {
                drawStar(canvas.width / 2 + (i - 2) * 100, 350, 30);
            }
        }

        // Draw background with stars
        function drawBackground() {
            // Sky gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#1a2980');
            gradient.addColorStop(1, '#26d0ce');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Stars
            ctx.fillStyle = 'white';
            for (let i = 0; i < 100; i++) {
                const x = (i * 7.3) % canvas.width;
                const y = (i * 5.7) % canvas.height;
                const size = Math.random() * 2 + 1;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // Draw player ship
        function drawPlayer() {
            const x = player.x;
            const y = player.y;
            const w = player.width;
            const h = player.height;
            
            // Draw shield if active
            if (player.shield) {
                ctx.strokeStyle = '#3498db';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(x, y, w/1.2, 0, Math.PI * 2);
                ctx.stroke();
            }
            
            // Draw ship body
            ctx.fillStyle = player.color;
            ctx.beginPath();
            // Main body (triangle)
            ctx.moveTo(x, y - h/2);
            ctx.lineTo(x - w/2, y + h/2);
            ctx.lineTo(x + w/2, y + h/2);
            ctx.closePath();
            ctx.fill();
            
            // Cockpit
            ctx.fillStyle = '#2980b9';
            ctx.beginPath();
            ctx.arc(x, y - h/4, w/4, 0, Math.PI * 2);
            ctx.fill();
            
            // Wings
            ctx.fillStyle = '#2980b9';
            ctx.beginPath();
            ctx.moveTo(x - w/2, y + h/2);
            ctx.lineTo(x - w, y);
            ctx.lineTo(x - w/2, y);
            ctx.closePath();
            ctx.fill();
            
            ctx.beginPath();
            ctx.moveTo(x + w/2, y + h/2);
            ctx.lineTo(x + w, y);
            ctx.lineTo(x + w/2, y);
            ctx.closePath();
            ctx.fill();
            
            // Engine glow
            if (gameRunning) {
                ctx.fillStyle = '#f1c40f';
                ctx.beginPath();
                ctx.ellipse(x, y + h/2 + 5, w/4, h/4, 0, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // Draw star
        function drawStar(cx, cy, radius) {
            ctx.save();
            ctx.translate(cx, cy);
            
            ctx.beginPath();
            for (let i = 0; i < 5; i++) {
                const angle = (i * Math.PI * 2) / 5 - Math.PI / 2;
                const x = Math.cos(angle) * radius;
                const y = Math.sin(angle) * radius;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
                
                const innerAngle = angle + Math.PI / 5;
                const innerX = Math.cos(innerAngle) * (radius / 2);
                const innerY = Math.sin(innerAngle) * (radius / 2);
                ctx.lineTo(innerX, innerY);
            }
            ctx.closePath();
            ctx.fill();
            
            ctx.restore();
        }

        // Start game
        function startGame() {
            if (!gameRunning) {
                gameRunning = true;
                gamePaused = false;
                resetGame();
                gameLoop = requestAnimationFrame(update);
                document.getElementById('startBtn').innerHTML = '<i class="fas fa-play"></i> RESTART';
            }
        }

        // Toggle pause
        function togglePause() {
            if (gameRunning) {
                gamePaused = !gamePaused;
                document.getElementById('pauseBtn').innerHTML = gamePaused ? 
                    '<i class="fas fa-play"></i> RESUME' : 
                    '<i class="fas fa-pause"></i> PAUSE';
                
                if (!gamePaused) {
                    gameLoop = requestAnimationFrame(update);
                }
            }
        }

        // Reset game
        function resetGame() {
            // Reset game state
            score = 0;
            lives = 3;
            level = 1;
            enemiesRemaining = 0;
            
            // Reset player
            player.x = canvas.width / 2;
            player.y = canvas.height - 50;
            player.missiles = [];
            player.shield = false;
            player.shieldTime = 0;
            player.rapidFire = false;
            player.rapidFireTime = 0;
            player.bombs = 0;
            
            // Clear arrays
            enemies = [];
            powerups = [];
            explosions = [];
            enemyMissiles = [];
            
            // Reset cities
            cities.forEach(city => city.alive = true);
            
            // Hide game over screen
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('levelCompleteScreen').style.display = 'none';
            
            // Update UI
            updateUI();
            
            // Create initial enemies for level
            createLevelEnemies();
        }

        // Create enemies for current level
        function createLevelEnemies() {
            enemies = [];
            const enemyCount = 10 + level * 5;
            enemiesRemaining = enemyCount;
            
            for (let i = 0; i < enemyCount; i++) {
                const type = Math.min(Math.floor(level / 3), enemyTypes.length - 1);
                const enemyType = enemyTypes[Math.min(Math.floor(Math.random() * (type + 1)), enemyTypes.length - 1)];
                
                const enemy = {
                    x: Math.random() * (canvas.width - 60) + 30,
                    y: Math.random() * -200 - 50,
                    width: 40,
                    height: 40,
                    speed: enemyType.speed * (1 + level * 0.1),
                    color: enemyType.color,
                    health: enemyType.health,
                    maxHealth: enemyType.health,
                    points: enemyType.points,
                    shape: enemyType.shape,
                    name: enemyType.name,
                    lastShot: 0,
                    shootDelay: 2000 + Math.random() * 3000
                };
                
                enemies.push(enemy);
            }
            
            updateUI();
        }

        // Update game
        function update() {
            if (!gameRunning || gamePaused) return;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw background
            drawBackground();
            
            // Draw cities
            drawCities();
            
            // Update player
            updatePlayer();
            
            // Update missiles
            updateMissiles();
            
            // Update enemies
            updateEnemies();
            
            // Update powerups
            updatePowerups();
            
            // Update explosions
            updateExplosions();
            
            // Update enemy missiles
            updateEnemyMissiles();
            
            // Check collisions
            checkCollisions();
            
            // Draw game info
            drawGameInfo();
            
            // Update power-up timers
            updatePowerupTimers();
            
            // Check game conditions
            checkGameConditions();
            
            // Continue game loop
            if (gameRunning) {
                gameLoop = requestAnimationFrame(update);
            }
        }

        // Draw cities
        function drawCities() {
            cities.forEach(city => {
                if (city.alive) {
                    // City building
                    ctx.fillStyle = city.color;
                    ctx.fillRect(city.x, city.y, city.width, city.height);
                    
                    // Dome
                    ctx.fillStyle = '#f1c40f';
                    ctx.beginPath();
                    ctx.arc(city.x + city.width/2, city.y, city.width/2, 0, Math.PI);
                    ctx.fill();
                    
                    // Minaret
                    ctx.fillStyle = '#7f8c8d';
                    ctx.fillRect(city.x + city.width/2 - 5, city.y - 30, 10, 30);
                    
                    // Crescent
                    ctx.fillStyle = '#f1c40f';
                    ctx.beginPath();
                    ctx.arc(city.x + city.width/2, city.y - 25, 8, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
        }

        // Update player position
        function updatePlayer() {
            // Move player based on keys
            if (keys.ArrowLeft && player.x > player.width/2) {
                player.x -= player.speed;
            }
            if (keys.ArrowRight && player.x < canvas.width - player.width/2) {
                player.x += player.speed;
            }
            if (keys.ArrowUp && player.y > player.height/2) {
                player.y -= player.speed;
            }
            if (keys.ArrowDown && player.y < canvas.height - player.height/2) {
                player.y += player.speed;
            }
            
            // Draw player
            drawPlayer();
            
            // Auto-shoot if rapid fire is active
            if (player.rapidFire && Date.now() - player.lastShot > player.shootDelay / 3) {
                shootMissile();
            }
        }

        // Shoot missile
        function shootMissile() {
            const now = Date.now();
            if (now - player.lastShot > player.shootDelay) {
                player.missiles.push({
                    x: player.x,
                    y: player.y - player.height/2,
                    width: 4,
                    height: 15,
                    speed: 12,
                    color: player.rapidFire ? '#f1c40f' : '#e74c3c'
                });
                player.lastShot = now;
                
                // Play shoot sound
                playSound('shoot');
            }
        }

        // Use bomb
        function useBomb() {
            if (player.bombs > 0) {
                player.bombs--;
                
                // Create explosion effect
                explosions.push({
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    radius: 0,
                    maxRadius: canvas.width,
                    color: '#f1c40f',
                    life: 1
                });
                
                // Destroy all enemies
                enemies.forEach(enemy => {
                    score += enemy.points;
                    explosions.push({
                        x: enemy.x,
                        y: enemy.y,
                        radius: 0,
                        maxRadius: 30,
                        color: enemy.color,
                        life: 1
                    });
                });
                
                enemies = [];
                enemiesRemaining = 0;
                
                // Update UI
                updateUI();
                
                // Play explosion sound
                playSound('explosion');
            }
        }

        // Update missiles
        function updateMissiles() {
            for (let i = player.missiles.length - 1; i >= 0; i--) {
                const missile = player.missiles[i];
                missile.y -= missile.speed;
                
                // Draw missile
                ctx.fillStyle = missile.color;
                ctx.fillRect(missile.x - missile.width/2, missile.y, missile.width, missile.height);
                
                // Add trail
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.fillRect(missile.x - missile.width/4, missile.y + missile.height, missile.width/2, 5);
                
                // Remove if off screen
                if (missile.y < -missile.height) {
                    player.missiles.splice(i, 1);
                }
            }
        }

        // Update enemies
        function updateEnemies() {
            const now = Date.now();
            
            for (let i = enemies.length - 1; i >= 0; i--) {
                const enemy = enemies[i];
                
                // Move enemy down
                enemy.y += enemy.speed;
                
                // Draw enemy based on shape
                ctx.fillStyle = enemy.color;
                ctx.save();
                ctx.translate(enemy.x, enemy.y);
                
                switch(enemy.shape) {
                    case 'triangle':
                        ctx.beginPath();
                        ctx.moveTo(0, -enemy.height/2);
                        ctx.lineTo(-enemy.width/2, enemy.height/2);
                        ctx.lineTo(enemy.width/2, enemy.height/2);
                        ctx.closePath();
                        ctx.fill();
                        break;
                        
                    case 'square':
                        ctx.fillRect(-enemy.width/2, -enemy.height/2, enemy.width, enemy.height);
                        break;
                        
                    case 'pentagon':
                        ctx.beginPath();
                        for (let j = 0; j < 5; j++) {
                            const angle = (j * Math.PI * 2) / 5 - Math.PI / 2;
                            const x = Math.cos(angle) * enemy.width/2;
                            const y = Math.sin(angle) * enemy.height/2;
                            if (j === 0) ctx.moveTo(x, y);
                            else ctx.lineTo(x, y);
                        }
                        ctx.closePath();
                        ctx.fill();
                        break;
                        
                    case 'hexagon':
                        ctx.beginPath();
                        for (let j = 0; j < 6; j++) {
                            const angle = (j * Math.PI * 2) / 6;
                            const x = Math.cos(angle) * enemy.width/2;
                            const y = Math.sin(angle) * enemy.height/2;
                            if (j === 0) ctx.moveTo(x, y);
                            else ctx.lineTo(x, y);
                        }
                        ctx.closePath();
                        ctx.fill();
                        break;
                }
                
                // Draw enemy name
                ctx.fillStyle = 'white';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(enemy.name, 0, -enemy.height/2 - 10);
                
                // Draw health bar
                if (enemy.health < enemy.maxHealth) {
                    const healthPercent = enemy.health / enemy.maxHealth;
                    ctx.fillStyle = '#e74c3c';
                    ctx.fillRect(-enemy.width/2, enemy.height/2 + 5, enemy.width, 3);
                    ctx.fillStyle = '#2ecc71';
                    ctx.fillRect(-enemy.width/2, enemy.height/2 + 5, enemy.width * healthPercent, 3);
                }
                
                ctx.restore();
                
                // Enemy shooting
                if (now - enemy.lastShot > enemy.shootDelay) {
                    enemyMissiles.push({
                        x: enemy.x,
                        y: enemy.y + enemy.height/2,
                        width: 3,
                        height: 10,
                        speed: 4,
                        color: enemy.color
                    });
                    enemy.lastShot = now;
                }
                
                // Remove if off screen
                if (enemy.y > canvas.height + enemy.height) {
                    enemies.splice(i, 1);
                    enemiesRemaining--;
                    
                    // Lose a city if enemy reaches bottom
                    const aliveCities = cities.filter(c => c.alive);
                    if (aliveCities.length > 0) {
                        const city = aliveCities[Math.floor(Math.random() * aliveCities.length)];
                        city.alive = false;
                    }
                }
            }
            
            updateUI();
        }

        // Update powerups
        function updatePowerups() {
            for (let i = powerups.length - 1; i >= 0; i--) {
                const powerup = powerups[i];
                powerup.y += powerup.speed;
                
                // Draw powerup
                ctx.fillStyle = powerup.color;
                ctx.beginPath();
                ctx.arc(powerup.x, powerup.y, powerup.radius, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw symbol
                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(powerup.symbol, powerup.x, powerup.y);
                
                // Remove if off screen
                if (powerup.y > canvas.height + powerup.radius) {
                    powerups.splice(i, 1);
                }
            }
            
            // Randomly spawn powerups
            if (Math.random() < 0.002 && powerups.length < 3) {
                const type = powerupTypes[Math.floor(Math.random() * powerupTypes.length)];
                powerups.push({
                    x: Math.random() * (canvas.width - 40) + 20,
                    y: -20,
                    radius: 15,
                    speed: 2,
                    type: type.type,
                    color: type.color,
                    symbol: type.symbol,
                    duration: type.duration
                });
            }
        }

        // Update explosions
        function updateExplosions() {
            for (let i = explosions.length - 1; i >= 0; i--) {
                const explosion = explosions[i];
                explosion.radius += 5;
                explosion.life -= 0.02;
                
                // Draw explosion
                ctx.globalAlpha = explosion.life;
                ctx.fillStyle = explosion.color;
                ctx.beginPath();
                ctx.arc(explosion.x, explosion.y, explosion.radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
                
                // Remove if done
                if (explosion.life <= 0 || explosion.radius >= explosion.maxRadius) {
                    explosions.splice(i, 1);
                }
            }
        }

        // Update enemy missiles
        function updateEnemyMissiles() {
            for (let i = enemyMissiles.length - 1; i >= 0; i--) {
                const missile = enemyMissiles[i];
                missile.y += missile.speed;
                
                // Draw missile
                ctx.fillStyle = missile.color;
                ctx.fillRect(missile.x - missile.width/2, missile.y, missile.width, missile.height);
                
                // Remove if off screen
                if (missile.y > canvas.height) {
                    enemyMissiles.splice(i, 1);
                }
            }
        }

        // Check collisions
        function checkCollisions() {
            // Player missiles vs enemies
            for (let i = player.missiles.length - 1; i >= 0; i--) {
                const missile = player.missiles[i];
                
                for (let j = enemies.length - 1; j >= 0; j--) {
                    const enemy = enemies[j];
                    
                    if (isColliding(missile, enemy)) {
                        // Hit enemy
                        enemy.health--;
                        
                        // Create explosion
                        explosions.push({
                            x: enemy.x,
                            y: enemy.y,
                            radius: 0,
                            maxRadius: 20,
                            color: enemy.color,
                            life: 1
                        });
                        
                        // Remove missile
                        player.missiles.splice(i, 1);
                        
                        // If enemy destroyed
                        if (enemy.health <= 0) {
                            score += enemy.points;
                            enemies.splice(j, 1);
                            enemiesRemaining--;
                            
                            // Chance to drop powerup
                            if (Math.random() < 0.3) {
                                const type = powerupTypes[Math.floor(Math.random() * powerupTypes.length)];
                                powerups.push({
                                    x: enemy.x,
                                    y: enemy.y,
                                    radius: 15,
                                    speed: 2,
                                    type: type.type,
                                    color: type.color,
                                    symbol: type.symbol,
                                    duration: type.duration
                                });
                            }
                            
                            // Play explosion sound
                            playSound('explosion');
                        }
                        
                        break;
                    }
                }
            }
            
            // Player vs enemies
            if (!player.shield) {
                for (let i = enemies.length - 1; i >= 0; i--) {
                    const enemy = enemies[i];
                    
                    if (isColliding(player, enemy)) {
                        // Player hit
                        lives--;
                        enemies.splice(i, 1);
                        enemiesRemaining--;
                        
                        // Create explosion
                        explosions.push({
                            x: player.x,
                            y: player.y,
                            radius: 0,
                            maxRadius: 50,
                            color: '#e74c3c',
                            life: 1
                        });
                        
                        // Shake effect
                        setTimeout(() => {
                            player.x = canvas.width / 2;
                            player.y = canvas.height - 50;
                        }, 100);
                        
                        updateUI();
                        break;
                    }
                }
            }
            
            // Player vs powerups
            for (let i = powerups.length - 1; i >= 0; i--) {
                const powerup = powerups[i];
                
                if (isColliding(player, powerup)) {
                    // Collect powerup
                    collectPowerup(powerup);
                    powerups.splice(i, 1);
                    
                    // Play powerup sound
                    playSound('powerup');
                }
            }
            
            // Enemy missiles vs player
            if (!player.shield) {
                for (let i = enemyMissiles.length - 1; i >= 0; i--) {
                    const missile = enemyMissiles[i];
                    
                    if (isColliding(player, missile)) {
                        // Player hit
                        lives--;
                        enemyMissiles.splice(i, 1);
                        
                        // Create explosion
                        explosions.push({
                            x: player.x,
                            y: player.y,
                            radius: 0,
                            maxRadius: 30,
                            color: '#e74c3c',
                            life: 1
                        });
                        
                        updateUI();
                        break;
                    }
                }
            }
            
            // Enemy missiles vs cities
            for (let i = enemyMissiles.length - 1; i >= 0; i--) {
                const missile = enemyMissiles[i];
                
                for (let j = 0; j < cities.length; j++) {
                    const city = cities[j];
                    
                    if (city.alive && isColliding(missile, city)) {
                        // City hit
                        city.alive = false;
                        enemyMissiles.splice(i, 1);
                        
                        // Create explosion
                        explosions.push({
                            x: city.x + city.width/2,
                            y: city.y + city.height/2,
                            radius: 0,
                            maxRadius: 30,
                            color: '#e74c3c',
                            life: 1
                        });
                        
                        break;
                    }
                }
            }
        }

        // Check if two objects are colliding
        function isColliding(obj1, obj2) {
            // Simple circle collision for powerups, rectangle for others
            if (obj1.radius && obj2.radius) {
                // Circle-circle collision
                const dx = obj1.x - obj2.x;
                const dy = obj1.y - obj2.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                return distance < obj1.radius + obj2.radius;
            } else if (obj1.radius || obj2.radius) {
                // Circle-rectangle collision
                const circle = obj1.radius ? obj1 : obj2;
                const rect = obj1.radius ? obj2 : obj1;
                
                const closestX = Math.max(rect.x - rect.width/2, Math.min(circle.x, rect.x + rect.width/2));
                const closestY = Math.max(rect.y - rect.height/2, Math.min(circle.y, rect.y + rect.height/2));
                
                const dx = circle.x - closestX;
                const dy = circle.y - closestY;
                
                return (dx * dx + dy * dy) < (circle.radius * circle.radius);
            } else {
                // Rectangle-rectangle collision
                return Math.abs(obj1.x - obj2.x) < (obj1.width + obj2.width)/2 &&
                       Math.abs(obj1.y - obj2.y) < (obj1.height + obj2.height)/2;
            }
        }

        // Collect powerup
        function collectPowerup(powerup) {
            switch(powerup.type) {
                case 'shield':
                    player.shield = true;
                    player.shieldTime = powerup.duration;
                    document.getElementById('shieldPowerup').classList.add('active');
                    break;
                    
                case 'rapid':
                    player.rapidFire = true;
                    player.rapidFireTime = powerup.duration;
                    document.getElementById('rapidFirePowerup').classList.add('active');
                    break;
                    
                case 'bomb':
                    player.bombs++;
                    updateUI();
                    break;
                    
                case 'life':
                    lives = Math.min(lives + 1, 5);
                    updateUI();
                    break;
            }
        }

        // Update powerup timers
        function updatePowerupTimers() {
            const now = Date.now();
            
            // Update shield
            if (player.shield) {
                player.shieldTime -= 16; // Approximate time per frame
                document.getElementById('shieldTime').textContent = Math.max(0, Math.ceil(player.shieldTime / 1000));
                
                if (player.shieldTime <= 0) {
                    player.shield = false;
                    document.getElementById('shieldPowerup').classList.remove('active');
                }
            }
            
            // Update rapid fire
            if (player.rapidFire) {
                player.rapidFireTime -= 16;
                document.getElementById('rapidFireTime').textContent = Math.max(0, Math.ceil(player.rapidFireTime / 1000));
                
                if (player.rapidFireTime <= 0) {
                    player.rapidFire = false;
                    document.getElementById('rapidFirePowerup').classList.remove('active');
                }
            }
        }

        // Draw game info
        function drawGameInfo() {
            // Draw score
            ctx.fillStyle = 'white';
            ctx.font = '16px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`Score: ${score}`, 10, 25);
            ctx.fillText(`Level: ${level}`, 10, 45);
            ctx.fillText(`Enemies: ${enemiesRemaining}`, 10, 65);
            
            // Draw lives
            for (let i = 0; i < lives; i++) {
                ctx.fillStyle = '#e74c3c';
                ctx.beginPath();
                ctx.arc(canvas.width - 30 - i * 30, 25, 10, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Draw bombs
            ctx.fillStyle = '#f1c40f';
            ctx.font = '16px Arial';
            ctx.textAlign = 'right';
            ctx.fillText(`Bombs: ${player.bombs}`, canvas.width - 10, 45);
        }

        // Check game conditions
        function checkGameConditions() {
            // Check if all enemies destroyed
            if (enemiesRemaining <= 0 && enemies.length === 0) {
                levelComplete();
                return;
            }
            
            // Check if all cities destroyed
            const aliveCities = cities.filter(c => c.alive);
            if (aliveCities.length === 0) {
                gameOver();
                return;
            }
            
            // Check if player lost all lives
            if (lives <= 0) {
                gameOver();
                return;
            }
        }

        // Level complete
        function levelComplete() {
            gameRunning = false;
            cancelAnimationFrame(gameLoop);
            
            // Update level complete screen
            document.getElementById('levelScore').textContent = score;
            document.getElementById('levelCompleteScreen').style.display = 'block';
        }

        // Next level
        function nextLevel() {
            level++;
            document.getElementById('levelCompleteScreen').style.display = 'none';
            
            // Keep player powerups
            const currentShieldTime = player.shieldTime;
            const currentRapidFireTime = player.rapidFireTime;
            const currentBombs = player.bombs;
            
            // Reset some values
            player.missiles = [];
            enemyMissiles = [];
            explosions = [];
            powerups = [];
            
            // Restore powerups
            player.shieldTime = currentShieldTime;
            player.rapidFireTime = currentRapidFireTime;
            player.bombs = currentBombs;
            
            // Create new enemies
            createLevelEnemies();
            
            // Update UI
            updateUI();
            
            // Resume game
            gameRunning = true;
            gameLoop = requestAnimationFrame(update);
        }

        // Game over
        function gameOver() {
            gameRunning = false;
            cancelAnimationFrame(gameLoop);
            
            // Update game over screen
            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOverScore').textContent = score;
            document.getElementById('gameOverLevel').textContent = level;
            document.getElementById('gameOverScreen').style.display = 'block';
        }

        // Update UI
        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('lives').textContent = lives;
            document.getElementById('level').textContent = level;
            document.getElementById('enemies').textContent = enemiesRemaining;
            document.getElementById('bombCount').textContent = player.bombs;
        }

        // Play sound
        function playSound(type) {
            // Simple beep sounds using Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                switch(type) {
                    case 'shoot':
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.1);
                        break;
                        
                    case 'explosion':
                        oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.5);
                        break;
                        
                    case 'powerup':
                        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                        oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                        oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
                        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.3);
                        break;
                }
            } catch (e) {
                console.log('Audio not supported:', e);
            }
        }

        // Initialize game when page loads
        window.addEventListener('load', init);

        // Export for debugging
        window.game = {
            startGame,
            togglePause,
            resetGame,
            getState: () => ({ score, lives, level, enemiesRemaining })
        };

        console.log('SkyForce Islamic Game Loaded!');
        console.log('Controls: Arrow Keys to move, SPACE to shoot, B for bomb');
        console.log('Protect the Islamic cities at the bottom!');
    </script>
</body>
</html>
