<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS Template Builder</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #2563eb;
            --secondary-color: #7c3aed;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --dark-color: #1f2937;
            --light-color: #f9fafb;
            --border-color: #e5e7eb;
            --sidebar-width: 280px;
            --header-height: 70px;
        }

        body {
            background-color: #f3f4f6;
            color: var(--dark-color);
            overflow-x: hidden;
        }

        /* Header */
        .header {
            height: var(--header-height);
            background: white;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 25px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .logo i {
            font-size: 1.8rem;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-secondary {
            background-color: white;
            color: var(--dark-color);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: #f9fafb;
            border-color: #d1d5db;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #0da271;
        }

        /* Main Container */
        .container {
            display: flex;
            min-height: calc(100vh - var(--header-height));
            margin-top: var(--header-height);
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            border-right: 1px solid var(--border-color);
            padding: 25px 20px;
            position: fixed;
            top: var(--header-height);
            left: 0;
            bottom: 0;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 90;
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .sidebar-title {
            font-size: 0.9rem;
            text-transform: uppercase;
            color: #6b7280;
            font-weight: 600;
            margin-bottom: 15px;
            letter-spacing: 0.5px;
        }

        .components-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .component-item {
            padding: 15px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: grab;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .component-item:hover {
            border-color: var(--primary-color);
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        .component-icon {
            width: 40px;
            height: 40px;
            background: #e0e7ff;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        .component-info h4 {
            font-size: 1rem;
            margin-bottom: 4px;
        }

        .component-info p {
            font-size: 0.8rem;
            color: #6b7280;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        /* Builder Area */
        .builder-area {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
        }

        @media (max-width: 1024px) {
            .builder-area {
                grid-template-columns: 1fr;
            }
        }

        /* Canvas */
        .canvas-container {
            background: white;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 16px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .canvas-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .canvas-header h2 {
            font-size: 1.3rem;
        }

        .canvas-actions {
            display: flex;
            gap: 10px;
        }

        .canvas {
            min-height: 600px;
            padding: 20px;
            position: relative;
        }

        .canvas-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 500px;
            color: #9ca3af;
        }

        .canvas-empty i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .canvas-empty h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .droppable-area {
            min-height: 100%;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .droppable-area.drag-over {
            border-color: var(--primary-color);
            background-color: rgba(37, 99, 235, 0.05);
        }

        .canvas-component {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            transition: all 0.3s ease;
        }

        .canvas-component:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .component-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .component-actions {
            display: flex;
            gap: 8px;
        }

        .component-action-btn {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #6b7280;
            transition: all 0.2s ease;
        }

        .component-action-btn:hover {
            background: #f3f4f6;
            color: var(--dark-color);
        }

        /* Preview Panel */
        .preview-panel {
            background: white;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 16px rgba(0,0,0,0.05);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .preview-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .preview-header h2 {
            font-size: 1.3rem;
        }

        .preview-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .preview-device-selector {
            display: flex;
            background: #f3f4f6;
            border-radius: 8px;
            padding: 5px;
            margin-bottom: 20px;
        }

        .device-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            border-radius: 6px;
            background: transparent;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .device-btn.active {
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .preview-iframe {
            width: 100%;
            height: 500px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: white;
            overflow: hidden;
        }

        .mobile-preview {
            max-width: 375px;
            margin: 0 auto;
            border: 12px solid #1f2937;
            border-radius: 24px;
            height: 667px;
            overflow: hidden;
        }

        .desktop-preview {
            width: 100%;
            height: 100%;
        }

        /* Settings Panel */
        .settings-panel {
            background: white;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 16px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .settings-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-header h2 {
            font-size: 1.3rem;
        }

        .settings-content {
            padding: 20px;
        }

        .setting-group {
            margin-bottom: 25px;
        }

        .setting-group h4 {
            margin-bottom: 15px;
            color: #4b5563;
            font-size: 1rem;
        }

        .color-picker {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s ease;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: var(--dark-color);
        }

        .font-selector, .layout-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .font-option, .layout-option {
            padding: 12px;
            text-align: center;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .font-option:hover, .layout-option:hover {
            border-color: var(--primary-color);
            background: #f0f7ff;
        }

        .font-option.selected, .layout-option.selected {
            border-color: var(--primary-color);
            background: #e0e7ff;
            color: var(--primary-color);
            font-weight: 600;
        }

        /* Export Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 1.5rem;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            background: #f3f4f6;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #6b7280;
        }

        .modal-body {
            padding: 25px;
            flex: 1;
            overflow-y: auto;
        }

        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .export-option {
            padding: 25px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .export-option i {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .export-option h4 {
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .export-option p {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .code-preview {
            background: #1f2937;
            color: #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 100%;
                z-index: 1000;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                padding: 20px 15px;
            }
            
            .header-actions .btn span {
                display: none;
            }
            
            .header-actions .btn {
                padding: 10px 15px;
            }
            
            .mobile-toggle {
                display: block !important;
            }
        }

        .mobile-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--dark-color);
            cursor: pointer;
        }

        /* Component Styles */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .product-item {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.2s ease;
        }

        .product-item:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .product-image {
            width: 100%;
            height: 100px;
            background: #f3f4f6;
            border-radius: 6px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .payment-method {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .payment-method:hover {
            background: #f9fafb;
        }

        .payment-method.selected {
            border-color: var(--primary-color);
            background: #f0f7ff;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: #6b7280;
            font-size: 0.9rem;
            border-top: 1px solid var(--border-color);
            margin-top: auto;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <i class="fas fa-cash-register"></i>
            <span>POS Template Builder</span>
        </div>
        <button class="mobile-toggle" id="mobileToggle">
            <i class="fas fa-bars"></i>
        </button>
        <div class="header-actions">
            <button class="btn btn-secondary" id="saveTemplate">
                <i class="fas fa-save"></i>
                <span>Save</span>
            </button>
            <button class="btn btn-primary" id="exportBtn">
                <i class="fas fa-download"></i>
                <span>Export Template</span>
            </button>
            <button class="btn btn-success" id="previewBtn">
                <i class="fas fa-eye"></i>
                <span>Live Preview</span>
            </button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-section">
                <h3 class="sidebar-title">POS Components</h3>
                <div class="components-list" id="componentsList">
                    <div class="component-item" data-type="product-grid" draggable="true">
                        <div class="component-icon">
                            <i class="fas fa-th-large"></i>
                        </div>
                        <div class="component-info">
                            <h4>Product Grid</h4>
                            <p>Display products in a grid layout</p>
                        </div>
                    </div>
                    <div class="component-item" data-type="shopping-cart" draggable="true">
                        <div class="component-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="component-info">
                            <h4>Shopping Cart</h4>
                            <p>Cart with items and totals</p>
                        </div>
                    </div>
                    <div class="component-item" data-type="payment-methods" draggable="true">
                        <div class="component-icon">
                            <i class="fas fa-credit-card"></i>
                        </div>
                        <div class="component-info">
                            <h4>Payment Methods</h4>
                            <p>Select payment options</p>
                        </div>
                    </div>
                    <div class="component-item" data-type="customer-info" draggable="true">
                        <div class="component-icon">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="component-info">
                            <h4>Customer Info</h4>
                            <p>Collect customer details</p>
                        </div>
                    </div>
                    <div class="component-item" data-type="receipt-preview" draggable="true">
                        <div class="component-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="component-info">
                            <h4>Receipt Preview</h4>
                            <p>Generate and preview receipts</p>
                        </div>
                    </div>
                    <div class="component-item" data-type="quick-actions" draggable="true">
                        <div class="component-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <div class="component-info">
                            <h4>Quick Actions</h4>
                            <p>Common POS actions</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">Templates</h3>
                <div class="components-list">
                    <div class="component-item" data-template="retail">
                        <div class="component-icon" style="background: #dbeafe;">
                            <i class="fas fa-store"></i>
                        </div>
                        <div class="component-info">
                            <h4>Retail Store</h4>
                            <p>Standard retail POS</p>
                        </div>
                    </div>
                    <div class="component-item" data-template="restaurant">
                        <div class="component-icon" style="background: #fce7f3;">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div class="component-info">
                            <h4>Restaurant</h4>
                            <p>Table and order management</p>
                        </div>
                    </div>
                    <div class="component-item" data-template="service">
                        <div class="component-icon" style="background: #dcfce7;">
                            <i class="fas fa-concierge-bell"></i>
                        </div>
                        <div class="component-info">
                            <h4>Service Business</h4>
                            <p>Appointments and services</p>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="builder-area">
                <!-- Canvas Area -->
                <div class="canvas-container">
                    <div class="canvas-header">
                        <h2>POS Template Canvas</h2>
                        <div class="canvas-actions">
                            <button class="btn btn-secondary" id="clearCanvas">
                                <i class="fas fa-trash"></i>
                                Clear
                            </button>
                            <button class="btn btn-secondary" id="undoBtn">
                                <i class="fas fa-undo"></i>
                                Undo
                            </button>
                        </div>
                    </div>
                    <div class="canvas">
                        <div class="droppable-area" id="droppableArea">
                            <div class="canvas-empty" id="emptyState">
                                <i class="fas fa-hand-pointer"></i>
                                <h3>Drag components here</h3>
                                <p>Start building your POS template by dragging components from the sidebar</p>
                            </div>
                            <!-- Components will be added here dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Preview & Settings -->
                <div class="right-panel">
                    <!-- Preview Panel -->
                    <div class="preview-panel">
                        <div class="preview-header">
                            <h2>Live Preview</h2>
                        </div>
                        <div class="preview-content">
                            <div class="preview-device-selector">
                                <button class="device-btn active" data-device="desktop">Desktop</button>
                                <button class="device-btn" data-device="tablet">Tablet</button>
                                <button class="device-btn" data-device="mobile">Mobile</button>
                            </div>
                            <div class="preview-iframe" id="previewFrame">
                                <!-- Preview will be rendered here -->
                            </div>
                        </div>
                    </div>

                    <!-- Settings Panel -->
                    <div class="settings-panel">
                        <div class="settings-header">
                            <h2>Template Settings</h2>
                        </div>
                        <div class="settings-content">
                            <div class="setting-group">
                                <h4>Color Scheme</h4>
                                <div class="color-picker">
                                    <div class="color-option selected" style="background: #2563eb;" data-color="#2563eb"></div>
                                    <div class="color-option" style="background: #7c3aed;" data-color="#7c3aed"></div>
                                    <div class="color-option" style="background: #10b981;" data-color="#10b981"></div>
                                    <div class="color-option" style="background: #f59e0b;" data-color="#f59e0b"></div>
                                    <div class="color-option" style="background: #ef4444;" data-color="#ef4444"></div>
                                </div>
                            </div>

                            <div class="setting-group">
                                <h4>Font Family</h4>
                                <div class="font-selector">
                                    <div class="font-option selected" data-font="Arial, sans-serif">Arial</div>
                                    <div class="font-option" data-font="'Segoe UI', Tahoma, sans-serif">Segoe UI</div>
                                    <div class="font-option" data-font="'Roboto', sans-serif">Roboto</div>
                                    <div class="font-option" data-font="'Montserrat', sans-serif">Montserrat</div>
                                    <div class="font-option" data-font="'Poppins', sans-serif">Poppins</div>
                                    <div class="font-option" data-font="'Courier New', monospace">Monospace</div>
                                </div>
                            </div>

                            <div class="setting-group">
                                <h4>Layout</h4>
                                <div class="layout-selector">
                                    <div class="layout-option selected" data-layout="sidebar-right">
                                        <i class="fas fa-columns"></i>
                                        <div>Sidebar Right</div>
                                    </div>
                                    <div class="layout-option" data-layout="sidebar-left">
                                        <i class="fas fa-columns fa-flip-horizontal"></i>
                                        <div>Sidebar Left</div>
                                    </div>
                                    <div class="layout-option" data-layout="top-nav">
                                        <i class="fas fa-bars"></i>
                                        <div>Top Navigation</div>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-group">
                                <h4>Branding</h4>
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 500;">Logo URL</label>
                                    <input type="text" id="logoUrl" placeholder="https://example.com/logo.png" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 8px; font-weight: 500;">Business Name</label>
                                    <input type="text" id="businessName" placeholder="Your Business Name" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <footer class="footer">
                <p>POS Template Builder v1.0 â€¢ Drag, drop, and customize your Point of Sale interface</p>
            </footer>
        </main>
    </div>

    <!-- Export Modal -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Export Template</h2>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="export-options">
                    <div class="export-option" data-format="html">
                        <i class="fab fa-html5"></i>
                        <h4>HTML/CSS/JS</h4>
                        <p>Complete web package</p>
                    </div>
                    <div class="export-option" data-format="react">
                        <i class="fab fa-react"></i>
                        <h4>React Components</h4>
                        <p>React.js components</p>
                    </div>
                    <div class="export-option" data-format="vue">
                        <i class="fab fa-vuejs"></i>
                        <h4>Vue Components</h4>
                        <p>Vue.js components</p>
                    </div>
                    <div class="export-option" data-format="json">
                        <i class="fas fa-code"></i>
                        <h4>JSON Template</h4>
                        <p>Template configuration</p>
                    </div>
                </div>
                
                <div id="codePreview">
                    <h3 style="margin-bottom: 15px;">Code Preview</h3>
                    <div class="code-preview" id="codeOutput">
                        // Select an export format to preview code
                    </div>
                </div>
                
                <div style="margin-top: 25px; display: flex; gap: 15px;">
                    <button class="btn btn-primary" id="downloadBtn">
                        <i class="fas fa-download"></i> Download
                    </button>
                    <button class="btn btn-secondary" id="copyCodeBtn">
                        <i class="fas fa-copy"></i> Copy Code
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        const state = {
            components: [],
            template: {
                name: "My POS Template",
                primaryColor: "#2563eb",
                fontFamily: "Arial, sans-serif",
                layout: "sidebar-right",
                logoUrl: "",
                businessName: ""
            },
            history: [],
            currentHistoryIndex: -1
        };

        // DOM Elements
        const componentsList = document.getElementById('componentsList');
        const droppableArea = document.getElementById('droppableArea');
        const emptyState = document.getElementById('emptyState');
        const exportBtn = document.getElementById('exportBtn');
        const exportModal = document.getElementById('exportModal');
        const closeModal = document.getElementById('closeModal');
        const exportOptions = document.querySelectorAll('.export-option');
        const codeOutput = document.getElementById('codeOutput');
        const downloadBtn = document.getElementById('downloadBtn');
        const copyCodeBtn = document.getElementById('copyCodeBtn');
        const clearCanvasBtn = document.getElementById('clearCanvas');
        const undoBtn = document.getElementById('undoBtn');
        const saveTemplateBtn = document.getElementById('saveTemplate');
        const previewBtn = document.getElementById('previewBtn');
        const mobileToggle = document.getElementById('mobileToggle');
        const sidebar = document.getElementById('sidebar');
        const colorOptions = document.querySelectorAll('.color-option');
        const fontOptions = document.querySelectorAll('.font-option');
        const layoutOptions = document.querySelectorAll('.layout-option');
        const deviceBtns = document.querySelectorAll('.device-btn');
        const previewFrame = document.getElementById('previewFrame');

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeDragAndDrop();
            loadSampleData();
            setupEventListeners();
            updatePreview();
        });

        // Drag and Drop functionality
        function initializeDragAndDrop() {
            // Make components draggable
            document.querySelectorAll('.component-item[data-type]').forEach(item => {
                item.addEventListener('dragstart', dragStart);
            });

            // Droppable area events
            droppableArea.addEventListener('dragover', dragOver);
            droppableArea.addEventListener('dragleave', dragLeave);
            droppableArea.addEventListener('drop', drop);

            // Template click events
            document.querySelectorAll('.component-item[data-template]').forEach(item => {
                item.addEventListener('click', loadTemplate);
            });
        }

        function dragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.type);
            e.dataTransfer.effectAllowed = 'move';
        }

        function dragOver(e) {
            e.preventDefault();
            droppableArea.classList.add('drag-over');
        }

        function dragLeave() {
            droppableArea.classList.remove('drag-over');
        }

        function drop(e) {
            e.preventDefault();
            droppableArea.classList.remove('drag-over');
            
            const componentType = e.dataTransfer.getData('text/plain');
            if (componentType) {
                addComponentToCanvas(componentType);
                saveToHistory();
            }
        }

        function addComponentToCanvas(type) {
            const id = Date.now() + Math.random();
            const component = {
                id,
                type,
                settings: getDefaultSettings(type)
            };
            
            state.components.push(component);
            renderComponents();
            updatePreview();
        }

        function getDefaultSettings(type) {
            const defaults = {
                'product-grid': {
                    title: 'Products',
                    columns: 3,
                    showPrices: true,
                    showImages: true
                },
                'shopping-cart': {
                    title: 'Shopping Cart',
                    showTax: true,
                    showDiscount: true,
                    showTotal: true
                },
                'payment-methods': {
                    title: 'Payment',
                    methods: ['Cash', 'Credit Card', 'Mobile Pay']
                },
                'customer-info': {
                    title: 'Customer Information',
                    fields: ['Name', 'Email', 'Phone']
                },
                'receipt-preview': {
                    title: 'Receipt',
                    showLogo: true,
                    showFooter: true
                },
                'quick-actions': {
                    title: 'Quick Actions',
                    actions: ['Discount', 'Return', 'Hold', 'Print']
                }
            };
            
            return defaults[type] || {};
        }

        function renderComponents() {
            if (state.components.length === 0) {
                emptyState.style.display = 'flex';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Clear existing components
            const existingComponents = droppableArea.querySelectorAll('.canvas-component');
            existingComponents.forEach(comp => comp.remove());
            
            // Render each component
            state.components.forEach(component => {
                const componentEl = createComponentElement(component);
                droppableArea.appendChild(componentEl);
            });
        }

        function createComponentElement(component) {
            const div = document.createElement('div');
            div.className = 'canvas-component';
            div.dataset.id = component.id;
            
            let content = '';
            
            switch(component.type) {
                case 'product-grid':
                    content = `
                        <div class="component-header">
                            <h3>${component.settings.title}</h3>
                            <div class="component-actions">
                                <button class="component-action-btn" onclick="editComponent('${component.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="component-action-btn" onclick="removeComponent('${component.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="product-grid">
                            ${Array.from({length: 6}, (_, i) => `
                                <div class="product-item">
                                    <div class="product-image">
                                        <i class="fas fa-box"></i>
                                    </div>
                                    <h4>Product ${i + 1}</h4>
                                    <p>$${(Math.random() * 100).toFixed(2)}</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    break;
                    
                case 'shopping-cart':
                    content = `
                        <div class="component-header">
                            <h3>${component.settings.title}</h3>
                            <div class="component-actions">
                                <button class="component-action-btn" onclick="editComponent('${component.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="component-action-btn" onclick="removeComponent('${component.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="cart-preview">
                            ${Array.from({length: 3}, (_, i) => `
                                <div class="cart-item">
                                    <div>
                                        <strong>Item ${i + 1}</strong>
                                        <div style="font-size: 0.9rem; color: #6b7280;">Qty: ${i + 1}</div>
                                    </div>
                                    <div>$${((i + 1) * 25.99).toFixed(2)}</div>
                                </div>
                            `).join('')}
                            <div style="margin-top: 20px; padding-top: 15px; border-top: 2px solid var(--border-color);">
                                <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.1rem;">
                                    <span>Total:</span>
                                    <span>$129.97</span>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'payment-methods':
                    content = `
                        <div class="component-header">
                            <h3>${component.settings.title}</h3>
                            <div class="component-actions">
                                <button class="component-action-btn" onclick="editComponent('${component.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="component-action-btn" onclick="removeComponent('${component.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="payment-methods-preview">
                            ${['Cash', 'Credit Card', 'Mobile Pay', 'Gift Card'].map(method => `
                                <div class="payment-method">
                                    <i class="fas fa-${method === 'Cash' ? 'money-bill' : method === 'Credit Card' ? 'credit-card' : 'mobile-alt'}"></i>
                                    <span>${method}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    break;
                    
                default:
                    content = `
                        <div class="component-header">
                            <h3>${component.settings.title || component.type}</h3>
                            <div class="component-actions">
                                <button class="component-action-btn" onclick="editComponent('${component.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="component-action-btn" onclick="removeComponent('${component.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <p>${component.type} component preview</p>
                    `;
            }
            
            div.innerHTML = content;
            return div;
        }

        // Component actions
        window.editComponent = function(id) {
            const component = state.components.find(c => c.id == id);
            if (component) {
                alert(`Edit ${component.type} component\n\nSettings: ${JSON.stringify(component.settings, null, 2)}`);
                // In a real app, you would open a settings modal here
            }
        };

        window.removeComponent = function(id) {
            state.components = state.components.filter(c => c.id != id);
            saveToHistory();
            renderComponents();
            updatePreview();
        };

        // Template loading
        function loadTemplate(e) {
            const template = e.currentTarget.dataset.template;
            
            // Clear existing components
            state.components = [];
            
            // Load template components
            const templates = {
                retail: [
                    { type: 'product-grid', id: 1 },
                    { type: 'shopping-cart', id: 2 },
                    { type: 'payment-methods', id: 3 }
                ],
                restaurant: [
                    { type: 'product-grid', id: 1 },
                    { type: 'shopping-cart', id: 2 },
                    { type: 'customer-info', id: 3 },
                    { type: 'quick-actions', id: 4 }
                ],
                service: [
                    { type: 'customer-info', id: 1 },
                    { type: 'shopping-cart', id: 2 },
                    { type: 'payment-methods', id: 3 },
                    { type: 'receipt-preview', id: 4 }
                ]
            };
            
            if (templates[template]) {
                state.components = templates[template].map(item => ({
                    ...item,
                    settings: getDefaultSettings(item.type)
                }));
                
                saveToHistory();
                renderComponents();
                updatePreview();
                
                alert(`${template.charAt(0).toUpperCase() + template.slice(1)} template loaded!`);
            }
        }

        // History management
        function saveToHistory() {
            state.history = state.history.slice(0, state.currentHistoryIndex + 1);
            state.history.push(JSON.parse(JSON.stringify(state.components)));
            state.currentHistoryIndex++;
        }

        function undo() {
            if (state.currentHistoryIndex > 0) {
                state.currentHistoryIndex--;
                state.components = JSON.parse(JSON.stringify(state.history[state.currentHistoryIndex]));
                renderComponents();
                updatePreview();
            }
        }

        // Preview functionality
        function updatePreview() {
            const device = document.querySelector('.device-btn.active').dataset.device;
            const previewHTML = generatePreviewHTML(device);
            
            if (device === 'mobile') {
                previewFrame.innerHTML = `
                    <div class="mobile-preview">
                        ${previewHTML}
                    </div>
                `;
            } else {
                previewFrame.innerHTML = `
                    <div class="desktop-preview">
                        ${previewHTML}
                    </div>
                `;
            }
        }

        function generatePreviewHTML(device) {
            return `
                <style>
                    .pos-preview {
                        font-family: ${state.template.fontFamily};
                        color: #333;
                        padding: 20px;
                        background: white;
                        height: 100%;
                        overflow-y: auto;
                    }
                    .pos-header {
                        background: ${state.template.primaryColor};
                        color: white;
                        padding: 15px;
                        border-radius: 8px;
                        margin-bottom: 20px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }
                    .pos-grid {
                        display: grid;
                        grid-template-columns: ${device === 'mobile' ? '1fr' : '2fr 1fr'};
                        gap: 20px;
                    }
                    .product-grid-preview {
                        display: grid;
                        grid-template-columns: repeat(${device === 'mobile' ? '2' : '3'}, 1fr);
                        gap: 15px;
                    }
                    .cart-preview {
                        background: #f9fafb;
                        padding: 20px;
                        border-radius: 8px;
                    }
                </style>
                <div class="pos-preview">
                    <div class="pos-header">
                        <h2>${state.template.businessName || 'My Business'}</h2>
                        <div>POS System</div>
                    </div>
                    
                    ${state.components.length > 0 ? `
                        <div class="pos-grid">
                            <div>
                                ${state.components.map(comp => `
                                    <div style="margin-bottom: 20px; padding: 15px; border: 1px solid #e5e7eb; border-radius: 8px;">
                                        <h3 style="color: ${state.template.primaryColor}; margin-bottom: 10px;">${comp.settings.title || comp.type}</h3>
                                        <div style="color: #6b7280; font-size: 0.9rem;">
                                            ${comp.type} component - Ready for use
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="cart-preview">
                                <h3 style="color: ${state.template.primaryColor}; margin-bottom: 15px;">Order Summary</h3>
                                <div style="margin-bottom: 10px;">
                                    <div style="display: flex; justify-content: space-between;">
                                        <span>Subtotal:</span>
                                        <span>$129.97</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span>Tax:</span>
                                        <span>$10.40</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; font-weight: bold; border-top: 2px solid #e5e7eb; margin-top: 10px; padding-top: 10px;">
                                        <span>Total:</span>
                                        <span>$140.37</span>
                                    </div>
                                </div>
                                <button style="background: ${state.template.primaryColor}; color: white; border: none; padding: 12px; width: 100%; border-radius: 6px; font-weight: bold; cursor: pointer;">
                                    Complete Sale
                                </button>
                            </div>
                        </div>
                    ` : `
                        <div style="text-align: center; padding: 40px; color: #9ca3af;">
                            <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                            <h3>No components added yet</h3>
                            <p>Drag components from the sidebar to build your POS</p>
                        </div>
                    `}
                </div>
            `;
        }

        // Export functionality
        function generateExportCode(format) {
            const templateData = {
                ...state.template,
                components: state.components,
                createdAt: new Date().toISOString()
            };
            
            switch(format) {
                case 'html':
                    return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${templateData.businessName || 'POS System'}</title>
    <style>
        :root {
            --primary-color: ${templateData.primaryColor};
            --font-family: ${templateData.fontFamily};
        }
        
        body {
            font-family: var(--font-family);
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .pos-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .pos-header {
            background: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        /* Add your POS styles here */
    </style>
</head>
<body>
    <div class="pos-container">
        <header class="pos-header">
            <h1>${templateData.businessName || 'Point of Sale System'}</h1>
        </header>
        
        <main>
            <!-- POS components will be rendered here -->
            <div id="pos-components"></div>
        </main>
    </div>
    
    <script>
        const templateData = ${JSON.stringify(templateData, null, 2)};
        
        // Initialize POS system
        console.log('POS Template loaded:', templateData);
        
        // Add your POS logic here
    <\/script>
</body>
</html>`;
                    
                case 'react':
                    return `import React from 'react';
import './POS.css';

const POSSystem = () => {
    const template = ${JSON.stringify(templateData, null, 2)};
    
    return (
        <div className="pos-container" style={{ fontFamily: template.fontFamily }}>
            <header className="pos-header" style={{ backgroundColor: template.primaryColor }}>
                <h1>{template.businessName || 'Point of Sale System'}</h1>
            </header>
            
            <main className="pos-content">
                {template.components.map((component, index) => (
                    <div key={index} className="pos-component">
                        <h3 style={{ color: template.primaryColor }}>
                            {component.settings?.title || component.type}
                        </h3>
                        <div className="component-content">
                            {/* Render component based on type */}
                            {renderComponent(component)}
                        </div>
                    </div>
                ))}
            </main>
            
            <footer className="pos-footer">
                <button style={{ backgroundColor: template.primaryColor }}>
                    Complete Sale
                </button>
            </footer>
        </div>
    );
};

const renderComponent = (component) => {
    switch(component.type) {
        case 'product-grid':
            return <div>Product Grid Component</div>;
        case 'shopping-cart':
            return <div>Shopping Cart Component</div>;
        default:
            return <div>{component.type} Component</div>;
    }
};

export default POSSystem;`;
                    
                case 'vue':
                    return `<template>
    <div class="pos-container" :style="{ fontFamily: template.fontFamily }">
        <header class="pos-header" :style="{ backgroundColor: template.primaryColor }">
            <h1>{{ template.businessName || 'Point of Sale System' }}</h1>
        </header>
        
        <main class="pos-content">
            <div v-for="(component, index) in template.components" :key="index" class="pos-component">
                <h3 :style="{ color: template.primaryColor }">
                    {{ component.settings?.title || component.type }}
                </h3>
                <div class="component-content">
                    <component :is="getComponentType(component.type)" :data="component" />
                </div>
            </div>
        </main>
        
        <footer class="pos-footer">
            <button :style="{ backgroundColor: template.primaryColor }">
                Complete Sale
            </button>
        </footer>
    </div>
</template>

<script>
export default {
    name: 'POSSystem',
    data() {
        return {
            template: ${JSON.stringify(templateData, null, 2)}
        };
    },
    methods: {
        getComponentType(type) {
            switch(type) {
                case 'product-grid': return 'ProductGrid';
                case 'shopping-cart': return 'ShoppingCart';
                default: return 'DefaultComponent';
            }
        }
    }
};
<\/script>

<style scoped>
.pos-container {
    max-width: 1200px;
    margin: 0 auto;
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    overflow: hidden;
}

.pos-header {
    color: white;
    padding: 20px;
    text-align: center;
}

/* Add your styles here */
</style>`;
                    
                case 'json':
                    return JSON.stringify(templateData, null, 2);
                    
                default:
                    return 'Select an export format to see code preview';
            }
        }

        function downloadCode(filename, content) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Event Listeners
        function setupEventListeners() {
            // Export modal
            exportBtn.addEventListener('click', () => {
                exportModal.classList.add('active');
            });
            
            closeModal.addEventListener('click', () => {
                exportModal.classList.remove('active');
            });
            
            exportModal.addEventListener('click', (e) => {
                if (e.target === exportModal) {
                    exportModal.classList.remove('active');
                }
            });
            
            // Export options
            exportOptions.forEach(option => {
                option.addEventListener('click', () => {
                    exportOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    
                    const format = option.dataset.format;
                    const code = generateExportCode(format);
                    codeOutput.textContent = code;
                });
            });
            
            // Download button
            downloadBtn.addEventListener('click', () => {
                const selectedFormat = document.querySelector('.export-option.selected')?.dataset.format;
                if (selectedFormat) {
                    const code = generateExportCode(selectedFormat);
                    const filename = `pos-template.${selectedFormat === 'json' ? 'json' : selectedFormat === 'react' ? 'jsx' : 'html'}`;
                    downloadCode(filename, code);
                    alert(`Template downloaded as ${filename}`);
                } else {
                    alert('Please select an export format first');
                }
            });
            
            // Copy code button
            copyCodeBtn.addEventListener('click', () => {
                const code = codeOutput.textContent;
                navigator.clipboard.writeText(code).then(() => {
                    alert('Code copied to clipboard!');
                });
            });
            
            // Clear canvas
            clearCanvasBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to clear the canvas?')) {
                    state.components = [];
                    saveToHistory();
                    renderComponents();
                    updatePreview();
                }
            });
            
            // Undo
            undoBtn.addEventListener('click', undo);
            
            // Save template
            saveTemplateBtn.addEventListener('click', () => {
                const templateData = {
                    ...state.template,
                    components: state.components,
                    savedAt: new Date().toISOString()
                };
                
                localStorage.setItem('posTemplate', JSON.stringify(templateData));
                alert('Template saved locally!');
            });
            
            // Preview
            previewBtn.addEventListener('click', () => {
                updatePreview();
                alert('Preview updated!');
            });
            
            // Mobile toggle
            mobileToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
            });
            
            // Color picker
            colorOptions.forEach(option => {
                option.addEventListener('click', () => {
                    colorOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    state.template.primaryColor = option.dataset.color;
                    updatePreview();
                });
            });
            
            // Font selector
            fontOptions.forEach(option => {
                option.addEventListener('click', () => {
                    fontOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    state.template.fontFamily = option.dataset.font;
                    updatePreview();
                });
            });
            
            // Layout selector
            layoutOptions.forEach(option => {
                option.addEventListener('click', () => {
                    layoutOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    state.template.layout = option.dataset.layout;
                    updatePreview();
                });
            });
            
            // Device selector
            deviceBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    deviceBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    updatePreview();
                });
            });
            
            // Business name and logo
            document.getElementById('businessName').addEventListener('input', (e) => {
                state.template.businessName = e.target.value;
                updatePreview();
            });
            
            document.getElementById('logoUrl').addEventListener('input', (e) => {
                state.template.logoUrl = e.target.value;
                updatePreview();
            });
        }

        // Load sample data
        function loadSampleData() {
            // Load saved template if exists
            const saved = localStorage.getItem('posTemplate');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    state.template = { ...state.template, ...parsed };
                    state.components = parsed.components || [];
                    
                    // Update form fields
                    document.getElementById('businessName').value = state.template.businessName || '';
                    document.getElementById('logoUrl').value = state.template.logoUrl || '';
                    
                    // Update UI
                    colorOptions.forEach(opt => {
                        if (opt.dataset.color === state.template.primaryColor) {
                            opt.classList.add('selected');
                        }
                    });
                    
                    fontOptions.forEach(opt => {
                        if (opt.dataset.font === state.template.fontFamily) {
                            opt.classList.add('selected');
                        }
                    });
                    
                    layoutOptions.forEach(opt => {
                        if (opt.dataset.layout === state.template.layout) {
                            opt.classList.add('selected');
                        }
                    });
                    
                    saveToHistory();
                    renderComponents();
                } catch (e) {
                    console.error('Error loading saved template:', e);
                }
            }
        }
    </script>
</body>
</html>
