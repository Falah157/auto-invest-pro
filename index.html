<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Islamic Parenting Assistant</title>
    <style>
        :root {
            --neon-pink: #ff00ff;
            --neon-blue: #00ffff;
            --neon-green: #00ff00;
            --neon-yellow: #ffff00;
            --neon-orange: #ff7700;
            --neon-purple: #aa00ff;
            --dark-bg: #0a0a1a;
            --darker-bg: #050510;
            --card-bg: rgba(10, 10, 26, 0.8);
            --text-glow: rgba(255, 255, 255, 0.9);
            --neon-glow: 0 0 10px, 0 0 20px, 0 0 30px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Orbitron', sans-serif;
        }

        body {
            background-color: var(--dark-bg);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 0, 255, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(0, 255, 255, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 50% 50%, rgba(0, 255, 0, 0.03) 0%, transparent 30%);
            color: var(--text-glow);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* 3D Header with Neon Effect */
        .header {
            background: linear-gradient(135deg, var(--darker-bg) 0%, rgba(20, 20, 40, 0.9) 100%);
            padding: 20px 20px;
            text-align: center;
            border-bottom: 3px solid var(--neon-pink);
            box-shadow: 
                inset 0 0 50px rgba(255, 0, 255, 0.1),
                0 0 50px rgba(255, 0, 255, 0.2);
            position: relative;
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, var(--neon-pink), var(--neon-blue), var(--neon-green));
            z-index: -1;
            filter: blur(20px);
            opacity: 0.3;
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-blue), var(--neon-green));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 
                0 0 15px var(--neon-pink),
                0 0 25px var(--neon-blue),
                0 0 35px var(--neon-green);
            margin-bottom: 5px;
            animation: glow 2s ease-in-out infinite alternate;
            letter-spacing: 1px;
        }

        .bismillah {
            font-size: 1.5em;
            color: var(--neon-yellow);
            text-shadow: 0 0 10px var(--neon-yellow);
            margin: 10px 0;
            animation: pulse 3s infinite;
        }

        /* User Info Bar */
        .user-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--neon-pink), var(--neon-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            box-shadow: 0 0 10px var(--neon-pink);
        }

        .quick-actions {
            display: flex;
            gap: 10px;
        }

        /* 3D Navigation Tabs */
        .tabs-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            padding: 0 20px;
            transform-style: preserve-3d;
            perspective: 500px;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid var(--neon-blue);
            color: var(--neon-blue);
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.3s ease;
            text-shadow: 0 0 5px var(--neon-blue);
            transform: translateZ(0);
            position: relative;
            overflow: hidden;
            min-width: 100px;
        }

        .tab-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .tab-btn:hover::before {
            left: 100%;
        }

        .tab-btn:hover, .tab-btn.active {
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 
                0 0 20px var(--neon-blue),
                inset 0 0 20px rgba(0, 255, 255, 0.2);
            transform: translateZ(20px) scale(1.05);
            border-color: var(--neon-green);
            color: var(--neon-green);
            text-shadow: 0 0 10px var(--neon-green);
        }

        /* 3D Card Layout */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            padding: 20px;
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .card {
            background: var(--card-bg);
            border: 2px solid;
            border-image: linear-gradient(45deg, var(--neon-pink), var(--neon-blue)) 1;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.5),
                inset 0 0 50px rgba(255, 0, 255, 0.05);
            transition: all 0.4s ease;
            position: relative;
            transform-style: preserve-3d;
            transform: translateZ(0);
            backdrop-filter: blur(10px);
        }

        .card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--neon-pink), var(--neon-blue), var(--neon-green));
            border-radius: 17px;
            z-index: -1;
            filter: blur(10px);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .card:hover::before {
            opacity: 0.5;
        }

        .card:hover {
            transform: translateZ(30px) rotateX(5deg);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.7),
                0 0 50px var(--neon-pink);
        }

        .card-title {
            color: var(--neon-blue);
            font-size: 1.5em;
            margin-bottom: 15px;
            text-shadow: 0 0 10px var(--neon-blue);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title::after {
            content: '';
            flex: 1;
            height: 3px;
            background: linear-gradient(90deg, var(--neon-blue), transparent);
            border-radius: 2px;
        }

        /* Prayer Tracker */
        .prayer-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .prayer-card {
            background: rgba(0, 20, 40, 0.7);
            border: 2px solid var(--neon-green);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .prayer-card.checked {
            background: rgba(0, 40, 20, 0.7);
            box-shadow: 0 0 20px var(--neon-green);
            transform: scale(1.05);
        }

        .prayer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px var(--neon-green);
        }

        /* Progress Bars */
        .progress-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid var(--neon-pink);
        }

        .progress-bar {
            height: 20px;
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-blue));
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 2s infinite;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            color: var(--neon-blue);
            margin-bottom: 5px;
            text-shadow: 0 0 5px var(--neon-blue);
            font-size: 1em;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid var(--neon-green);
            border-radius: 8px;
            color: var(--text-glow);
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            box-shadow: 0 0 20px var(--neon-green);
            border-color: var(--neon-yellow);
        }

        /* Buttons */
        .btn {
            background: linear-gradient(45deg, var(--neon-pink), var(--neon-blue));
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-shadow: 0 0 10px white;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 10px 30px rgba(255, 0, 255, 0.5),
                0 0 50px var(--neon-pink);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9em;
        }

        .btn-icon {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        /* Task List Styling */
        .task-list {
            margin-top: 15px;
        }

        .task-item {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            border-color: var(--neon-green);
            transform: translateX(5px);
        }

        .task-item.completed {
            opacity: 0.7;
            border-color: var(--neon-green);
        }

        .task-info {
            flex: 1;
            margin-left: 10px;
        }

        .task-title {
            color: var(--text-glow);
            font-weight: bold;
            margin-bottom: 5px;
        }

        .task-meta {
            font-size: 0.8em;
            color: var(--neon-blue);
            display: flex;
            gap: 15px;
        }

        .task-priority {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .priority-high {
            background: rgba(255, 0, 0, 0.2);
            color: #ff5555;
            border: 1px solid #ff5555;
        }

        .priority-medium {
            background: rgba(255, 165, 0, 0.2);
            color: #ffaa00;
            border: 1px solid #ffaa00;
        }

        .priority-low {
            background: rgba(0, 255, 0, 0.2);
            color: #55ff55;
            border: 1px solid #55ff55;
        }

        /* Homework Grid */
        .homework-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .homework-card {
            background: rgba(0, 20, 40, 0.7);
            border: 2px solid var(--neon-purple);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .homework-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px var(--neon-purple);
        }

        .subject-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .subject-math { background: rgba(255, 0, 255, 0.2); color: var(--neon-pink); border: 1px solid var(--neon-pink); }
        .subject-science { background: rgba(0, 255, 255, 0.2); color: var(--neon-blue); border: 1px solid var(--neon-blue); }
        .subject-quran { background: rgba(0, 255, 0, 0.2); color: var(--neon-green); border: 1px solid var(--neon-green); }
        .subject-arabic { background: rgba(255, 255, 0, 0.2); color: var(--neon-yellow); border: 1px solid var(--neon-yellow); }

        /* Sharing Permissions */
        .permissions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .permission-item {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .permission-item.active {
            background: rgba(0, 255, 0, 0.2);
            border-color: var(--neon-green);
            box-shadow: 0 0 10px var(--neon-green);
        }

        /* Table Styling */
        .table-container {
            overflow-x: auto;
            margin-top: 15px;
            border: 2px solid var(--neon-blue);
            border-radius: 10px;
            padding: 10px;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        th {
            background: rgba(0, 100, 255, 0.2);
            color: var(--neon-blue);
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue);
        }

        td {
            padding: 12px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        tr:hover td {
            background: rgba(0, 255, 255, 0.1);
            text-shadow: 0 0 5px white;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            background: rgba(0, 20, 40, 0.7);
            border: 2px solid var(--neon-yellow);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            color: var(--neon-yellow);
            text-shadow: 0 0 20px var(--neon-yellow);
            margin: 5px 0;
        }

        .stat-label {
            color: var(--neon-blue);
            font-size: 0.9em;
        }

        /* Animations */
        @keyframes glow {
            0% {
                text-shadow: 
                    0 0 10px var(--neon-pink),
                    0 0 20px var(--neon-blue),
                    0 0 30px var(--neon-green);
            }
            100% {
                text-shadow: 
                    0 0 20px var(--neon-pink),
                    0 0 40px var(--neon-blue),
                    0 0 60px var(--neon-green);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                text-shadow: 0 0 10px var(--neon-yellow);
            }
            50% {
                opacity: 0.8;
                text-shadow: 0 0 20px var(--neon-yellow);
            }
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-20px) rotate(180deg);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Floating Elements */
        .floating-element {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, var(--neon-pink), var(--neon-blue));
            border-radius: 50%;
            animation: float 20s infinite linear;
            opacity: 0.1;
            z-index: -1;
        }

        /* Modal Styling */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--card-bg);
            border: 3px solid var(--neon-pink);
            border-radius: 15px;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalAppear 0.3s ease;
            box-shadow: 0 0 50px var(--neon-pink);
        }

        @keyframes modalAppear {
            from {
                transform: scale(0.5) translateY(-100px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--neon-pink);
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            text-shadow: 0 0 20px var(--neon-pink);
            transform: rotate(90deg);
        }

        /* Notification Container */
        #notificationContainer {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .notification {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid var(--neon-green);
            color: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            animation: slideIn 0.3s ease;
            max-width: 300px;
            word-wrap: break-word;
            box-shadow: 0 0 20px var(--neon-green);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
                padding: 10px;
            }
            
            .tabs-container {
                flex-wrap: wrap;
                gap: 5px;
            }
            
            .tab-btn {
                padding: 8px 12px;
                font-size: 0.8em;
                min-width: auto;
                flex: 1;
            }
            
            .prayer-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .bismillah {
                font-size: 1.2em;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .homework-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .prayer-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 1.5em;
            }
            
            .tabs-container {
                flex-direction: column;
            }
            
            .tab-btn {
                width: 100%;
            }
        }

        /* Sound Indicator */
        .sound-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            background: var(--neon-green);
            border-radius: 50%;
            margin-left: 5px;
            animation: pulse 1s infinite;
        }

        .sound-indicator.muted {
            background: #666;
            animation: none;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--neon-blue);
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 2px;
            background: var(--neon-blue);
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background: rgba(0, 255, 0, 0.2);
            border-color: var(--neon-green);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(22px);
            background: var(--neon-green);
        }

        /* Quran Ayah Display */
        .ayah-display {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--neon-yellow);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            font-size: 1.2em;
            line-height: 1.6;
        }

        .ayah-arabic {
            font-size: 1.5em;
            color: var(--neon-yellow);
            margin-bottom: 10px;
            direction: rtl;
        }

        .ayah-translation {
            color: var(--text-glow);
            font-style: italic;
        }

        /* Expense Categories */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .category-item {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-item:hover {
            transform: scale(1.05);
        }

        .category-food { border: 2px solid var(--neon-pink); }
        .category-education { border: 2px solid var(--neon-blue); }
        .category-health { border: 2px solid var(--neon-green); }
        .category-transport { border: 2px solid var(--neon-yellow); }
        .category-charity { border: 2px solid var(--neon-purple); }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--neon-blue);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--neon-blue);
        }

        .empty-state-icon {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <!-- Floating Background Elements -->
    <div class="floating-element"></div>
    <div class="floating-element"></div>
    <div class="floating-element"></div>
    <div class="floating-element"></div>

    <!-- Header -->
    <header class="header">
        <h1>‚ú® NEON PARENTING ASSISTANT ‚ú®</h1>
        <div class="bismillah">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸíŸÖŸê</div>
        <p style="color: var(--neon-green); text-shadow: 0 0 10px var(--neon-green); font-size: 0.9em;">
            Smart Islamic Family Management System
        </p>
    </header>

    <!-- User Bar -->
    <div class="user-bar">
        <div class="user-info">
            <div class="user-avatar">üë©</div>
            <div>
                <div style="font-weight: bold; color: var(--neon-pink);">Mom (Admin)</div>
                <div style="font-size: 0.8em; color: var(--neon-blue);">Family: 4 members</div>
            </div>
        </div>
        <div class="quick-actions">
            <button class="btn btn-sm btn-icon" onclick="openAddTaskModal()">
                <span>‚ûï</span> Task
            </button>
            <button class="btn btn-sm btn-icon" onclick="openAddHomeworkModal()">
                <span>üìö</span> Homework
            </button>
            <button class="btn btn-sm btn-icon" onclick="openShareModal()">
                <span>üë•</span> Share
            </button>
            <button class="btn btn-sm" onclick="toggleSound()" id="soundToggle">
                <span>üîä</span>
                <span class="sound-indicator" id="soundIndicator"></span>
            </button>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="tabs-container">
        <button class="tab-btn active" onclick="showTab('dashboard')">üè† Dashboard</button>
        <button class="tab-btn" onclick="showTab('tasks')">‚úÖ Tasks</button>
        <button class="tab-btn" onclick="showTab('homework')">üìö Homework</button>
        <button class="tab-btn" onclick="showTab('prayer')">üïå Prayer</button>
        <button class="tab-btn" onclick="showTab('schedule')">üìÖ Schedule</button>
        <button class="tab-btn" onclick="showTab('quran')">üìñ Quran</button>
        <button class="tab-btn" onclick="showTab('financial')">üí∞ Finance</button>
        <button class="tab-btn" onclick="showTab('health')">üè• Health</button>
        <button class="tab-btn" onclick="showTab('sharing')">üë• Sharing</button>
        <button class="tab-btn" onclick="showTab('settings')">‚öôÔ∏è Settings</button>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- DASHBOARD TAB -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard">
                <!-- Quick Stats -->
                <div class="card">
                    <h2 class="card-title">üìà Family Overview</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Children</div>
                            <div class="stat-number" id="totalChildren">2</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Prayer Streak</div>
                            <div class="stat-number" id="prayerStreak">7</div>
                            <div class="stat-label">days</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Pending Tasks</div>
                            <div class="stat-number" id="pendingTasks">5</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Weekly Budget</div>
                            <div class="stat-number" id="weeklyBudget">500</div>
                            <div class="stat-label">MVR</div>
                        </div>
                    </div>
                </div>

                <!-- Today's Prayer Status -->
<div class="card">
    <h2 class="card-title">üïå Today's Prayers</h2>
    <p style="color: var(--neon-blue); margin-bottom: 15px; font-size: 0.9em;">
        Click each prayer after you complete it
    </p>
    
    <div class="prayer-grid">
        <div class="prayer-card" onclick="togglePrayer('fajr')" id="fajrCard">
            <div style="font-weight: bold; font-size: 1.2em;">üåÖ Fajr</div>
            <div class="prayer-status" style="margin-top: 10px; font-size: 1.5em;">‚è∞</div>
            <div style="font-size: 0.8em; color: var(--neon-green); margin-top: 10px;">
                Click when done
            </div>
        </div>
        
        <div class="prayer-card" onclick="togglePrayer('dhuhr')" id="dhuhrCard">
            <div style="font-weight: bold; font-size: 1.2em;">‚òÄÔ∏è Dhuhr</div>
            <div class="prayer-status" style="margin-top: 10px; font-size: 1.5em;">‚è∞</div>
            <div style="font-size: 0.8em; color: var(--neon-green); margin-top: 10px;">
                Click when done
            </div>
        </div>
        
        <div class="prayer-card" onclick="togglePrayer('asr')" id="asrCard">
            <div style="font-weight: bold; font-size: 1.2em;">‚õÖ Asr</div>
            <div class="prayer-status" style="margin-top: 10px; font-size: 1.5em;">‚è∞</div>
            <div style="font-size: 0.8em; color: var(--neon-green); margin-top: 10px;">
                Click when done
            </div>
        </div>
        
        <div class="prayer-card" onclick="togglePrayer('maghrib')" id="maghribCard">
            <div style="font-weight: bold; font-size: 1.2em;">üåá Maghrib</div>
            <div class="prayer-status" style="margin-top: 10px; font-size: 1.5em;">‚è∞</div>
            <div style="font-size: 0.8em; color: var(--neon-green); margin-top: 10px;">
                Click when done
            </div>
        </div>
        
        <div class="prayer-card" onclick="togglePrayer('isha')" id="ishaCard">
            <div style="font-weight: bold; font-size: 1.2em;">üåô Isha</div>
            <div class="prayer-status" style="margin-top: 10px; font-size: 1.5em;">‚è∞</div>
            <div style="font-size: 0.8em; color: var(--neon-green); margin-top: 10px;">
                Click when done
            </div>
        </div>
    </div>
    
    <div class="progress-container" style="margin-top: 15px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span style="color: var(--neon-green);">Prayer Completion</span>
            <span id="prayerPercentage">0%</span>
        </div>
        <div class="progress-bar" style="width: 0%;" id="prayerProgressBar"></div>
    </div>
</div>

                <!-- Today's Tasks -->
                <div class="card">
                    <h2 class="card-title">‚úÖ Today's Tasks</h2>
                    <div id="todayTasksList" class="task-list">
                        <!-- Tasks will be loaded here -->
                    </div>
                    <button class="btn" onclick="openAddTaskModal()" style="margin-top: 15px; width: 100%;">
                        ‚ûï Add New Task
                    </button>
                </div>

                <!-- Upcoming Homework -->
                <div class="card">
                    <h2 class="card-title">üìö Due Homework</h2>
                    <div id="dueHomeworkList">
                        <!-- Homework will be loaded here -->
                    </div>
                    <button class="btn" onclick="openAddHomeworkModal()" style="margin-top: 15px; width: 100%;">
                        ‚ûï Assign Homework
                    </button>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <h2 class="card-title">‚ö° Quick Actions</h2>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 15px;">
                        <button class="btn btn-icon" onclick="addChild()">
                            <span>üë∂</span> Add Child
                        </button>
                        <button class="btn btn-icon" onclick="openAddExpenseModal()">
                            <span>üí∞</span> Log Expense
                        </button>
                        <button class="btn btn-icon" onclick="openAddQuranSessionModal()">
                            <span>üìñ</span> Quran Session
                        </button>
                        <button class="btn btn-icon" onclick="openAddHealthRecordModal()">
                            <span>üè•</span> Health Record
                        </button>
                        <button class="btn btn-icon" onclick="generateReport()">
                            <span>üìä</span> Generate Report
                        </button>
                        <button class="btn btn-icon" onclick="backupData()">
                            <span>üíæ</span> Backup Data
                        </button>
                    </div>
                </div>

                <!-- Islamic Reminder -->
                <div class="card" style="grid-column: 1 / -1;">
                    <h2 class="card-title">üìø Daily Reminder</h2>
                    <div class="ayah-display">
                        <div class="ayah-arabic" id="ayahArabic">
                            ÿ•ŸêŸÜŸéŸëŸÖŸéÿß ŸäŸèŸàŸéŸÅŸéŸëŸâ ÿßŸÑÿµŸéŸëÿßÿ®Ÿêÿ±ŸèŸàŸÜŸé ÿ£Ÿéÿ¨Ÿíÿ±ŸéŸáŸèŸÖ ÿ®Ÿêÿ∫ŸéŸäŸíÿ±Ÿê ÿ≠Ÿêÿ≥Ÿéÿßÿ®Ÿç
                        </div>
                        <div class="ayah-translation" id="ayahTranslation">
                            "Indeed, the patient will be given their reward without account."
                        </div>
                        <div style="margin-top: 10px; color: var(--neon-blue); font-size: 0.9em;">
                            ‚Äî Quran 39:10
                        </div>
                    </div>
                    <button class="btn" onclick="getNewReminder()" style="width: 100%;">
                        üîÑ New Reminder
                    </button>
                </div>
            </div>
        </div>

        <!-- TASKS TAB -->
        <div id="tasks" class="tab-content">
            <div class="dashboard">
                <div class="card" style="grid-column: 1 / -1;">
                    <h2 class="card-title">‚úÖ Task Manager</h2>
                    
                    <!-- Task Filters -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="btn btn-sm active" onclick="filterTasks('all')">All Tasks</button>
                        <button class="btn btn-sm" onclick="filterTasks('today')">Today</button>
                        <button class="btn btn-sm" onclick="filterTasks('pending')">Pending</button>
                        <button class="btn btn-sm" onclick="filterTasks('completed')">Completed</button>
                        <button class="btn btn-sm" onclick="filterTasks('high')">High Priority</button>
                        <select class="form-select" style="flex: 1; max-width: 200px;" onchange="filterByCategory(this.value)">
                            <option value="">All Categories</option>
                            <option value="family">Family</option>
                            <option value="school">School</option>
                            <option value="islamic">Islamic</option>
                            <option value="work">Work</option>
                        </select>
                    </div>

                    <!-- Tasks List -->
                    <div id="tasksList" class="task-list">
                        <!-- Tasks will be loaded here -->
                    </div>

                    <!-- Add Task Button -->
                    <button class="btn" onclick="openAddTaskModal()" style="margin-top: 20px; width: 100%;">
                        ‚ûï Add New Task
                    </button>
                </div>
            </div>
        </div>

        <!-- HOMEWORK TAB -->
        <div id="homework" class="tab-content">
            <div class="dashboard">
                <div class="card" style="grid-column: 1 / -1;">
                    <h2 class="card-title">üìö Homework Manager</h2>
                    
                    <!-- Homework Filters -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="btn btn-sm active" onclick="filterHomework('all')">All Homework</button>
                        <button class="btn btn-sm" onclick="filterHomework('pending')">Pending</button>
                        <button class="btn btn-sm" onclick="filterHomework('completed')">Completed</button>
                        <button class="btn btn-sm" onclick="filterHomework('overdue')">Overdue</button>
                        <select class="form-select" style="flex: 1; max-width: 150px;" onchange="filterHomeworkBySubject(this.value)">
                            <option value="">All Subjects</option>
                            <option value="math">Math</option>
                            <option value="science">Science</option>
                            <option value="quran">Quran</option>
                            <option value="arabic">Arabic</option>
                        </select>
                    </div>

                    <!-- Homework Grid -->
                    <div id="homeworkGrid" class="homework-grid">
                        <!-- Homework cards will be loaded here -->
                    </div>

                    <!-- Add Homework Button -->
                    <button class="btn" onclick="openAddHomeworkModal()" style="margin-top: 20px; width: 100%;">
                        ‚ûï Assign New Homework
                    </button>
                </div>
            </div>
        </div>

        <!-- PRAYER TAB -->
        <div id="prayer" class="tab-content">
            <div class="dashboard">
                <div class="card" style="grid-column: 1 / -1;">
                    <h2 class="card-title">üïå Family Prayer Tracker</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                        <!-- Family Members Prayer Status -->
                        <div>
                            <h3 style="color: var(--neon-blue); margin-bottom: 15px;">Family Members Status</h3>
                            <div id="familyPrayerStatus">
                                <!-- Members status will be loaded here -->
                            </div>
                        </div>

                        <!-- Weekly Prayer Chart -->
                        <div>
                            <h3 style="color: var(--neon-green); margin-bottom: 15px;">This Week's Progress</h3>
                            <div id="weeklyPrayerChart">
                                <!-- Chart will be generated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Statistics -->
                    <div style="margin-top: 30px;">
                        <h3 style="color: var(--neon-pink); margin-bottom: 15px;">Monthly Statistics</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Fajr Attendance</div>
                                <div class="stat-number" id="fajrStats">85%</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Total Prayers</div>
                                <div class="stat-number" id="totalPrayers">350</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Best Performer</div>
                                <div class="stat-number" id="bestPerformer">Yusuf</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Current Streak</div>
                                <div class="stat-number" id="currentStreak">7</div>
                                <div class="stat-label">days</div>
                            </div>
                        </div>
                    </div>

                    <!-- Prayer Time Settings -->
                    <div style="margin-top: 30px;">
                        <h3 style="color: var(--neon-yellow); margin-bottom: 15px;">Prayer Time Settings</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div class="form-group">
                                <label class="form-label">Calculation Method</label>
                                <select class="form-select" id="prayerMethod">
                                    <option value="muslim_world_league">Muslim World League</option>
                                    <option value="egyptian">Egyptian General Authority</option>
                                    <option value="karachi">University of Islamic Sciences, Karachi</option>
                                    <option value="umm_al_qura">Umm al-Qura University, Makkah</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Location</label>
                                <input type="text" class="form-input" id="prayerLocation" placeholder="City, Country" value="Mal√©, Maldives">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Notifications</label>
                                <label class="toggle-switch" style="display: block; margin-top: 5px;">
                                    <input type="checkbox" id="prayerNotifications" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <button class="btn" onclick="updatePrayerTimes()" style="margin-top: 15px;">
                            üîÑ Update Prayer Times
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCHEDULE TAB -->
        <div id="schedule" class="tab-content">
            <div class="dashboard">
                <div class="card" style="grid-column: 1 / -1;">
                    <h2 class="card-title">üìÖ Family Schedule</h2>
                    
                    <!-- Weekly Schedule -->
                    <div style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap;">
                            <h3 style="color: var(--neon-blue);">Weekly Schedule</h3>
                            <div>
                                <button class="btn btn-sm" onclick="prevWeek()">‚óÄ Previous</button>
                                <span style="margin: 0 10px; color: var(--neon-yellow);" id="currentWeek">Week 48</span>
                                <button class="btn btn-sm" onclick="nextWeek()">Next ‚ñ∂</button>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table id="scheduleTable">
                                <!-- Schedule will be loaded here -->
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- QURAN TAB -->
        <div id="quran" class="tab-content">
            <div class="dashboard">
                <div class="card" style="grid-column: 1 / -1;">
                    <h2 class="card-title">üìñ Quran Progress Tracker</h2>
                    
                    <!-- Overall Progress -->
                    <div style="margin-top: 20px;">
                        <h3 style="color: var(--neon-blue); margin-bottom: 15px;">Overall Progress</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Memorized Pages</div>
                                <div class="stat-number" id="memorizedPages">45</div>
                                <div class="stat-label">out of 604</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Current Juz</div>
                                <div class="stat-number" id="currentJuz">3</div>
                                <div class="stat-label">Juz Amma</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Daily Revision</div>
                                <div class="stat-number" id="dailyRevision">30</div>
                                <div class="stat-label">minutes</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Streak</div>
                                <div class="stat-number" id="quranStreak">14</div>
                                <div class="stat-label">days</div>
                            </div>
                        </div>
                    </div>

                    <!-- Memorization Progress -->
                    <div style="margin-top: 30px;">
                        <h3 style="color: var(--neon-green); margin-bottom: 15px;">Memorization Progress</h3>
                        <div id="quranProgressGrid">
                            <!-- Progress by Surah will be loaded here -->
                        </div>
                    </div>

                    <!-- Add Quran Session -->
                    <div style="margin-top: 30px;">
                        <h3 style="color: var(--neon-pink); margin-bottom: 15px;">Add Quran Session</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div class="form-group">
                                <label class="form-label">Surah</label>
                                <select class="form-select" id="surahSelect">
                                    <option value="al-fatihah">Al-Fatihah (1)</option>
                                    <option value="al-baqarah">Al-Baqarah (2)</option>
                                    <option value="al-imran">Al-Imran (3)</option>
                                    <option value="an-nisa">An-Nisa (4)</option>
                                    <option value="al-maidah">Al-Maidah (5)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">From Ayah</label>
                                <input type="number" class="form-input" id="fromAyah" min="1" max="286" value="1">
                            </div>
                            <div class="form-group">
                                <label class="form-label">To Ayah</label>
                                <input type="number" class="form-input" id="toAyah" min="1" max="286" value="10">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Type</label>
                                <select class="form-select" id="sessionType">
                                    <option value="memorization">Memorization</option>
                                    <option value="revision">Revision</option>
                                    <option value="recitation">Recitation</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn" onclick="addQuranSession()" style="margin-top: 15px; width: 100%;">
                            üìñ Add Quran Session
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- FINANCIAL TAB -->
        <div id="financial" class="tab-content">
            <div class="dashboard">
                <div class="card" style="grid-column: 1 / -1;">
                    <h2 class="card-title">üí∞ Family Budget Manager</h2>
                    
                    <!-- Financial Overview -->
                    <div style="margin-top: 20px;">
                        <h3 style="color: var(--neon-blue); margin-bottom: 15px;">Financial Overview</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Monthly Budget</div>
                                <div class="stat-number" id="monthlyBudget">2000</div>
                                <div class="stat-label">MVR</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Spent This Month</div>
                                <div class="stat-number" id="spentThisMonth">1250</div>
                                <div class="stat-label">MVR</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Remaining</div>
                                <div class="stat-number" id="remainingBudget">750</div>
                                <div class="stat-label">MVR</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Savings</div>
                                <div class="stat-number" id="totalSavings">5000</div>
                                <div class="stat-label">MVR</div>
                            </div>
                        </div>
                    </div>

                    <!-- Expense Categories -->
                    <div style="margin-top: 30px;">
                        <h3 style="color: var(--neon-green); margin-bottom: 15px;">Expense Categories</h3>
                        <div class="category-grid">
                            <div class="category-item category-food" onclick="filterExpenses('food')">
                                <div style="font-weight: bold;">üçî Food</div>
                                <div style="font-size: 1.2em; margin: 5px 0;">450 MVR</div>
                                <div style="font-size: 0.8em;">22% of total</div>
                            </div>
                            <div class="category-item category-education" onclick="filterExpenses('education')">
                                <div style="font-weight: bold;">üìö Education</div>
                                <div style="font-size: 1.2em; margin: 5px 0;">300 MVR</div>
                                <div style="font-size: 0.8em;">15% of total</div>
                            </div>
                            <div class="category-item category-health" onclick="filterExpenses('health')">
                                <div style="font-weight: bold;">üè• Health</div>
                                <div style="font-size: 1.2em; margin: 5px 0;">200 MVR</div>
                                <div style="font-size: 0.8em;">10% of total</div>
                            </div>
                            <div class="category-item category-transport" onclick="filterExpenses('transport')">
                                <div style="font-weight: bold;">üöó Transport</div>
                                <div style="font-size: 1.2em; margin: 5px 0;">150 MVR</div>
                                <div style="font-size: 0.8em;">7% of total</div>
                            </div>
                            <div class="category-item category-charity" onclick="filterExpenses('charity')">
                                <div style="font-weight: bold;">ü§≤ Charity</div>
                                <div style="font-size: 1.2em; margin: 5px 0;">100 MVR</div>
                                <div style="font-size: 0.8em;">5% of total</div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Transactions -->
                    <div style="margin-top: 30px;">
                        <h3 style="color: var(--neon-pink); margin-bottom: 15px;">Recent Transactions</h3>
                        <div class="table-container">
                            <table id="transactionsTable">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Description</th>
                                        <th>Category</th>
                                        <th>Amount</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionsList">
                                    <!-- Transactions will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        <button class="btn" onclick="openAddExpenseModal()" style="margin-top: 15px; width: 100%;">
                            ‚ûï Add New Expense
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- HEALTH TAB -->
        <div id="health" class="tab-content">
            <div class="dashboard">
                <div class="card" style="grid-column: 1 / -1;">
                    <h2 class="card-title">üè• Family Health Records</h2>
                    
                    <!-- Health Overview -->
                    <div style="margin-top: 20px;">
                        <h3 style="color: var(--neon-blue); margin-bottom: 15px;">Health Overview</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Upcoming Appointments</div>
                                <div class="stat-number" id="upcomingAppointments">2</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Vaccinations Due</div>
                                <div class="stat-number" id="vaccinationsDue">1</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Medications</div>
                                <div class="stat-number" id="activeMedications">3</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Last Check-up</div>
                                <div class="stat-number" id="lastCheckup">15</div>
                                <div class="stat-label">days ago</div>
                            </div>
                        </div>
                    </div>

                    <!-- Medical Records -->
                    <div style="margin-top: 30px;">
                        <h3 style="color: var(--neon-green); margin-bottom: 15px;">Medical Records</h3>
                        <div id="medicalRecordsList">
                            <!-- Records will be loaded here -->
                        </div>
                        <button class="btn" onclick="openAddHealthRecordModal()" style="margin-top: 15px; width: 100%;">
                            ‚ûï Add Health Record
                        </button>
                    </div>

                    <!-- Vaccination Schedule -->
                    <div style="margin-top: 30px;">
                        <h3 style="color: var(--neon-yellow); margin-bottom: 15px;">Vaccination Schedule</h3>
                        <div class="table-container">
                            <table id="vaccinationTable">
                                <thead>
                                    <tr>
                                        <th>Vaccine</th>
                                        <th>Child</th>
                                        <th>Due Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="vaccinationList">
                                    <!-- Vaccinations will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SHARING TAB -->
        <div id="sharing" class="tab-content">
            <div class="dashboard">
                <div class="card" style="grid-column: 1 / -1;">
                    <h2 class="card-title">üë• Family Sharing & Permissions</h2>
                    
                    <!-- Shared Members -->
                    <div style="margin-top: 20px;">
                        <h3 style="color: var(--neon-blue); margin-bottom: 15px;">Shared Family Members</h3>
                        <div id="sharedMembersList">
                            <!-- Shared members will be loaded here -->
                        </div>
                        <button class="btn" onclick="openInviteMemberModal()" style="margin-top: 15px; width: 100%;">
                            üìß Invite Family Member
                        </button>
                    </div>

                    <!-- Permission Templates -->
                    <div style="margin-top: 30px;">
                        <h3 style="color: var(--neon-green); margin-bottom: 15px;">Permission Templates</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            <div class="permission-item" onclick="selectTemplate('full_access')">
                                <div style="font-weight: bold; color: var(--neon-green);">Full Access</div>
                                <div style="font-size: 0.9em; margin-top: 5px;">View and edit everything</div>
                            </div>
                            <div class="permission-item active" onclick="selectTemplate('parent_access')">
                                <div style="font-weight: bold; color: var(--neon-blue);">Parent Access</div>
                                <div style="font-size: 0.9em; margin-top: 5px;">View all, edit limited</div>
                            </div>
                            <div class="permission-item" onclick="selectTemplate('read_only')">
                                <div style="font-weight: bold; color: var(--neon-yellow);">Read Only</div>
                                <div style="font-size: 0.9em; margin-top: 5px;">View only, no editing</div>
                            </div>
                            <div class="permission-item" onclick="selectTemplate('custom')">
                                <div style="font-weight: bold; color: var(--neon-pink);">Custom</div>
                                <div style="font-size: 0.9em; margin-top: 5px;">Choose specific permissions</div>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Permissions -->
                    <div style="margin-top: 30px; display: none;" id="customPermissions">
                        <h3 style="color: var(--neon-pink); margin-bottom: 15px;">Custom Permissions</h3>
                        <div class="permissions-grid">
                            <div class="permission-item active" onclick="togglePermission('dashboard')">
                                Dashboard
                            </div>
                            <div class="permission-item active" onclick="togglePermission('tasks')">
                                Tasks
                            </div>
                            <div class="permission-item active" onclick="togglePermission('homework')">
                                Homework
                            </div>
                            <div class="permission-item" onclick="togglePermission('prayer')">
                                Prayer
                            </div>
                            <div class="permission-item active" onclick="togglePermission('schedule')">
                                Schedule
                            </div>
                            <div class="permission-item" onclick="togglePermission('quran')">
                                Quran
                            </div>
                            <div class="permission-item" onclick="togglePermission('financial')">
                                Financial
                            </div>
                            <div class="permission-item active" onclick="togglePermission('health')">
                                Health
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SETTINGS TAB -->
        <div id="settings" class="tab-content">
            <div class="dashboard">
                <div class="card" style="grid-column: 1 / -1;">
                    <h2 class="card-title">‚öôÔ∏è App Settings</h2>
                    
                    <!-- Notification Settings -->
                    <div style="margin-top: 20px;">
                        <h3 style="color: var(--neon-blue); margin-bottom: 15px;">Notification Settings</h3>
                        <div style="display: grid; gap: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Prayer Time Reminders</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="notifyPrayer" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Task Reminders</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="notifyTasks" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Homework Deadlines</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="notifyHomework" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>Sound Alerts</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="soundAlerts" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Data Management -->
                    <div style="margin-top: 30px;">
                        <h3 style="color: var(--neon-green); margin-bottom: 15px;">Data Management</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <button class="btn" onclick="exportData()">
                                üíæ Export Data
                            </button>
                            <button class="btn" onclick="importData()">
                                üì• Import Data
                            </button>
                            <button class="btn" onclick="clearData()" style="background: linear-gradient(45deg, #ff0000, #ff5555);">
                                üóëÔ∏è Clear Data
                            </button>
                            <button class="btn" onclick="resetApp()" style="background: linear-gradient(45deg, #ff7700, #ffaa00);">
                                üîÑ Reset App
                            </button>
                        </div>
                    </div>

                    <!-- Theme Settings -->
                    <div style="margin-top: 30px;">
                        <h3 style="color: var(--neon-pink); margin-bottom: 15px;">Theme Settings</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div class="theme-option" onclick="setTheme('neon')" style="
                                background: linear-gradient(45deg, #ff00ff, #00ffff);
                                padding: 20px;
                                border-radius: 10px;
                                text-align: center;
                                cursor: pointer;
                                border: 3px solid var(--neon-pink);
                            ">
                                <div style="font-weight: bold;">Neon Theme</div>
                            </div>
                            <div class="theme-option" onclick="setTheme('dark')" style="
                                background: linear-gradient(45deg, #1a1a2e, #16213e);
                                padding: 20px;
                                border-radius: 10px;
                                text-align: center;
                                cursor: pointer;
                                border: 3px solid #333;
                            ">
                                <div style="font-weight: bold;">Dark Theme</div>
                            </div>
                            <div class="theme-option" onclick="setTheme('light')" style="
                                background: linear-gradient(45deg, #f8f9fa, #e9ecef);
                                padding: 20px;
                                border-radius: 10px;
                                text-align: center;
                                cursor: pointer;
                                border: 3px solid #ddd;
                                color: #333;
                            ">
                                <div style="font-weight: bold;">Light Theme</div>
                            </div>
                        </div>
                    </div>

                    <!-- App Information -->
                    <div style="margin-top: 30px; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px;">
                        <h3 style="color: var(--neon-yellow); margin-bottom: 15px;">App Information</h3>
                        <div style="display: grid; gap: 10px;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Version</span>
                                <span style="color: var(--neon-green);">2.0.0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Last Backup</span>
                                <span style="color: var(--neon-blue);" id="lastBackup">2024-12-10</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Data Size</span>
                                <span style="color: var(--neon-pink);" id="dataSize">2.4 KB</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Family Members</span>
                                <span style="color: var(--neon-yellow);" id="familyMembersCount">4</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <!-- Add Task Modal -->
    <div id="addTaskModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('addTaskModal')">&times;</button>
            <h2 style="color: var(--neon-pink); margin-bottom: 20px;">‚ûï Add New Task</h2>
            <form id="taskForm">
                <div class="form-group">
                    <label class="form-label">Task Title</label>
                    <input type="text" class="form-input" id="taskTitle" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="taskDescription" rows="2"></textarea>
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label class="form-label">Due Date</label>
                        <input type="date" class="form-input" id="taskDueDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Due Time</label>
                        <input type="time" class="form-input" id="taskDueTime">
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label class="form-label">Priority</label>
                        <select class="form-select" id="taskPriority">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <select class="form-select" id="taskCategory">
                            <option value="family">Family</option>
                            <option value="school">School</option>
                            <option value="islamic">Islamic</option>
                            <option value="work">Work</option>
                            <option value="personal">Personal</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Assigned To</label>
                    <select class="form-select" id="taskAssignedTo" multiple>
                        <!-- Family members will be populated -->
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Reminders</label>
                    <div style="display: grid; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="reminderNotification">
                            <span>Push Notification</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="reminderSound">
                            <span>Sound Alert</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="reminderEmail">
                            <span>Email Reminder</span>
                        </label>
                    </div>
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">
                    üíæ Save Task
                </button>
            </form>
        </div>
    </div>

    <!-- Add Homework Modal -->
    <div id="addHomeworkModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('addHomeworkModal')">&times;</button>
            <h2 style="color: var(--neon-blue); margin-bottom: 20px;">üìö Assign Homework</h2>
            <form id="homeworkForm">
                <div class="form-group">
                    <label class="form-label">Subject</label>
                    <select class="form-select" id="homeworkSubject" required>
                        <option value="math">Mathematics</option>
                        <option value="science">Science</option>
                        <option value="quran">Quran</option>
                        <option value="arabic">Arabic</option>
                        <option value="english">English</option>
                        <option value="history">History</option>
                        <option value="islamic_studies">Islamic Studies</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Assignment Title</label>
                    <input type="text" class="form-input" id="homeworkTitle" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="homeworkDescription" rows="3" required></textarea>
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label class="form-label">Assigned To</label>
                        <select class="form-select" id="homeworkAssignedTo" required>
                            <!-- Children will be populated -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Due Date</label>
                        <input type="date" class="form-input" id="homeworkDueDate" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Attachments</label>
                    <input type="file" class="form-input" id="homeworkAttachment" multiple>
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">
                    üìö Assign Homework
                </button>
            </form>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('shareModal')">&times;</button>
            <h2 style="color: var(--neon-green); margin-bottom: 20px;">üë• Share Access</h2>
            <form id="shareForm">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-input" id="shareEmail" required placeholder="family.member@example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Relationship</label>
                    <select class="form-select" id="shareRelationship">
                        <option value="parent">Parent</option>
                        <option value="spouse">Spouse</option>
                        <option value="grandparent">Grandparent</option>
                        <option value="guardian">Guardian</option>
                        <option value="teacher">Teacher</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Access Level</label>
                    <select class="form-select" id="shareAccessLevel" onchange="toggleCustomPermissions()">
                        <option value="full">Full Access</option>
                        <option value="parent">Parent Access</option>
                        <option value="read_only">Read Only</option>
                        <option value="custom">Custom Permissions</option>
                    </select>
                </div>
                <div id="customPermissionsModal" style="display: none; margin-top: 15px;">
                    <div class="permissions-grid">
                        <label class="permission-item" onclick="toggleModalPermission('dashboard')">
                            <input type="checkbox" hidden> Dashboard
                        </label>
                        <label class="permission-item" onclick="toggleModalPermission('tasks')">
                            <input type="checkbox" hidden> Tasks
                        </label>
                        <label class="permission-item" onclick="toggleModalPermission('homework')">
                            <input type="checkbox" hidden> Homework
                        </label>
                        <label class="permission-item" onclick="toggleModalPermission('prayer')">
                            <input type="checkbox" hidden> Prayer
                        </label>
                        <label class="permission-item" onclick="toggleModalPermission('schedule')">
                            <input type="checkbox" hidden> Schedule
                        </label>
                        <label class="permission-item" onclick="toggleModalPermission('quran')">
                            <input type="checkbox" hidden> Quran
                        </label>
                        <label class="permission-item" onclick="toggleModalPermission('financial')">
                            <input type="checkbox" hidden> Financial
                        </label>
                        <label class="permission-item" onclick="toggleModalPermission('health')">
                            <input type="checkbox" hidden> Health
                        </label>
                    </div>
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">
                    üìß Send Invitation
                </button>
            </form>
        </div>
    </div>

    <!-- Add Expense Modal -->
    <div id="addExpenseModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('addExpenseModal')">&times;</button>
            <h2 style="color: var(--neon-yellow); margin-bottom: 20px;">üí∞ Add Expense</h2>
            <form id="expenseForm">
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <input type="text" class="form-input" id="expenseDescription" required>
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label class="form-label">Amount (MVR)</label>
                        <input type="number" class="form-input" id="expenseAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <select class="form-select" id="expenseCategory">
                            <option value="food">Food</option>
                            <option value="education">Education</option>
                            <option value="health">Health</option>
                            <option value="transport">Transport</option>
                            <option value="charity">Charity</option>
                            <option value="entertainment">Entertainment</option>
                            <option value="bills">Bills</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="date" class="form-input" id="expenseDate" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Paid By</label>
                    <select class="form-select" id="expensePaidBy">
                        <option value="mom">Mom</option>
                        <option value="dad">Dad</option>
                        <option value="both">Both</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="expenseNotes" rows="2"></textarea>
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">
                    üíæ Save Expense
                </button>
            </form>
        </div>
    </div>

    <!-- Add Health Record Modal -->
    <div id="addHealthRecordModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('addHealthRecordModal')">&times;</button>
            <h2 style="color: var(--neon-pink); margin-bottom: 20px;">üè• Add Health Record</h2>
            <form id="healthRecordForm">
                <div class="form-group">
                    <label class="form-label">For Family Member</label>
                    <select class="form-select" id="healthMember" required>
                        <!-- Family members will be populated -->
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Record Type</label>
                    <select class="form-select" id="healthType" required>
                        <option value="checkup">Check-up</option>
                        <option value="vaccination">Vaccination</option>
                        <option value="medication">Medication</option>
                        <option value="allergy">Allergy</option>
                        <option value="condition">Medical Condition</option>
                        <option value="test">Test Result</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="healthDescription" rows="3" required></textarea>
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-input" id="healthDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Doctor/Hospital</label>
                        <input type="text" class="form-input" id="healthProvider">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="healthNotes" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Attachment (Prescription/Report)</label>
                    <input type="file" class="form-input" id="healthAttachment">
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">
                    üè• Save Record
                </button>
            </form>
        </div>
    </div>

    <!-- Add Quran Session Modal -->
    <div id="addQuranSessionModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('addQuranSessionModal')">&times;</button>
            <h2 style="color: var(--neon-green); margin-bottom: 20px;">üìñ Add Quran Session</h2>
            <form id="quranSessionForm">
                <div class="form-group">
                    <label class="form-label">Family Member</label>
                    <select class="form-select" id="quranMember" required>
                        <!-- Family members will be populated -->
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Surah</label>
                    <select class="form-select" id="quranSurah" required>
                        <option value="al-fatihah">Al-Fatihah (1)</option>
                        <option value="al-baqarah">Al-Baqarah (2)</option>
                        <option value="al-imran">Al-Imran (3)</option>
                        <option value="an-nisa">An-Nisa (4)</option>
                        <option value="al-maidah">Al-Maidah (5)</option>
                    </select>
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                    <div class="form-group">
                        <label class="form-label">From Ayah</label>
                        <input type="number" class="form-input" id="quranFromAyah" min="1" max="286" value="1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">To Ayah</label>
                        <input type="number" class="form-input" id="quranToAyah" min="1" max="286" value="10" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Session Type</label>
                    <select class="form-select" id="quranSessionType" required>
                        <option value="memorization">Memorization</option>
                        <option value="revision">Revision</option>
                        <option value="recitation">Recitation</option>
                        <option value="tajweed">Tajweed Practice</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Duration (minutes)</label>
                    <input type="number" class="form-input" id="quranDuration" min="5" max="180" value="30" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="quranNotes" rows="2" placeholder="Any feedback or observations..."></textarea>
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">
                    üìñ Save Session
                </button>
            </form>
        </div>
    </div>

    <!-- Invite Member Modal -->
    <div id="inviteMemberModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('inviteMemberModal')">&times;</button>
            <h2 style="color: var(--neon-blue); margin-bottom: 20px;">üìß Invite Family Member</h2>
            <form id="inviteForm">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-input" id="inviteEmail" required placeholder="family.member@example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-input" id="inviteName" required placeholder="Family member's name">
                </div>
                <div class="form-group">
                    <label class="form-label">Relationship</label>
                    <select class="form-select" id="inviteRelationship" required>
                        <option value="parent">Parent</option>
                        <option value="child">Child</option>
                        <option value="spouse">Spouse</option>
                        <option value="grandparent">Grandparent</option>
                        <option value="aunt_uncle">Aunt/Uncle</option>
                        <option value="cousin">Cousin</option>
                        <option value="guardian">Guardian</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Access Level</label>
                    <select class="form-select" id="inviteAccessLevel">
                        <option value="view_only">View Only</option>
                        <option value="limited_edit">Limited Edit</option>
                        <option value="full_access">Full Access</option>
                        <option value="child_access">Child Access</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Message (Optional)</label>
                    <textarea class="form-textarea" id="inviteMessage" rows="3" placeholder="Add a personal message..."></textarea>
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">
                    üì§ Send Invitation
                </button>
            </form>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Audio Elements for Sounds -->
    <audio id="notificationSound" src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3"></audio>
    <audio id="prayerSound" src="https://assets.mixkit.co/sfx/preview/mixkit-bell-notification-933.mp3"></audio>
    <audio id="taskSound" src="https://assets.mixkit.co/sfx/preview/mixkit-message-pop-alert-2354.mp3"></audio>

    <script>
        // ==================== GLOBAL VARIABLES ====================
        let familyData = JSON.parse(localStorage.getItem('neonParentingData')) || {
            currentUser: {
                id: 1,
                name: "Mom",
                role: "admin",
                avatar: "üë©",
                email: "mom@family.com"
            },
            members: [
                { id: 1, name: "Mom", role: "admin", age: 35, avatar: "üë©", color: "#ff00ff", email: "mom@family.com" },
                { id: 2, name: "Dad", role: "parent", age: 37, avatar: "üë®", color: "#00ffff", email: "dad@family.com" },
                { id: 3, name: "Yusuf", role: "child", age: 8, avatar: "üë¶", color: "#00ff00", grade: "3rd Grade" },
                { id: 4, name: "Maryam", role: "child", age: 5, avatar: "üëß", color: "#ffff00", grade: "Kindergarten" }
            ],
            prayers: {},
            tasks: [],
            homework: [],
            expenses: [],
            healthRecords: [],
            quranSessions: [],
            schedule: {},
            sharedAccess: [
                {
                    id: 1,
                    email: "dad@family.com",
                    relationship: "spouse",
                    permissions: {
                        dashboard: true,
                        tasks: true,
                        homework: true,
                        prayer: true,
                        schedule: true,
                        quran: false,
                        financial: false,
                        health: true
                    },
                    status: "accepted"
                }
            ],
            settings: {
                soundEnabled: true,
                notifications: {
                    prayer: true,
                    tasks: true,
                    homework: true,
                    sound: true
                },
                theme: "neon",
                prayerMethod: "muslim_world_league",
                location: "Mal√©, Maldives"
            },
            lastBackup: new Date().toISOString().split('T')[0]
        };

        let currentTab = 'dashboard';
        let soundEnabled = true;
        let selectedTemplate = 'parent_access';
        let currentWeek = 48;

        // Islamic reminders data
        const islamicReminders = [
            {
                arabic: "ÿ±Ÿéÿ®ŸêŸë ÿßÿ±Ÿíÿ≠ŸéŸÖŸíŸáŸèŸÖŸéÿß ŸÉŸéŸÖŸéÿß ÿ±Ÿéÿ®ŸéŸëŸäŸéÿßŸÜŸêŸä ÿµŸéÿ∫ŸêŸäÿ±Ÿãÿß",
                translation: "'My Lord, have mercy upon them as they brought me up [when I was] small.'",
                source: "Quran 17:24"
            },
            {
                arabic: "ÿßŸÑŸíŸÖŸèÿ≥ŸíŸÑŸêŸÖŸè ŸÖŸéŸÜŸí ÿ≥ŸéŸÑŸêŸÖŸé ÿßŸÑŸíŸÖŸèÿ≥ŸíŸÑŸêŸÖŸèŸàŸÜŸé ŸÖŸêŸÜŸí ŸÑŸêÿ≥ŸéÿßŸÜŸêŸáŸê ŸàŸéŸäŸéÿØŸêŸáŸê",
                translation: "The Muslim is the one from whose tongue and hand the Muslims are safe.",
                source: "Sahih al-Bukhari"
            },
            {
                arabic: "ÿÆŸéŸäŸíÿ±ŸèŸÉŸèŸÖŸí ÿÆŸéŸäŸíÿ±ŸèŸÉŸèŸÖŸí ŸÑŸêÿ£ŸéŸáŸíŸÑŸêŸáŸê",
                translation: "The best of you are those who are best to their families.",
                source: "Tirmidhi"
            },
            {
                arabic: "ÿ∑ŸéŸÑŸéÿ®Ÿè ÿßŸÑŸíÿπŸêŸÑŸíŸÖŸê ŸÅŸéÿ±ŸêŸäÿ∂Ÿéÿ©Ÿå ÿπŸéŸÑŸéŸâ ŸÉŸèŸÑŸêŸë ŸÖŸèÿ≥ŸíŸÑŸêŸÖŸç",
                translation: "Seeking knowledge is an obligation upon every Muslim.",
                source: "Ibn Majah"
            },
            {
                arabic: "ÿ•ŸêŸÜŸéŸëŸÖŸéÿß ŸäŸèŸàŸéŸÅŸéŸëŸâ ÿßŸÑÿµŸéŸëÿßÿ®Ÿêÿ±ŸèŸàŸÜŸé ÿ£Ÿéÿ¨Ÿíÿ±ŸéŸáŸèŸÖ ÿ®Ÿêÿ∫ŸéŸäŸíÿ±Ÿê ÿ≠Ÿêÿ≥Ÿéÿßÿ®Ÿç",
                translation: "Indeed, the patient will be given their reward without account.",
                source: "Quran 39:10"
            }
        ];

        // Sample data for demonstration
        const sampleTasks = [
            {
                id: 1,
                title: "Parent-Teacher Meeting",
                description: "Discuss Yusuf's progress in mathematics",
                dueDate: "2024-12-12",
                dueTime: "14:30",
                priority: "high",
                category: "school",
                assignedTo: [1, 2],
                status: "pending",
                reminders: { notification: true, sound: true, email: false },
                createdAt: "2024-12-10"
            },
            {
                id: 2,
                title: "Buy groceries for the week",
                description: "Milk, eggs, bread, fruits, vegetables",
                dueDate: "2024-12-11",
                dueTime: "18:00",
                priority: "medium",
                category: "family",
                assignedTo: [1],
                status: "pending",
                reminders: { notification: true, sound: false, email: false },
                createdAt: "2024-12-09"
            },
            {
                id: 3,
                title: "Quran revision with children",
                description: "Surah Al-Fatihah and last 10 ayahs of Surah Al-Baqarah",
                dueDate: "2024-12-11",
                dueTime: "20:00",
                priority: "high",
                category: "islamic",
                assignedTo: [1, 3, 4],
                status: "completed",
                reminders: { notification: true, sound: true, email: false },
                createdAt: "2024-12-08"
            }
        ];

        const sampleHomework = [
            {
                id: 1,
                subject: "math",
                title: "Algebra Problems",
                description: "Complete exercises 1-10 from chapter 3",
                assignedTo: 3,
                dueDate: "2024-12-15",
                status: "pending",
                priority: "high",
                createdAt: "2024-12-10"
            },
            {
                id: 2,
                subject: "quran",
                title: "Memorize Surah Al-Ikhlas",
                description: "Memorize with proper tajweed and meaning",
                assignedTo: 4,
                dueDate: "2024-12-20",
                status: "pending",
                priority: "medium",
                createdAt: "2024-12-09"
            },
            {
                id: 3,
                subject: "science",
                title: "Solar System Project",
                description: "Create a model of the solar system",
                assignedTo: 3,
                dueDate: "2024-12-18",
                status: "in_progress",
                priority: "medium",
                createdAt: "2024-12-07"
            }
        ];

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadDashboard();
            setupEventListeners();
            startBackgroundServices();
        });

        function initializeApp() {
            // Initialize sample data if empty
            if (familyData.tasks.length === 0) {
                familyData.tasks = sampleTasks;
            }
            if (familyData.homework.length === 0) {
                familyData.homework = sampleHomework;
            }

            // Initialize today's prayer data
            const today = new Date().toISOString().split('T')[0];
            if (!familyData.prayers[today]) {
                familyData.prayers[today] = {
                    fajr: false,
                    dhuhr: false,
                    asr: false,
                    maghrib: false,
                    isha: false
                };
            }

            // Set current user
            const user = familyData.currentUser;
            document.querySelector('.user-avatar').textContent = user.avatar;
            document.querySelector('.user-info div:first-child').textContent = `${user.name} (Admin)`;

            // Set sound state
            soundEnabled = familyData.settings.soundEnabled;
            updateSoundIndicator();

            saveData();
        }

        function saveData() {
            localStorage.setItem('neonParentingData', JSON.stringify(familyData));
            updateDataSize();
        }

        // ==================== TAB MANAGEMENT ====================
        function showTab(tabName) {
            currentTab = tabName;
            
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Find and activate the clicked button
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => {
                if (btn.textContent.includes(getTabEmoji(tabName))) {
                    btn.classList.add('active');
                }
            });
            
            // Load specific tab data
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'tasks':
                    loadTasks();
                    break;
                case 'homework':
                    loadHomework();
                    break;
                case 'prayer':
                    loadPrayerTab();
                    break;
                case 'schedule':
                    loadSchedule();
                    break;
                case 'quran':
                    loadQuranTab();
                    break;
                case 'financial':
                    loadFinancialTab();
                    break;
                case 'health':
                    loadHealthTab();
                    break;
                case 'sharing':
                    loadSharingTab();
                    break;
                case 'settings':
                    loadSettingsTab();
                    break;
            }
        }

        function getTabEmoji(tabName) {
            const emojis = {
                'dashboard': 'üè†',
                'tasks': '‚úÖ',
                'homework': 'üìö',
                'prayer': 'üïå',
                'schedule': 'üìÖ',
                'quran': 'üìñ',
                'financial': 'üí∞',
                'health': 'üè•',
                'sharing': 'üë•',
                'settings': '‚öôÔ∏è'
            };
            return emojis[tabName] || 'üìÑ';
        }

        // ==================== DASHBOARD FUNCTIONS ====================
        function loadDashboard() {
            updateDashboardStats();
            loadTodayTasks();
            loadDueHomework();
            updatePrayerProgress();
            loadIslamicReminder();
        }

        function updateDashboardStats() {
            const childrenCount = familyData.members.filter(m => m.role === 'child').length;
            document.getElementById('totalChildren').textContent = childrenCount;

            // Calculate prayer streak
            const streak = calculatePrayerStreak();
            document.getElementById('prayerStreak').textContent = streak;

            // Calculate pending tasks
            const pendingTasks = familyData.tasks.filter(t => t.status === 'pending').length;
            document.getElementById('pendingTasks').textContent = pendingTasks;

            // Calculate weekly budget
            const today = new Date();
            const startOfWeek = new Date(today.setDate(today.getDate() - today.getDay()));
            const endOfWeek = new Date(today.setDate(today.getDate() - today.getDay() + 6));
            
            const weeklyExpenses = familyData.expenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                return expenseDate >= startOfWeek && expenseDate <= endOfWeek;
            }).reduce((total, expense) => total + parseFloat(expense.amount), 0);

            document.getElementById('weeklyBudget').textContent = Math.round(weeklyExpenses);
        }

        function loadTodayTasks() {
            const container = document.getElementById('todayTasksList');
            container.innerHTML = '';
            
            const today = new Date().toISOString().split('T')[0];
            const todayTasks = familyData.tasks.filter(task => 
                task.dueDate === today && task.status !== 'completed'
            ).slice(0, 5);

            if (todayTasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚úÖ</div>
                        <div>No tasks for today!</div>
                    </div>
                `;
                return;
            }

            todayTasks.forEach(task => {
                const taskDiv = document.createElement('div');
                taskDiv.className = `task-item ${task.status === 'completed' ? 'completed' : ''}`;
                taskDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" ${task.status === 'completed' ? 'checked' : ''} 
                               onchange="toggleTaskCompletion(${task.id}, this.checked)" 
                               style="width: 20px; height: 20px; cursor: pointer;">
                        <div class="task-info">
                            <div class="task-title">${task.title}</div>
                            <div class="task-meta">
                                <span>${formatTime(task.dueTime)}</span>
                                <span class="task-priority priority-${task.priority}">
                                    ${task.priority.toUpperCase()}
                                </span>
                                <span>${getCategoryEmoji(task.category)} ${task.category}</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <button onclick="editTask(${task.id})" style="
                            background: none;
                            border: 1px solid var(--neon-blue);
                            color: var(--neon-blue);
                            padding: 5px 10px;
                            border-radius: 5px;
                            cursor: pointer;
                        ">Edit</button>
                    </div>
                `;
                container.appendChild(taskDiv);
            });
        }

        function loadDueHomework() {
            const container = document.getElementById('dueHomeworkList');
            container.innerHTML = '';
            
            const today = new Date();
            const nextWeek = new Date(today);
            nextWeek.setDate(today.getDate() + 7);
            
            const dueHomework = familyData.homework.filter(hw => {
                const dueDate = new Date(hw.dueDate);
                return dueDate <= nextWeek && hw.status !== 'completed';
            }).slice(0, 3);

            if (dueHomework.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìö</div>
                        <div>No homework due soon!</div>
                    </div>
                `;
                return;
            }

            dueHomework.forEach(hw => {
                const child = familyData.members.find(m => m.id === hw.assignedTo);
                const subjectClass = `subject-${hw.subject}`;
                
                const hwDiv = document.createElement('div');
                hwDiv.className = 'homework-card';
                hwDiv.innerHTML = `
                    <div class="subject-badge ${subjectClass}">
                        ${getSubjectName(hw.subject)}
                    </div>
                    <div style="font-weight: bold; color: var(--text-glow); margin-bottom: 5px;">
                        ${hw.title}
                    </div>
                    <div style="font-size: 0.9em; color: var(--neon-blue); margin-bottom: 10px;">
                        ${hw.description.substring(0, 50)}...
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 0.8em; color: var(--text-glow);">
                                For: ${child?.name || 'Unknown'}
                            </div>
                            <div style="font-size: 0.8em; color: ${isOverdue(hw.dueDate) ? 'var(--neon-pink)' : 'var(--neon-yellow)'};">
                                Due: ${formatDate(hw.dueDate)}
                            </div>
                        </div>
                        <button onclick="markHomeworkComplete(${hw.id})" style="
                            background: var(--neon-green);
                            border: none;
                            color: white;
                            padding: 5px 10px;
                            border-radius: 5px;
                            cursor: pointer;
                        ">‚úì Done</button>
                    </div>
                `;
                container.appendChild(hwDiv);
            });
        }

        function updatePrayerProgress() {
            const today = new Date().toISOString().split('T')[0];
            const todayPrayers = familyData.prayers[today] || {};
            const prayers = ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'];
            
            let completed = 0;
            prayers.forEach(prayer => {
                const card = document.getElementById(prayer + 'Card');
                if (card) {
                    if (todayPrayers[prayer]) {
                        card.classList.add('checked');
                        card.querySelector('.prayer-status').textContent = '‚úÖ';
                        completed++;
                    } else {
                        card.classList.remove('checked');
                        card.querySelector('.prayer-status').textContent = '‚è∞';
                    }
                }
            });
            
            const percentage = (completed / 5) * 100;
            document.getElementById('prayerPercentage').textContent = `${Math.round(percentage)}%`;
            document.getElementById('prayerProgressBar').style.width = `${percentage}%`;
        }

        function loadIslamicReminder() {
            const today = new Date().getDate();
            const reminderIndex = today % islamicReminders.length;
            const reminder = islamicReminders[reminderIndex];
            
            document.getElementById('ayahArabic').textContent = reminder.arabic;
            document.getElementById('ayahTranslation').textContent = reminder.translation;
            document.getElementById('ayahTranslation').nextElementSibling.innerHTML = 
                `‚Äî ${reminder.source}`;
        }

        // ==================== TASK MANAGEMENT ====================
        function loadTasks(filter = 'all') {
            const container = document.getElementById('tasksList');
            container.innerHTML = '';
            
            let tasks = [...familyData.tasks];
            
            // Apply filters
            switch(filter) {
                case 'today':
                    const today = new Date().toISOString().split('T')[0];
                    tasks = tasks.filter(t => t.dueDate === today);
                    break;
                case 'pending':
                    tasks = tasks.filter(t => t.status === 'pending');
                    break;
                case 'completed':
                    tasks = tasks.filter(t => t.status === 'completed');
                    break;
                case 'high':
                    tasks = tasks.filter(t => t.priority === 'high');
                    break;
            }
            
            if (tasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <div>No tasks found!</div>
                    </div>
                `;
                return;
            }
            
            // Sort by due date and priority
            tasks.sort((a, b) => {
                if (a.dueDate !== b.dueDate) {
                    return new Date(a.dueDate) - new Date(b.dueDate);
                }
                const priorityOrder = { high: 0, medium: 1, low: 2 };
                return priorityOrder[a.priority] - priorityOrder[b.priority];
            });
            
            tasks.forEach(task => {
                const taskDiv = document.createElement('div');
                taskDiv.className = `task-item ${task.status === 'completed' ? 'completed' : ''}`;
                
                const assignedNames = task.assignedTo.map(id => {
                    const member = familyData.members.find(m => m.id === id);
                    return member ? member.name : 'Unknown';
                }).join(', ');
                
                taskDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" ${task.status === 'completed' ? 'checked' : ''} 
                               onchange="toggleTaskCompletion(${task.id}, this.checked)" 
                               style="width: 20px; height: 20px; cursor: pointer;">
                        <div class="task-info">
                            <div class="task-title">${task.title}</div>
                            <div class="task-meta">
                                <span>üìÖ ${formatDate(task.dueDate)} ${task.dueTime ? formatTime(task.dueTime) : ''}</span>
                                <span class="task-priority priority-${task.priority}">
                                    ${task.priority.toUpperCase()}
                                </span>
                                <span>${getCategoryEmoji(task.category)} ${task.category}</span>
                                <span>üë§ ${assignedNames}</span>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button onclick="editTask(${task.id})" style="
                            background: none;
                            border: 1px solid var(--neon-blue);
                            color: var(--neon-blue);
                            padding: 5px 10px;
                            border-radius: 5px;
                            cursor: pointer;
                        ">Edit</button>
                        <button onclick="deleteTask(${task.id})" style="
                            background: none;
                            border: 1px solid var(--neon-pink);
                            color: var(--neon-pink);
                            padding: 5px 10px;
                            border-radius: 5px;
                            cursor: pointer;
                        ">Delete</button>
                    </div>
                `;
                container.appendChild(taskDiv);
            });
        }

        function filterTasks(filter) {
            document.querySelectorAll('#tasks .btn-sm').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            loadTasks(filter);
        }

        function filterByCategory(category) {
            if (!category) {
                loadTasks('all');
                return;
            }
            
            const filteredTasks = familyData.tasks.filter(t => t.category === category);
            const container = document.getElementById('tasksList');
            container.innerHTML = '';
            
            if (filteredTasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <div>No ${category} tasks found!</div>
                    </div>
                `;
                return;
            }
            
            filteredTasks.forEach(task => {
                const taskDiv = document.createElement('div');
                taskDiv.className = `task-item ${task.status === 'completed' ? 'completed' : ''}`;
                taskDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" ${task.status === 'completed' ? 'checked' : ''} 
                               onchange="toggleTaskCompletion(${task.id}, this.checked)" 
                               style="width: 20px; height: 20px; cursor: pointer;">
                        <div class="task-info">
                            <div class="task-title">${task.title}</div>
                            <div class="task-meta">
                                <span>üìÖ ${formatDate(task.dueDate)}</span>
                                <span class="task-priority priority-${task.priority}">
                                    ${task.priority.toUpperCase()}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(taskDiv);
            });
        }

        function openAddTaskModal() {
            const modal = document.getElementById('addTaskModal');
            modal.style.display = 'flex';
            
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('taskDueDate').value = today;
            
            // Populate assigned to dropdown
            const assignedSelect = document.getElementById('taskAssignedTo');
            assignedSelect.innerHTML = '';
            familyData.members.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = `${member.name} (${member.role})`;
                assignedSelect.appendChild(option);
            });
        }

        function toggleTaskCompletion(taskId, completed) {
            const task = familyData.tasks.find(t => t.id === taskId);
            if (task) {
                task.status = completed ? 'completed' : 'pending';
                task.completedAt = completed ? new Date().toISOString() : null;
                saveData();
                
                if (completed && soundEnabled) {
                    playSound('taskSound');
                }
                
                showNotification(`Task "${task.title}" marked as ${completed ? 'completed' : 'pending'}!`, 
                    completed ? 'success' : 'info');
                
                loadDashboard();
                if (currentTab === 'tasks') loadTasks();
            }
        }

        function editTask(taskId) {
            const task = familyData.tasks.find(t => t.id === taskId);
            if (!task) return;
            
            openAddTaskModal();
            
            // Fill form with task data
            setTimeout(() => {
                document.getElementById('taskTitle').value = task.title;
                document.getElementById('taskDescription').value = task.description;
                document.getElementById('taskDueDate').value = task.dueDate;
                document.getElementById('taskDueTime').value = task.dueTime;
                document.getElementById('taskPriority').value = task.priority;
                document.getElementById('taskCategory').value = task.category;
                
                // Select assigned members
                const assignedSelect = document.getElementById('taskAssignedTo');
                Array.from(assignedSelect.options).forEach(option => {
                    option.selected = task.assignedTo.includes(parseInt(option.value));
                });
                
                // Set reminders
                document.getElementById('reminderNotification').checked = task.reminders?.notification || false;
                document.getElementById('reminderSound').checked = task.reminders?.sound || false;
                document.getElementById('reminderEmail').checked = task.reminders?.email || false;
                
                // Change form to update mode
                const form = document.getElementById('taskForm');
                form.onsubmit = function(e) {
                    e.preventDefault();
                    updateTask(taskId);
                };
                
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = '‚úèÔ∏è Update Task';
                submitBtn.style.background = 'linear-gradient(45deg, var(--neon-yellow), var(--neon-orange))';
            }, 100);
        }

        function updateTask(taskId) {
            const taskIndex = familyData.tasks.findIndex(t => t.id === taskId);
            if (taskIndex === -1) return;
            
            const updatedTask = {
                ...familyData.tasks[taskIndex],
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                dueDate: document.getElementById('taskDueDate').value,
                dueTime: document.getElementById('taskDueTime').value,
                priority: document.getElementById('taskPriority').value,
                category: document.getElementById('taskCategory').value,
                assignedTo: Array.from(document.getElementById('taskAssignedTo').selectedOptions).map(opt => parseInt(opt.value)),
                reminders: {
                    notification: document.getElementById('reminderNotification').checked,
                    sound: document.getElementById('reminderSound').checked,
                    email: document.getElementById('reminderEmail').checked
                }
            };
            
            familyData.tasks[taskIndex] = updatedTask;
            saveData();
            closeModal('addTaskModal');
            
            showNotification(`Task "${updatedTask.title}" updated successfully!`, 'success');
            
            loadDashboard();
            if (currentTab === 'tasks') loadTasks();
        }

        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                familyData.tasks = familyData.tasks.filter(t => t.id !== taskId);
                saveData();
                
                showNotification('Task deleted successfully!', 'success');
                
                loadDashboard();
                if (currentTab === 'tasks') loadTasks();
            }
        }

        // ==================== HOMEWORK MANAGEMENT ====================
        function loadHomework(filter = 'all') {
            const container = document.getElementById('homeworkGrid');
            container.innerHTML = '';
            
            let homework = [...familyData.homework];
            
            // Apply filters
            switch(filter) {
                case 'pending':
                    homework = homework.filter(hw => hw.status === 'pending');
                    break;
                case 'completed':
                    homework = homework.filter(hw => hw.status === 'completed');
                    break;
                case 'overdue':
                    homework = homework.filter(hw => isOverdue(hw.dueDate) && hw.status !== 'completed');
                    break;
            }
            
            if (homework.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìö</div>
                        <div>No homework found!</div>
                    </div>
                `;
                return;
            }
            
            // Sort by due date
            homework.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
            
            homework.forEach(hw => {
                const child = familyData.members.find(m => m.id === hw.assignedTo);
                const subjectClass = `subject-${hw.subject}`;
                const isOverdueHW = isOverdue(hw.dueDate) && hw.status !== 'completed';
                
                const hwDiv = document.createElement('div');
                hwDiv.className = 'homework-card';
                hwDiv.style.borderColor = isOverdueHW ? 'var(--neon-pink)' : 'var(--neon-purple)';
                hwDiv.innerHTML = `
                    <div class="subject-badge ${subjectClass}">
                        ${getSubjectName(hw.subject)}
                    </div>
                    <div style="font-weight: bold; color: var(--text-glow); margin-bottom: 5px; font-size: 1.1em;">
                        ${hw.title}
                    </div>
                    <div style="font-size: 0.9em; color: var(--neon-blue); margin-bottom: 10px; min-height: 40px;">
                        ${hw.description}
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div>
                            <div style="font-size: 0.8em; color: var(--text-glow);">
                                üë§ ${child?.name || 'Unknown'}
                            </div>
                            <div style="font-size: 0.8em; color: ${isOverdueHW ? 'var(--neon-pink)' : 'var(--neon-yellow)'};">
                                üìÖ Due: ${formatDate(hw.dueDate)}
                            </div>
                        </div>
                        <span class="task-priority priority-${hw.priority}">
                            ${hw.priority.toUpperCase()}
                        </span>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="markHomeworkComplete(${hw.id})" style="
                            flex: 1;
                            background: var(--neon-green);
                            border: none;
                            color: white;
                            padding: 8px;
                            border-radius: 5px;
                            cursor: pointer;
                        ">‚úì Mark Complete</button>
                        <button onclick="editHomework(${hw.id})" style="
                            background: none;
                            border: 1px solid var(--neon-blue);
                            color: var(--neon-blue);
                            padding: 8px;
                            border-radius: 5px;
                            cursor: pointer;
                        ">Edit</button>
                    </div>
                `;
                container.appendChild(hwDiv);
            });
        }

        function filterHomework(filter) {
            document.querySelectorAll('#homework .btn-sm').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            loadHomework(filter);
        }

        function filterHomeworkBySubject(subject) {
            if (!subject) {
                loadHomework('all');
                return;
            }
            
            const filtered = familyData.homework.filter(hw => hw.subject === subject);
            const container = document.getElementById('homeworkGrid');
            container.innerHTML = '';
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìö</div>
                        <div>No ${subject} homework found!</div>
                    </div>
                `;
                return;
            }
            
            filtered.forEach(hw => {
                const child = familyData.members.find(m => m.id === hw.assignedTo);
                const subjectClass = `subject-${hw.subject}`;
                
                const hwDiv = document.createElement('div');
                hwDiv.className = 'homework-card';
                hwDiv.innerHTML = `
                    <div class="subject-badge ${subjectClass}">
                        ${getSubjectName(hw.subject)}
                    </div>
                    <div style="font-weight: bold; color: var(--text-glow); margin-bottom: 5px;">
                        ${hw.title}
                    </div>
                    <div style="font-size: 0.9em; color: var(--neon-blue); margin-bottom: 10px;">
                        ${hw.description.substring(0, 100)}...
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.8em; color: var(--text-glow);">
                            For: ${child?.name || 'Unknown'}
                        </span>
                        <button onclick="markHomeworkComplete(${hw.id})" style="
                            background: var(--neon-green);
                            border: none;
                            color: white;
                            padding: 5px 10px;
                            border-radius: 5px;
                            cursor: pointer;
                        ">‚úì Done</button>
                    </div>
                `;
                container.appendChild(hwDiv);
            });
        }

        function openAddHomeworkModal() {
            const modal = document.getElementById('addHomeworkModal');
            modal.style.display = 'flex';
            
            // Set default due date to 3 days from now
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 3);
            document.getElementById('homeworkDueDate').value = dueDate.toISOString().split('T')[0];
            
            // Populate children dropdown
            const assignedSelect = document.getElementById('homeworkAssignedTo');
            assignedSelect.innerHTML = '';
            familyData.members
                .filter(m => m.role === 'child')
                .forEach(child => {
                    const option = document.createElement('option');
                    option.value = child.id;
                    option.textContent = `${child.name} (${child.grade || 'Child'})`;
                    assignedSelect.appendChild(option);
                });
        }

        function editHomework(homeworkId) {
            const hw = familyData.homework.find(h => h.id === homeworkId);
            if (!hw) return;
            
            openAddHomeworkModal();
            
            // Fill form with homework data
            setTimeout(() => {
                document.getElementById('homeworkSubject').value = hw.subject;
                document.getElementById('homeworkTitle').value = hw.title;
                document.getElementById('homeworkDescription').value = hw.description;
                document.getElementById('homeworkAssignedTo').value = hw.assignedTo;
                document.getElementById('homeworkDueDate').value = hw.dueDate;
                
                // Change form to update mode
                const form = document.getElementById('homeworkForm');
                form.onsubmit = function(e) {
                    e.preventDefault();
                    updateHomework(homeworkId);
                };
                
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = '‚úèÔ∏è Update Homework';
                submitBtn.style.background = 'linear-gradient(45deg, var(--neon-yellow), var(--neon-orange))';
            }, 100);
        }

        function updateHomework(homeworkId) {
            const hwIndex = familyData.homework.findIndex(h => h.id === homeworkId);
            if (hwIndex === -1) return;
            
            const updatedHw = {
                ...familyData.homework[hwIndex],
                subject: document.getElementById('homeworkSubject').value,
                title: document.getElementById('homeworkTitle').value,
                description: document.getElementById('homeworkDescription').value,
                assignedTo: parseInt(document.getElementById('homeworkAssignedTo').value),
                dueDate: document.getElementById('homeworkDueDate').value
            };
            
            familyData.homework[hwIndex] = updatedHw;
            saveData();
            closeModal('addHomeworkModal');
            
            showNotification(`Homework "${updatedHw.title}" updated successfully!`, 'success');
            
            loadDashboard();
            if (currentTab === 'homework') loadHomework();
        }

        function markHomeworkComplete(homeworkId) {
            const hw = familyData.homework.find(h => h.id === homeworkId);
            if (hw) {
                hw.status = 'completed';
                hw.completedAt = new Date().toISOString();
                saveData();
                
                showNotification(`Homework "${hw.title}" marked as completed!`, 'success');
                
                loadDashboard();
                if (currentTab === 'homework') loadHomework();
            }
        }

        // ==================== PRAYER MANAGEMENT ====================
        function togglePrayer(prayerName) {
            const today = new Date().toISOString().split('T')[0];
            if (!familyData.prayers[today]) {
                familyData.prayers[today] = {};
            }
            
            familyData.prayers[today][prayerName] = !familyData.prayers[today][prayerName];
            saveData();
            updatePrayerProgress();
            
            const status = familyData.prayers[today][prayerName] ? 'completed' : 'pending';
            showNotification(`‚úÖ ${prayerName.toUpperCase()} prayer marked as ${status}!`, 'success');
            
            if (familyData.prayers[today][prayerName] && soundEnabled) {
                playSound('prayerSound');
            }
        }

        function calculatePrayerStreak() {
            let streak = 0;
            const today = new Date();
            
            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const prayers = familyData.prayers[dateStr];
                
                if (prayers) {
                    const completed = Object.values(prayers).filter(p => p).length;
                    if (completed >= 3) {
                        streak++;
                    } else {
                        break;
                    }
                } else {
                    break;
                }
            }
            
            return streak;
        }

        function loadPrayerTab() {
            loadFamilyPrayerStatus();
            generateWeeklyPrayerChart();
            updatePrayerStatistics();
        }

        function loadFamilyPrayerStatus() {
            const container = document.getElementById('familyPrayerStatus');
            container.innerHTML = '';
            
            const today = new Date().toISOString().split('T')[0];
            const todayPrayers = familyData.prayers[today] || {};
            
            familyData.members.forEach(member => {
                // Calculate member's prayer completion for today
                const completed = Object.values(todayPrayers).filter(p => p).length;
                const percentage = Math.round((completed / 5) * 100);
                
                const memberDiv = document.createElement('div');
                memberDiv.style.cssText = `
                    background: rgba(0, 0, 0, 0.5);
                    border: 2px solid ${member.color};
                    padding: 15px;
                    margin-bottom: 10px;
                    border-radius: 10px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                `;
                
                memberDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="
                            width: 40px;
                            height: 40px;
                            background: ${member.color};
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: 1.5em;
                        ">${member.avatar}</div>
                        <div>
                            <div style="font-weight: bold; color: ${member.color}">${member.name}</div>
                            <div style="color: var(--text-glow); font-size: 0.9em;">${member.role.toUpperCase()}</div>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <div style="color: var(--neon-green); font-size: 1.5em; font-weight: bold;">${percentage}%</div>
                        <div style="color: var(--text-glow); font-size: 0.8em;">Today's Prayer</div>
                    </div>
                `;
                container.appendChild(memberDiv);
            });
        }

        function generateWeeklyPrayerChart() {
            const container = document.getElementById('weeklyPrayerChart');
            container.innerHTML = '';
            
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const today = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const dayPrayers = familyData.prayers[dateStr] || {};
                const completed = Object.values(dayPrayers).filter(p => p).length;
                const percentage = Math.round((completed / 5) * 100);
                
                const dayDiv = document.createElement('div');
                dayDiv.style.cssText = `
                    margin-bottom: 10px;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                `;
                
                dayDiv.innerHTML = `
                    <div style="width: 60px; color: var(--neon-blue);">${days[date.getDay()]}</div>
                    <div style="flex: 1; height: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; overflow: hidden;">
                        <div style="height: 100%; width: ${percentage}%; background: linear-gradient(90deg, var(--neon-green), var(--neon-yellow)); border-radius: 10px;"></div>
                    </div>
                    <div style="width: 40px; text-align: right; color: var(--neon-green);">${percentage}%</div>
                `;
                container.appendChild(dayDiv);
            }
        }

        function updatePrayerStatistics() {
            // Calculate Fajr attendance for the month
            let fajrCount = 0;
            let totalDays = 0;
            const today = new Date();
            
            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const prayers = familyData.prayers[dateStr];
                
                if (prayers) {
                    totalDays++;
                    if (prayers.fajr) fajrCount++;
                }
            }
            
            const fajrPercentage = totalDays > 0 ? Math.round((fajrCount / totalDays) * 100) : 0;
            document.getElementById('fajrStats').textContent = `${fajrPercentage}%`;
            
            // Calculate total prayers for the month
            let totalPrayers = 0;
            Object.values(familyData.prayers).forEach(dayPrayers => {
                totalPrayers += Object.values(dayPrayers).filter(p => p).length;
            });
            document.getElementById('totalPrayers').textContent = totalPrayers;
            
            // Find best performer (simplified)
            document.getElementById('bestPerformer').textContent = "Yusuf";
            
            // Update current streak
            document.getElementById('currentStreak').textContent = calculatePrayerStreak();
        }

        function updatePrayerTimes() {
            const method = document.getElementById('prayerMethod').value;
            const location = document.getElementById('prayerLocation').value;
            const notifications = document.getElementById('prayerNotifications').checked;
            
            familyData.settings.prayerMethod = method;
            familyData.settings.location = location;
            familyData.settings.notifications.prayer = notifications;
            saveData();
            
            showNotification('üïå Prayer times updated successfully!', 'success');
        }

        // ==================== SCHEDULE MANAGEMENT ====================
        function loadSchedule() {
            updateScheduleTable();
        }

        function updateScheduleTable() {
            const container = document.getElementById('scheduleTable');
            container.innerHTML = '';
            
            // Update current week display
            document.getElementById('currentWeek').textContent = `Week ${currentWeek}`;
            
            // Create header
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr>
                    <th>Time</th>
                    <th>Monday</th>
                    <th>Tuesday</th>
                    <th>Wednesday</th>
                    <th>Thursday</th>
                    <th>Friday</th>
                    <th>Saturday</th>
                    <th>Sunday</th>
                </tr>
            `;
            container.appendChild(thead);
            
            // Create time slots
            const tbody = document.createElement('tbody');
            const timeSlots = [
                '06:00-08:00', '08:00-10:00', '10:00-12:00',
                '12:00-14:00', '14:00-16:00', '16:00-18:00',
                '18:00-20:00', '20:00-22:00'
            ];
            
            timeSlots.forEach(timeSlot => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="font-weight: bold; color: var(--neon-yellow);">${timeSlot}</td>
                    <td onclick="addScheduleEvent('mon', '${timeSlot}')" style="cursor: pointer;">+ Add</td>
                    <td onclick="addScheduleEvent('tue', '${timeSlot}')" style="cursor: pointer;">+ Add</td>
                    <td onclick="addScheduleEvent('wed', '${timeSlot}')" style="cursor: pointer;">+ Add</td>
                    <td onclick="addScheduleEvent('thu', '${timeSlot}')" style="cursor: pointer;">+ Add</td>
                    <td onclick="addScheduleEvent('fri', '${timeSlot}')" style="cursor: pointer;">+ Add</td>
                    <td onclick="addScheduleEvent('sat', '${timeSlot}')" style="cursor: pointer;">+ Add</td>
                    <td onclick="addScheduleEvent('sun', '${timeSlot}')" style="cursor: pointer;">+ Add</td>
                `;
                tbody.appendChild(row);
            });
            
            container.appendChild(tbody);
            
            // Load existing schedule events
            loadScheduleEvents();
        }

        function loadScheduleEvents() {
            // This would load from familyData.schedule
            // For now, we'll add some sample events
            const sampleEvents = [
                { day: 'mon', time: '08:00-10:00', title: 'School', person: 'Yusuf, Maryam' },
                { day: 'wed', time: '14:00-16:00', title: 'Quran Class', person: 'Yusuf' },
                { day: 'fri', time: '18:00-20:00', title: 'Family Time', person: 'All' },
                { day: 'sat', time: '10:00-12:00', title: 'Grocery Shopping', person: 'Mom' }
            ];
            
            sampleEvents.forEach(event => {
                addEventToTable(event.day, event.time, event.title, event.person);
            });
        }

        function addEventToTable(day, time, title, person) {
            const dayIndex = {
                'mon': 1, 'tue': 2, 'wed': 3,
                'thu': 4, 'fri': 5, 'sat': 6, 'sun': 7
            }[day];
            
            if (!dayIndex) return;
            
            const table = document.getElementById('scheduleTable');
            const timeSlots = [
                '06:00-08:00', '08:00-10:00', '10:00-12:00',
                '12:00-14:00', '14:00-16:00', '16:00-18:00',
                '18:00-20:00', '20:00-22:00'
            ];
            
            const rowIndex = timeSlots.indexOf(time) + 1; // +1 for header row
            if (rowIndex > 0 && table.rows[rowIndex]) {
                const cell = table.rows[rowIndex].cells[dayIndex];
                cell.innerHTML = `
                    <div style="background: rgba(0, 100, 255, 0.2); padding: 5px; border-radius: 5px; border: 1px solid var(--neon-blue);">
                        <div style="font-weight: bold; color: var(--neon-blue);">${title}</div>
                        <div style="font-size: 0.8em; color: var(--text-glow);">üë§ ${person}</div>
                    </div>
                `;
                cell.style.cursor = 'pointer';
                cell.onclick = function() {
                    editScheduleEvent(day, time, title, person);
                };
            }
        }

        function addScheduleEvent(day, time) {
            const title = prompt('Enter event title:');
            if (!title) return;
            
            const person = prompt('Who is this for? (e.g., Yusuf, Maryam, All):');
            if (!person) return;
            
            addEventToTable(day, time, title, person);
            
            // Save to data
            if (!familyData.schedule[`week${currentWeek}`]) {
                familyData.schedule[`week${currentWeek}`] = {};
            }
            if (!familyData.schedule[`week${currentWeek}`][day]) {
                familyData.schedule[`week${currentWeek}`][day] = {};
            }
            familyData.schedule[`week${currentWeek}`][day][time] = {
                title: title,
                person: person,
                created: new Date().toISOString()
            };
            
            saveData();
            showNotification(`Event "${title}" added to schedule!`, 'success');
        }

        function prevWeek() {
            currentWeek--;
            if (currentWeek < 1) currentWeek = 52;
            updateScheduleTable();
        }

        function nextWeek() {
            currentWeek++;
            if (currentWeek > 52) currentWeek = 1;
            updateScheduleTable();
        }

        // ==================== QURAN MANAGEMENT ====================
        function loadQuranTab() {
            updateQuranStats();
            loadQuranProgress();
        }

        function updateQuranStats() {
            // Calculate memorized pages (simplified)
            const totalPages = 604;
            const memorizedPages = Math.round(totalPages * 0.07); // 7%
            document.getElementById('memorizedPages').textContent = memorizedPages;
            
            // Update other stats
            document.getElementById('currentJuz').textContent = "3";
            document.getElementById('dailyRevision').textContent = "30";
            document.getElementById('quranStreak').textContent = "14";
        }

        function loadQuranProgress() {
            const container = document.getElementById('quranProgressGrid');
            container.innerHTML = '';
            
            const surahs = [
                { name: 'Al-Fatihah', progress: 100 },
                { name: 'Al-Baqarah', progress: 15 },
                { name: 'Al-Imran', progress: 10 },
                { name: 'An-Nisa', progress: 5 },
                { name: 'Al-Maidah', progress: 20 }
            ];
            
            surahs.forEach(surah => {
                const surahDiv = document.createElement('div');
                surahDiv.style.cssText = `
                    background: rgba(0, 0, 0, 0.5);
                    border: 2px solid var(--neon-blue);
                    border-radius: 10px;
                    padding: 15px;
                    margin-bottom: 10px;
                `;
                
                surahDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <div style="font-weight: bold; color: var(--neon-blue);">${surah.name}</div>
                        <div style="color: var(--neon-green);">${surah.progress}%</div>
                    </div>
                    <div style="height: 8px; background: rgba(0,0,0,0.3); border-radius: 4px; overflow: hidden;">
                        <div style="height: 100%; width: ${surah.progress}%; background: linear-gradient(90deg, var(--neon-blue), var(--neon-green));"></div>
                    </div>
                `;
                container.appendChild(surahDiv);
            });
        }

        function openAddQuranSessionModal() {
            const modal = document.getElementById('addQuranSessionModal');
            modal.style.display = 'flex';
            
            // Populate family members dropdown
            const memberSelect = document.getElementById('quranMember');
            memberSelect.innerHTML = '';
            familyData.members.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = `${member.name} (${member.role})`;
                memberSelect.appendChild(option);
            });
        }

        function addQuranSession() {
            const memberId = parseInt(document.getElementById('quranMember').value);
            const surah = document.getElementById('quranSurah').value;
            const fromAyah = parseInt(document.getElementById('quranFromAyah').value);
            const toAyah = parseInt(document.getElementById('quranToAyah').value);
            const type = document.getElementById('quranSessionType').value;
            const duration = parseInt(document.getElementById('quranDuration').value);
            const notes = document.getElementById('quranNotes').value;
            
            const session = {
                id: Date.now(),
                memberId: memberId,
                surah: surah,
                fromAyah: fromAyah,
                toAyah: toAyah,
                type: type,
                duration: duration,
                notes: notes,
                date: new Date().toISOString()
            };
            
            if (!familyData.quranSessions) {
                familyData.quranSessions = [];
            }
            familyData.quranSessions.push(session);
            saveData();
            closeModal('addQuranSessionModal');
            
            showNotification('üìñ Quran session recorded successfully!', 'success');
            
            if (currentTab === 'quran') {
                loadQuranTab();
            }
        }

        // ==================== FINANCIAL MANAGEMENT ====================
        function loadFinancialTab() {
            updateFinancialStats();
            loadRecentTransactions();
        }

        function updateFinancialStats() {
            // Calculate monthly expenses
            const today = new Date();
            const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            const monthlyExpenses = familyData.expenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                return expenseDate >= startOfMonth && expenseDate <= endOfMonth;
            }).reduce((total, expense) => total + parseFloat(expense.amount), 0);
            
            document.getElementById('spentThisMonth').textContent = Math.round(monthlyExpenses);
            
            // Calculate remaining budget (assuming 2000 MVR monthly budget)
            const monthlyBudget = 2000;
            const remaining = monthlyBudget - monthlyExpenses;
            document.getElementById('remainingBudget').textContent = Math.round(Math.max(0, remaining));
        }

        function loadRecentTransactions() {
            const container = document.getElementById('transactionsList');
            container.innerHTML = '';
            
            const recentExpenses = [...familyData.expenses]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10);
            
            if (recentExpenses.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; color: var(--neon-blue); padding: 30px;">
                            No expenses recorded yet!
                        </td>
                    </tr>
                `;
                return;
            }
            
            recentExpenses.forEach(expense => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(expense.date)}</td>
                    <td>${expense.description}</td>
                    <td>
                        <span style="
                            display: inline-block;
                            padding: 3px 8px;
                            border-radius: 4px;
                            background: rgba(0,0,0,0.3);
                            border: 1px solid var(--neon-blue);
                        ">
                            ${expense.category}
                        </span>
                    </td>
                    <td style="color: var(--neon-pink); font-weight: bold;">
                        ${parseFloat(expense.amount).toFixed(2)} MVR
                    </td>
                    <td>
                        <button onclick="editExpense(${expense.id})" style="
                            background: none;
                            border: 1px solid var(--neon-blue);
                            color: var(--neon-blue);
                            padding: 3px 8px;
                            border-radius: 4px;
                            cursor: pointer;
                            margin-right: 5px;
                        ">Edit</button>
                        <button onclick="deleteExpense(${expense.id})" style="
                            background: none;
                            border: 1px solid var(--neon-pink);
                            color: var(--neon-pink);
                            padding: 3px 8px;
                            border-radius: 4px;
                            cursor: pointer;
                        ">Delete</button>
                    </td>
                `;
                container.appendChild(row);
            });
        }

        function filterExpenses(category) {
            const filtered = familyData.expenses.filter(e => e.category === category);
            const container = document.getElementById('transactionsList');
            container.innerHTML = '';
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; color: var(--neon-blue); padding: 30px;">
                            No ${category} expenses found!
                        </td>
                    </tr>
                `;
                return;
            }
            
            filtered.forEach(expense => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(expense.date)}</td>
                    <td>${expense.description}</td>
                    <td>${expense.category}</td>
                    <td style="color: var(--neon-pink); font-weight: bold;">
                        ${parseFloat(expense.amount).toFixed(2)} MVR
                    </td>
                    <td>
                        <button onclick="editExpense(${expense.id})" class="btn btn-sm">Edit</button>
                        <button onclick="deleteExpense(${expense.id})" class="btn btn-sm" style="background: var(--neon-pink);">Delete</button>
                    </td>
                `;
                container.appendChild(row);
            });
        }

        function openAddExpenseModal() {
            const modal = document.getElementById('addExpenseModal');
            modal.style.display = 'flex';
            
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('expenseDate').value = today;
        }

        function editExpense(expenseId) {
            const expense = familyData.expenses.find(e => e.id === expenseId);
            if (!expense) return;
            
            openAddExpenseModal();
            
            // Fill form with expense data
            setTimeout(() => {
                document.getElementById('expenseDescription').value = expense.description;
                document.getElementById('expenseAmount').value = expense.amount;
                document.getElementById('expenseCategory').value = expense.category;
                document.getElementById('expenseDate').value = expense.date;
                document.getElementById('expensePaidBy').value = expense.paidBy || 'mom';
                document.getElementById('expenseNotes').value = expense.notes || '';
                
                // Change form to update mode
                const form = document.getElementById('expenseForm');
                form.onsubmit = function(e) {
                    e.preventDefault();
                    updateExpense(expenseId);
                };
                
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = '‚úèÔ∏è Update Expense';
                submitBtn.style.background = 'linear-gradient(45deg, var(--neon-yellow), var(--neon-orange))';
            }, 100);
        }

        function updateExpense(expenseId) {
            const expenseIndex = familyData.expenses.findIndex(e => e.id === expenseId);
            if (expenseIndex === -1) return;
            
            const updatedExpense = {
                ...familyData.expenses[expenseIndex],
                description: document.getElementById('expenseDescription').value,
                amount: parseFloat(document.getElementById('expenseAmount').value),
                category: document.getElementById('expenseCategory').value,
                date: document.getElementById('expenseDate').value,
                paidBy: document.getElementById('expensePaidBy').value,
                notes: document.getElementById('expenseNotes').value
            };
            
            familyData.expenses[expenseIndex] = updatedExpense;
            saveData();
            closeModal('addExpenseModal');
            
            showNotification(`Expense "${updatedExpense.description}" updated successfully!`, 'success');
            
            loadFinancialTab();
        }

        function deleteExpense(expenseId) {
            if (confirm('Are you sure you want to delete this expense?')) {
                familyData.expenses = familyData.expenses.filter(e => e.id !== expenseId);
                saveData();
                
                showNotification('Expense deleted successfully!', 'success');
                loadFinancialTab();
            }
        }

        // Expense Form Submission
        document.getElementById('expenseForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const expense = {
                id: Date.now(),
                description: document.getElementById('expenseDescription').value,
                amount: parseFloat(document.getElementById('expenseAmount').value),
                category: document.getElementById('expenseCategory').value,
                date: document.getElementById('expenseDate').value,
                paidBy: document.getElementById('expensePaidBy').value,
                notes: document.getElementById('expenseNotes').value,
                createdAt: new Date().toISOString()
            };
            
            if (!familyData.expenses) {
                familyData.expenses = [];
            }
            familyData.expenses.push(expense);
            saveData();
            closeModal('addExpenseModal');
            
            showNotification(`Expense "${expense.description}" added successfully!`, 'success');
            
            if (currentTab === 'financial') {
                loadFinancialTab();
            }
            
            this.reset();
        });

        // ==================== HEALTH MANAGEMENT ====================
        function loadHealthTab() {
            updateHealthStats();
            loadMedicalRecords();
            loadVaccinationSchedule();
        }

        function updateHealthStats() {
            // Count upcoming appointments (within next 30 days)
            const today = new Date();
            const nextMonth = new Date(today);
            nextMonth.setDate(today.getDate() + 30);
            
            const upcomingAppointments = familyData.healthRecords.filter(record => {
                if (record.type !== 'checkup') return false;
                const recordDate = new Date(record.date);
                return recordDate >= today && recordDate <= nextMonth;
            }).length;
            
            document.getElementById('upcomingAppointments').textContent = upcomingAppointments;
            
            // Update other stats
            document.getElementById('vaccinationsDue').textContent = "1";
            document.getElementById('activeMedications').textContent = "3";
            document.getElementById('lastCheckup').textContent = "15";
        }

        function loadMedicalRecords() {
            const container = document.getElementById('medicalRecordsList');
            container.innerHTML = '';
            
            const recentRecords = [...familyData.healthRecords]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            if (recentRecords.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üè•</div>
                        <div>No medical records found!</div>
                    </div>
                `;
                return;
            }
            
            recentRecords.forEach(record => {
                const member = familyData.members.find(m => m.id === record.memberId);
                const recordDiv = document.createElement('div');
                recordDiv.style.cssText = `
                    background: rgba(0, 0, 0, 0.5);
                    border: 2px solid var(--neon-green);
                    padding: 15px;
                    margin-bottom: 10px;
                    border-radius: 10px;
                `;
                
                recordDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div style="font-weight: bold; color: var(--neon-green);">
                            ${record.type.toUpperCase()}
                        </div>
                        <div style="color: var(--neon-blue);">
                            ${formatDate(record.date)}
                        </div>
                    </div>
                    <div style="color: var(--text-glow); margin-bottom: 10px;">
                        <div style="font-weight: bold;">${record.description}</div>
                        <div style="font-size: 0.9em; margin-top: 5px;">For: ${member?.name || 'Unknown'}</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.8em; color: var(--neon-yellow);">
                            ${record.provider || 'No provider specified'}
                        </span>
                        <button onclick="viewHealthRecord(${record.id})" class="btn btn-sm">
                            üëÅÔ∏è View Details
                        </button>
                    </div>
                `;
                container.appendChild(recordDiv);
            });
        }

        function loadVaccinationSchedule() {
            const container = document.getElementById('vaccinationList');
            container.innerHTML = '';
            
            const vaccinations = [
                { vaccine: 'MMR', child: 'Yusuf', dueDate: '2024-12-20', status: 'pending' },
                { vaccine: 'HPV', child: 'Maryam', dueDate: '2024-12-25', status: 'scheduled' },
                { vaccine: 'Flu Shot', child: 'Mom', dueDate: '2024-12-15', status: 'completed' }
            ];
            
            vaccinations.forEach(vaccine => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${vaccine.vaccine}</td>
                    <td>${vaccine.child}</td>
                    <td>${formatDate(vaccine.dueDate)}</td>
                    <td>
                        <span style="
                            display: inline-block;
                            padding: 3px 8px;
                            border-radius: 4px;
                            font-size: 0.8em;
                            background: ${vaccine.status === 'completed' ? 'rgba(0,255,0,0.2)' : 
                                      vaccine.status === 'scheduled' ? 'rgba(255,255,0,0.2)' : 'rgba(255,0,0,0.2)'};
                            color: ${vaccine.status === 'completed' ? 'var(--neon-green)' : 
                                   vaccine.status === 'scheduled' ? 'var(--neon-yellow)' : 'var(--neon-pink)'};
                            border: 1px solid ${vaccine.status === 'completed' ? 'var(--neon-green)' : 
                                            vaccine.status === 'scheduled' ? 'var(--neon-yellow)' : 'var(--neon-pink)'};
                        ">
                            ${vaccine.status.toUpperCase()}
                        </span>
                    </td>
                    <td>
                        <button onclick="markVaccination('${vaccine.vaccine}', '${vaccine.child}')" class="btn btn-sm">
                            ‚úì Mark Done
                        </button>
                    </td>
                `;
                container.appendChild(row);
            });
        }

        function openAddHealthRecordModal() {
            const modal = document.getElementById('addHealthRecordModal');
            modal.style.display = 'flex';
            
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('healthDate').value = today;
            
            // Populate family members dropdown
            const memberSelect = document.getElementById('healthMember');
            memberSelect.innerHTML = '';
            familyData.members.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = `${member.name} (${member.role})`;
                memberSelect.appendChild(option);
            });
        }

        function viewHealthRecord(recordId) {
            const record = familyData.healthRecords.find(r => r.id === recordId);
            if (!record) return;
            
            const member = familyData.members.find(m => m.id === record.memberId);
            
            alert(`Health Record Details:\n\n` +
                  `Type: ${record.type}\n` +
                  `For: ${member?.name || 'Unknown'}\n` +
                  `Date: ${formatDate(record.date)}\n` +
                  `Description: ${record.description}\n` +
                  `Provider: ${record.provider || 'Not specified'}\n` +
                  `Notes: ${record.notes || 'None'}`);
        }

        function markVaccination(vaccine, child) {
            showNotification(`Vaccination ${vaccine} for ${child} marked as completed!`, 'success');
        }

        // Health Record Form Submission
        document.getElementById('healthRecordForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const healthRecord = {
                id: Date.now(),
                memberId: parseInt(document.getElementById('healthMember').value),
                type: document.getElementById('healthType').value,
                description: document.getElementById('healthDescription').value,
                date: document.getElementById('healthDate').value,
                provider: document.getElementById('healthProvider').value,
                notes: document.getElementById('healthNotes').value,
                createdAt: new Date().toISOString()
            };
            
            if (!familyData.healthRecords) {
                familyData.healthRecords = [];
            }
            familyData.healthRecords.push(healthRecord);
            saveData();
            closeModal('addHealthRecordModal');
            
            showNotification(`Health record for "${healthRecord.type}" added successfully!`, 'success');
            
            if (currentTab === 'health') {
                loadHealthTab();
            }
            
            this.reset();
        });

        // ==================== SHARING & PERMISSIONS ====================
        function loadSharingTab() {
            loadSharedMembers();
        }

        function loadSharedMembers() {
            const container = document.getElementById('sharedMembersList');
            container.innerHTML = '';
            
            familyData.sharedAccess.forEach(access => {
                const memberDiv = document.createElement('div');
                memberDiv.style.cssText = `
                    background: rgba(0, 0, 0, 0.5);
                    border: 2px solid var(--neon-blue);
                    padding: 15px;
                    margin-bottom: 10px;
                    border-radius: 10px;
                `;
                
                // Count enabled permissions
                const enabledPermissions = Object.values(access.permissions).filter(p => p).length;
                const totalPermissions = Object.keys(access.permissions).length;
                
                memberDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div style="font-weight: bold; color: var(--neon-blue);">
                            ${access.email}
                        </div>
                        <span style="
                            background: ${access.status === 'accepted' ? 'var(--neon-green)' : 'var(--neon-yellow)'};
                            color: white;
                            padding: 3px 10px;
                            border-radius: 15px;
                            font-size: 0.8em;
                        ">
                            ${access.status.toUpperCase()}
                        </span>
                    </div>
                    <div style="color: var(--text-glow); font-size: 0.9em; margin-bottom: 10px;">
                        ${access.relationship} ‚Ä¢ ${enabledPermissions}/${totalPermissions} permissions
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="editPermissions('${access.email}')" class="btn btn-sm">
                            ‚úèÔ∏è Edit Permissions
                        </button>
                        <button onclick="revokeAccess('${access.email}')" class="btn btn-sm" style="
                            background: linear-gradient(45deg, #ff0000, #ff5555);
                        ">
                            üóëÔ∏è Revoke Access
                        </button>
                    </div>
                `;
                container.appendChild(memberDiv);
            });
        }

        function openShareModal() {
            const modal = document.getElementById('shareModal');
            modal.style.display = 'flex';
        }

        function openInviteMemberModal() {
            const modal = document.getElementById('inviteMemberModal');
            modal.style.display = 'flex';
        }

        function selectTemplate(template) {
            selectedTemplate = template;
            
            // Update UI
            document.querySelectorAll('.permission-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.permission-item').classList.add('active');
            
            // Show custom permissions if selected
            const customPerms = document.getElementById('customPermissions');
            customPerms.style.display = template === 'custom' ? 'block' : 'none';
            
            // Apply template permissions
            if (template !== 'custom') {
                applyTemplatePermissions(template);
            }
        }

        function applyTemplatePermissions(template) {
            const permissions = {
                full_access: { dashboard: true, tasks: true, homework: true, prayer: true, schedule: true, quran: true, financial: true, health: true },
                parent_access: { dashboard: true, tasks: true, homework: true, prayer: true, schedule: true, quran: false, financial: false, health: true },
                read_only: { dashboard: true, tasks: false, homework: false, prayer: false, schedule: false, quran: false, financial: false, health: false }
            };
            
            const templatePerms = permissions[template] || permissions.parent_access;
            
            // Update permission items
            Object.keys(templatePerms).forEach(perm => {
                const item = document.querySelector(`.permission-item[onclick*="${perm}"]`);
                if (item) {
                    if (templatePerms[perm]) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                }
            });
        }

        function togglePermission(permission) {
            const item = event.target.closest('.permission-item');
            item.classList.toggle('active');
        }

        function toggleModalPermission(permission) {
            const item = event.target.closest('.permission-item');
            item.classList.toggle('active');
        }

        function toggleCustomPermissions() {
            const accessLevel = document.getElementById('shareAccessLevel').value;
            const customPerms = document.getElementById('customPermissionsModal');
            customPerms.style.display = accessLevel === 'custom' ? 'block' : 'none';
        }

        function editPermissions(email) {
            openShareModal();
            // Here you would load the specific user's permissions
            showNotification(`Editing permissions for ${email}`, 'info');
        }

        function revokeAccess(email) {
            if (confirm(`Are you sure you want to revoke access for ${email}?`)) {
                familyData.sharedAccess = familyData.sharedAccess.filter(a => a.email !== email);
                saveData();
                loadSharingTab();
                showNotification(`Access revoked for ${email}`, 'success');
            }
        }

        // Share Form Submission
        document.getElementById('shareForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('shareEmail').value;
            const relationship = document.getElementById('shareRelationship').value;
            const accessLevel = document.getElementById('shareAccessLevel').value;
            
            // Get permissions based on access level
            let permissions = {};
            if (accessLevel === 'custom') {
                permissions = {
                    dashboard: document.querySelector('#customPermissionsModal .permission-item:nth-child(1)').classList.contains('active'),
                    tasks: document.querySelector('#customPermissionsModal .permission-item:nth-child(2)').classList.contains('active'),
                    homework: document.querySelector('#customPermissionsModal .permission-item:nth-child(3)').classList.contains('active'),
                    prayer: document.querySelector('#customPermissionsModal .permission-item:nth-child(4)').classList.contains('active'),
                    schedule: document.querySelector('#customPermissionsModal .permission-item:nth-child(5)').classList.contains('active'),
                    quran: document.querySelector('#customPermissionsModal .permission-item:nth-child(6)').classList.contains('active'),
                    financial: document.querySelector('#customPermissionsModal .permission-item:nth-child(7)').classList.contains('active'),
                    health: document.querySelector('#customPermissionsModal .permission-item:nth-child(8)').classList.contains('active')
                };
            } else {
                const templatePerms = {
                    'full': { dashboard: true, tasks: true, homework: true, prayer: true, schedule: true, quran: true, financial: true, health: true },
                    'parent': { dashboard: true, tasks: true, homework: true, prayer: true, schedule: true, quran: false, financial: false, health: true },
                    'read_only': { dashboard: true, tasks: false, homework: false, prayer: false, schedule: false, quran: false, financial: false, health: false }
                };
                permissions = templatePerms[accessLevel] || templatePerms.parent;
            }
            
            const newAccess = {
                id: Date.now(),
                email: email,
                relationship: relationship,
                permissions: permissions,
                status: 'pending',
                invitedAt: new Date().toISOString()
            };
            
            familyData.sharedAccess.push(newAccess);
            saveData();
            closeModal('shareModal');
            
            showNotification(`Invitation sent to ${email}!`, 'success');
            loadSharingTab();
            
            this.reset();
        });

        // ==================== SETTINGS ====================
        function loadSettingsTab() {
            // Load current settings
            document.getElementById('notifyPrayer').checked = familyData.settings.notifications.prayer;
            document.getElementById('notifyTasks').checked = familyData.settings.notifications.tasks;
            document.getElementById('notifyHomework').checked = familyData.settings.notifications.homework;
            document.getElementById('soundAlerts').checked = familyData.settings.notifications.sound;
            
            // Update info
            document.getElementById('familyMembersCount').textContent = familyData.members.length;
            updateDataSize();
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            familyData.settings.soundEnabled = soundEnabled;
            saveData();
            updateSoundIndicator();
            
            if (soundEnabled) {
                playSound('notificationSound');
            }
            
            showNotification(`Sound alerts ${soundEnabled ? 'enabled' : 'disabled'}!`, 'info');
        }

        function updateSoundIndicator() {
            const indicator = document.getElementById('soundIndicator');
            if (soundEnabled) {
                indicator.classList.remove('muted');
                document.getElementById('soundToggle').innerHTML = '<span>üîä</span><span class="sound-indicator"></span>';
            } else {
                indicator.classList.add('muted');
                document.getElementById('soundToggle').innerHTML = '<span>üîá</span><span class="sound-indicator muted"></span>';
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(familyData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = 'parenting-assistant-backup.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            familyData.lastBackup = new Date().toISOString().split('T')[0];
            saveData();
            
            showNotification('üíæ Data exported successfully!', 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        familyData = importedData;
                        saveData();
                        showNotification('üì• Data imported successfully!', 'success');
                        location.reload(); // Reload to apply new data
                    } catch (error) {
                        showNotification('‚ùå Error importing data!', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function clearData() {
            if (confirm('‚ö†Ô∏è WARNING: This will clear ALL data! Are you sure?')) {
                localStorage.removeItem('neonParentingData');
                familyData = {
                    currentUser: {
                        id: 1,
                        name: "Mom",
                        role: "admin",
                        avatar: "üë©",
                        email: "mom@family.com"
                    },
                    members: [
                        { id: 1, name: "Mom", role: "admin", age: 35, avatar: "üë©", color: "#ff00ff", email: "mom@family.com" },
                        { id: 2, name: "Dad", role: "parent", age: 37, avatar: "üë®", color: "#00ffff", email: "dad@family.com" },
                        { id: 3, name: "Yusuf", role: "child", age: 8, avatar: "üë¶", color: "#00ff00", grade: "3rd Grade" },
                        { id: 4, name: "Maryam", role: "child", age: 5, avatar: "üëß", color: "#ffff00", grade: "Kindergarten" }
                    ],
                    prayers: {},
                    tasks: [],
                    homework: [],
                    expenses: [],
                    healthRecords: [],
                    quranSessions: [],
                    schedule: {},
                    sharedAccess: [],
                    settings: {
                        soundEnabled: true,
                        notifications: {
                            prayer: true,
                            tasks: true,
                            homework: true,
                            sound: true
                        },
                        theme: "neon",
                        prayerMethod: "muslim_world_league",
                        location: "Mal√©, Maldives"
                    },
                    lastBackup: new Date().toISOString().split('T')[0]
                };
                saveData();
                location.reload();
            }
        }

        function resetApp() {
            if (confirm('This will reset the app to factory settings. Continue?')) {
                clearData();
            }
        }

        function setTheme(theme) {
            familyData.settings.theme = theme;
            saveData();
            
            // Apply theme
            const root = document.documentElement;
            if (theme === 'dark') {
                root.style.setProperty('--dark-bg', '#0a0a0a');
                root.style.setProperty('--darker-bg', '#050505');
            } else if (theme === 'light') {
                root.style.setProperty('--dark-bg', '#f0f0f0');
                root.style.setProperty('--darker-bg', '#e0e0e0');
                root.style.setProperty('--text-glow', '#333333');
                root.style.setProperty('--card-bg', 'rgba(255, 255, 255, 0.9)');
            } else {
                root.style.setProperty('--dark-bg', '#0a0a1a');
                root.style.setProperty('--darker-bg', '#050510');
                root.style.setProperty('--text-glow', 'rgba(255, 255, 255, 0.9)');
                root.style.setProperty('--card-bg', 'rgba(10, 10, 26, 0.8)');
            }
            
            showNotification(`Theme changed to ${theme}!`, 'success');
        }

        function updateDataSize() {
            const dataStr = JSON.stringify(familyData);
            const size = (new Blob([dataStr]).size / 1024).toFixed(1);
            document.getElementById('dataSize').textContent = `${size} KB`;
            document.getElementById('lastBackup').textContent = familyData.lastBackup;
        }

        // ==================== UTILITY FUNCTIONS ====================
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
        }

        function formatTime(timeString) {
            if (!timeString) return '';
            const [hours, minutes] = timeString.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minutes} ${ampm}`;
        }

        function getCategoryEmoji(category) {
            const emojis = {
                'family': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
                'school': 'üè´',
                'islamic': 'üïå',
                'work': 'üíº',
                'personal': 'üë§'
            };
            return emojis[category] || 'üìù';
        }

        function getSubjectName(subject) {
            const names = {
                'math': 'Mathematics',
                'science': 'Science',
                'quran': 'Quran',
                'arabic': 'Arabic',
                'english': 'English',
                'history': 'History',
                'islamic_studies': 'Islamic Studies'
            };
            return names[subject] || subject;
        }

        function isOverdue(dateString) {
            const dueDate = new Date(dateString);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return dueDate < today;
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            let icon = '‚ÑπÔ∏è';
            switch(type) {
                case 'success':
                    icon = '‚úÖ';
                    notification.style.borderColor = 'var(--neon-green)';
                    notification.style.boxShadow = '0 0 20px var(--neon-green)';
                    break;
                case 'error':
                    icon = '‚ùå';
                    notification.style.borderColor = 'var(--neon-pink)';
                    notification.style.boxShadow = '0 0 20px var(--neon-pink)';
                    break;
                case 'info':
                    icon = '‚ÑπÔ∏è';
                    notification.style.borderColor = 'var(--neon-blue)';
                    notification.style.boxShadow = '0 0 20px var(--neon-blue)';
                    break;
            }
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div style="font-size: 1.5em;">${icon}</div>
                    <div>${message}</div>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Play sound if enabled
            if (soundEnabled && type !== 'info') {
                playSound('notificationSound');
            }
            
            // Remove after 5 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }

        function playSound(soundId) {
            if (!soundEnabled) return;
            
            const sound = document.getElementById(soundId);
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(e => console.log('Audio play failed:', e));
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function getNewReminder() {
            const randomIndex = Math.floor(Math.random() * islamicReminders.length);
            const reminder = islamicReminders[randomIndex];
            
            document.getElementById('ayahArabic').textContent = reminder.arabic;
            document.getElementById('ayahTranslation').textContent = reminder.translation;
            document.getElementById('ayahTranslation').nextElementSibling.innerHTML = 
                `‚Äî ${reminder.source}`;
            
            showNotification('üîÑ New Islamic reminder loaded!', 'info');
        }

        // ==================== FORM SUBMISSIONS ====================
        document.getElementById('taskForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const task = {
                id: Date.now(),
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                dueDate: document.getElementById('taskDueDate').value,
                dueTime: document.getElementById('taskDueTime').value,
                priority: document.getElementById('taskPriority').value,
                category: document.getElementById('taskCategory').value,
                assignedTo: Array.from(document.getElementById('taskAssignedTo').selectedOptions).map(opt => parseInt(opt.value)),
                status: 'pending',
                reminders: {
                    notification: document.getElementById('reminderNotification').checked,
                    sound: document.getElementById('reminderSound').checked,
                    email: document.getElementById('reminderEmail').checked
                },
                createdAt: new Date().toISOString().split('T')[0]
            };
            
            familyData.tasks.push(task);
            saveData();
            closeModal('addTaskModal');
            
            showNotification(`Task "${task.title}" created successfully!`, 'success');
            
            loadDashboard();
            if (currentTab === 'tasks') loadTasks();
            
            this.reset();
        });

        document.getElementById('homeworkForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const homework = {
                id: Date.now(),
                subject: document.getElementById('homeworkSubject').value,
                title: document.getElementById('homeworkTitle').value,
                description: document.getElementById('homeworkDescription').value,
                assignedTo: parseInt(document.getElementById('homeworkAssignedTo').value),
                dueDate: document.getElementById('homeworkDueDate').value,
                status: 'pending',
                priority: 'medium',
                createdAt: new Date().toISOString().split('T')[0]
            };
            
            familyData.homework.push(homework);
            saveData();
            closeModal('addHomeworkModal');
            
            showNotification(`Homework "${homework.title}" assigned successfully!`, 'success');
            
            loadDashboard();
            if (currentTab === 'homework') loadHomework();
            
            this.reset();
        });

        document.getElementById('quranSessionForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            addQuranSession();
        });

        // ==================== BACKGROUND SERVICES ====================
        function setupEventListeners() {
            // Auto-check prayer times
            setInterval(checkPrayerTimes, 60000); // Check every minute
            
            // Check for overdue tasks/homework
            setInterval(checkOverdueItems, 300000); // Check every 5 minutes
        }

       function togglePrayer(prayerName) {
    const today = new Date().toISOString().split('T')[0];
    if (!familyData.prayers[today]) {
        familyData.prayers[today] = {};
    }
    
    // Toggle prayer status
    familyData.prayers[today][prayerName] = !familyData.prayers[today][prayerName];
    saveData();
    updatePrayerProgress();
    
    // Show notification
    const status = familyData.prayers[today][prayerName] ? 'completed ‚úÖ' : 'pending ‚è∞';
    showNotification(`${prayerName.toUpperCase()} prayer marked as ${status}!`, 'success');
    
    if (familyData.prayers[today][prayerName] && soundEnabled) {
        playSound('prayerSound');
    }
}

        function checkOverdueItems() {
            const today = new Date().toISOString().split('T')[0];
            
            // Check overdue tasks
            const overdueTasks = familyData.tasks.filter(task => 
                task.status === 'pending' && 
                task.dueDate < today
            );
            
            overdueTasks.forEach(task => {
                showNotification(`‚è∞ Task "${task.title}" is overdue!`, 'error');
            });
            
            // Check overdue homework
            const overdueHomework = familyData.homework.filter(hw => 
                hw.status !== 'completed' && 
                hw.dueDate < today
            );
            
            overdueHomework.forEach(hw => {
                showNotification(`üìö Homework "${hw.title}" is overdue!`, 'error');
            });
        }

        function startBackgroundServices() {
            // Start checking for notifications
            checkOverdueItems();
            
            // Update dashboard every minute
            setInterval(() => {
                if (currentTab === 'dashboard') {
                    updateDashboardStats();
                }
            }, 60000);
        }

        // ==================== QUICK ACTIONS ====================
        function addChild() {
            const name = prompt("Enter child's name:");
            if (name) {
                const age = prompt("Enter child's age:");
                const grade = prompt("Enter child's grade (optional):");
                
                const child = {
                    id: Date.now(),
                    name: name,
                    role: 'child',
                    age: parseInt(age) || 0,
                    avatar: 'üë∂',
                    color: getRandomColor(),
                    grade: grade || '',
                    createdAt: new Date().toISOString()
                };
                
                familyData.members.push(child);
                saveData();
                showNotification(`üë∂ Child "${name}" added to family!`, 'success');
                loadDashboard();
            }
        }

        function getRandomColor() {
            const colors = ['#ff00ff', '#00ffff', '#00ff00', '#ffff00', '#ff7700', '#aa00ff'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        function backupData() {
            exportData();
        }

        function generateReport() {
            // Generate a simple report
            const report = `
                Family Report - ${new Date().toLocaleDateString()}
                
                Family Members: ${familyData.members.length}
                Children: ${familyData.members.filter(m => m.role === 'child').length}
                
                Tasks:
                - Total: ${familyData.tasks.length}
                - Pending: ${familyData.tasks.filter(t => t.status === 'pending').length}
                - Completed: ${familyData.tasks.filter(t => t.status === 'completed').length}
                
                Homework:
                - Total: ${familyData.homework.length}
                - Pending: ${familyData.homework.filter(h => h.status === 'pending').length}
                
                Financial:
                - Monthly Expenses: ${familyData.expenses.reduce((sum, e) => sum + parseFloat(e.amount), 0).toFixed(2)} MVR
                
                Prayer:
                - Current Streak: ${calculatePrayerStreak()} days
            `;
            
            alert(report);
            showNotification('üìä Report generated!', 'success');
        }

        // Initialize the app
        initializeApp();
    </script>
</body>
</html>
